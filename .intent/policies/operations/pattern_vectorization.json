{
  "id": "standard_operations_pattern_vectorization",
  "version": "1.0.0",
  "title": "Operations Standard \u2013 Pattern Vectorization",
  "type": "standard_operations",
  "status": "active",
  "owners": {
    "accountable": "Governance Lead",
    "responsible": [
      "Core Maintainer"
    ]
  },
  "review": {
    "frequency": "12 months"
  },
  "schema_id": "policy.structure",
  "policy_id": "pattern_vectorization",
  "category": "governance",
  "layer": "mind",
  "depends_on": [
    "standard_data_governance"
  ],
  "purpose": "Ensure CORE maintains semantic understanding of constitutional patterns and can validate code against patterns semantically, producing actionable, cited audit findings.\n",
  "philosophy": "Constitutional governance requires semantic understanding of patterns, not only syntax. CORE must internalize patterns as vectors, compare expectation vs reality, and report constitutional deltas with references.\n",
  "rules": [
    {
      "id": "pattern_vectorization.pattern_understanding.required",
      "statement": "CORE MUST maintain semantic understanding of all constitutional patterns defined in .intent/charter/patterns/ by vectorizing them into the core-patterns collection with section-level chunking and required metadata.\n",
      "enforcement": "error",
      "scope": [
        ".intent/charter/patterns/**/*.yaml"
      ],
      "collection": "core-patterns",
      "required_behaviors": [
        "Vectorize all pattern YAML files into core-patterns",
        "Chunk each pattern by semantic sections (YAML structure + coherence)",
        "Store metadata including pattern_id, pattern_version, pattern_category",
        "Propagate updates when patterns change (re-vectorize file)"
      ],
      "required_metadata_fields": [
        "pattern_id",
        "pattern_version",
        "pattern_category",
        "section_type",
        "section_path"
      ],
      "validation_criteria": [
        "Semantic queries against core-patterns return relevant pattern sections",
        "Semantic search works across pattern concepts",
        "Pattern dependencies are tracked (where declared)"
      ]
    },
    {
      "id": "pattern_vectorization.semantic_validation.required",
      "statement": "CORE MUST be able to validate code against patterns semantically, not just syntactically, by comparing pattern requirement chunks to code structure and reporting violations when similarity and/or structure checks fail.\n",
      "enforcement": "error",
      "required_behaviors": [
        "Load requirement chunks for a given pattern from core-patterns",
        "Query current code structure from knowledge graph for relevant symbols",
        "Compare expectations vs reality using vector similarity plus structural checks",
        "Record violations when below similarity threshold or when structural mismatch is detected"
      ],
      "validation_criteria": [
        "Detect missing decorators (e.g., @atomic_action)",
        "Detect wrong return types (e.g., ActionResult contract violations)",
        "Detect missing required metadata/anchors where applicable",
        "Detect architectural violations expressed in patterns"
      ]
    },
    {
      "id": "pattern_vectorization.constitutional_audit.integration_required",
      "statement": "Constitutional audit MUST include pattern-driven semantic validation and MUST report violations with explicit references to the violated pattern section, plus remediation guidance.\n",
      "enforcement": "error",
      "required_behaviors": [
        "Audit loads pattern expectations from core-patterns",
        "Audit queries actual code structure from knowledge graph",
        "Audit performs semantic comparison and structural validation",
        "Audit reports violations with pattern citations and remediation guidance"
      ],
      "required_violation_fields": [
        "violation_id",
        "pattern_reference",
        "code_location",
        "expected",
        "actual",
        "remediation",
        "severity"
      ],
      "validation_criteria": [
        "Violations reference specific pattern sections",
        "Violations are actionable (contain remediation guidance)"
      ]
    },
    {
      "id": "pattern_vectorization.collection.core_patterns.contract",
      "statement": "The core-patterns vector collection MUST follow defined configuration and metadata schema so that semantic retrieval and validation remain stable and auditable.\n",
      "enforcement": "error",
      "collection": "core-patterns",
      "vector_dimension": 1536,
      "distance_metric": "cosine",
      "metadata_schema": {
        "pattern_id": {
          "type": "string",
          "required": true,
          "description": "Unique pattern identifier",
          "example": "atomic_actions"
        },
        "pattern_version": {
          "type": "string",
          "required": true,
          "description": "Pattern version",
          "example": "1.0.0"
        },
        "pattern_category": {
          "type": "string",
          "required": true,
          "description": "Pattern category",
          "values": [
            "orchestration",
            "governance",
            "structure",
            "lifecycle"
          ]
        },
        "section_type": {
          "type": "string",
          "required": true,
          "description": "Chunk type",
          "values": [
            "philosophy",
            "requirement",
            "example",
            "validation_rule",
            "migration"
          ]
        },
        "section_path": {
          "type": "string",
          "required": true,
          "description": "Path within pattern YAML",
          "example": "atomic_action.universal_contract.output"
        },
        "applies_to": {
          "type": "array",
          "required": false,
          "description": "Targets this chunk applies to",
          "example": [
            "*_internal functions",
            "workflow orchestrators"
          ]
        },
        "severity": {
          "type": "string",
          "required": false,
          "description": "Violation severity if not met",
          "values": [
            "critical",
            "error",
            "warning",
            "info"
          ],
          "default": "error"
        }
      }
    },
    {
      "id": "pattern_vectorization.chunking.semantic_section.required",
      "statement": "Pattern vectorization MUST chunk by semantic sections (derived from YAML structure and semantic coherence) and MUST include sufficient context metadata for each chunk.\n",
      "enforcement": "error",
      "chunking_strategy": "semantic_section",
      "chunk_boundaries": [
        "Top-level keys (e.g., philosophy, requirements, examples)",
        "Rule definitions within validation rules",
        "Individual examples",
        "Migration phase descriptions"
      ],
      "chunk_metadata_requirements": [
        "Include pattern context in each chunk",
        "Include section hierarchy",
        "Include cross-references when present"
      ]
    },
    {
      "id": "pattern_vectorization.update_policy.on_file_change",
      "statement": "Any modification to a pattern YAML file MUST trigger re-vectorization of the entire pattern file and verification that all chunks were updated in core-patterns.\n",
      "enforcement": "error",
      "trigger": "pattern_file_modified",
      "action": "revectorize_entire_pattern_file",
      "validation_criteria": [
        "All chunks for the pattern are present after update",
        "Updated chunks reflect current pattern version/content"
      ]
    },
    {
      "id": "pattern_vectorization.override_policy.disallowed",
      "statement": "Overrides of constitutional patterns are NOT allowed. Any exemptions MUST be documented in the pattern file itself, not in audit code or runtime flags.\n",
      "enforcement": "error"
    },
    {
      "id": "pattern_vectorization.migration.enforcement_mode",
      "statement": "During migration, pattern violations SHOULD be reported as non-blocking; after migration completion, pattern violations MUST be blocking.\n",
      "enforcement": "warn",
      "migration_behavior": {
        "during_migration": "report_non_blocking",
        "post_migration": "block_on_violation"
      }
    }
  ],
  "vector_collection": {
    "name": "core-patterns",
    "purpose": "Semantic understanding of architectural patterns"
  },
  "validation_workflow": {
    "name": "Constitutional Pattern Validation",
    "steps": [
      {
        "id": "load_pattern",
        "action": "Load requirement chunks from core-patterns by pattern_id"
      },
      {
        "id": "query_code",
        "action": "Query knowledge graph for relevant symbols and structure"
      },
      {
        "id": "semantic_compare",
        "action": "Vector similarity + structural checks; record violations"
      },
      {
        "id": "report",
        "action": "Emit cited, actionable violation report"
      }
    ]
  },
  "implementation": {
    "phases": [
      {
        "id": "phase_1_foundation",
        "tasks": [
          "Create core-patterns Qdrant collection",
          "Implement PatternVectorizer service",
          "Vectorize existing pattern files",
          "Verify semantic retrieval"
        ]
      },
      {
        "id": "phase_2_validation",
        "tasks": [
          "Create SemanticValidator service",
          "Implement pattern-code comparison",
          "Create violation reporter",
          "Add to constitutional audit"
        ]
      },
      {
        "id": "phase_3_automation",
        "tasks": [
          "Auto-vectorize on pattern changes",
          "Real-time validation during development",
          "Suggest remediations automatically",
          "Track migration progress"
        ]
      }
    ]
  },
  "success_criteria": {
    "pattern_awareness": [
      "Answer: What does a pattern require?",
      "Answer: Which code violates a pattern?",
      "Answer: What is the migration status for a pattern?"
    ],
    "semantic_validation": [
      "Detect missing decorators",
      "Detect wrong return types",
      "Detect missing metadata",
      "Provide remediation guidance"
    ],
    "constitutional_audit": [
      "Reports pattern violations",
      "Cites specific pattern sections",
      "Findings are actionable"
    ]
  },
  "references": {
    "related_policies": [
      "knowledge_graph_integrity.yaml",
      "code_standards.yaml",
      "quality_assurance.yaml"
    ],
    "related_patterns": [
      "atomic_actions.yaml"
    ]
  }
}