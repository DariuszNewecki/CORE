# .intent/policies/intent_guard.yaml
# This is the single source of truth for low-level, machine-enforceable governance rules.

# Formal definition of enforcement levels, as recommended by external peer review.
enforcement_levels:
  hard: "Automatic rejection of the action with no override possible. The process must stop."
  soft: "A warning is logged, but the action is allowed to proceed. May be escalated."
  manual_review: "Execution is paused and requires explicit human approval via a governed mechanism (e.g., CLI prompt, signed proposal)."

rules:
  - id: immutable_constitution
    description: >
      The core mission files are immutable and can only be changed via the full,
      human-in-the-loop constitutional amendment process.
    enforcement: manual_review
    applies_to:
      paths:
        - ".intent/mission/principles.yaml"
        - ".intent/mission/manifesto.md"
        - ".intent/mission/northstar.yaml"

  - id: no_direct_intent_writes
    description: >
      Direct writes into the .intent/ directory are forbidden. All constitutional
      changes must be submitted via the proposals mechanism.
    enforcement: hard
    applies_to:
      paths:
        - ".intent/"
    exclude:
      paths:
        - ".intent/proposals/"

  - id: max_nesting_level
    description: "Code logic should not be nested more than 3 levels deep to maintain clarity."
    enforcement: soft # This is a guideline, not a hard blocker.
    applies_to:
      patterns: ["src/**/*.py"]

  - id: no_undocumented_change
    description: >
      CORE must not modify or create any file that is not traceable to a known
      capability or a file declared in a manifest.
    enforcement: hard

  - id: must_match_intent
    description: >
      All changes must be traceable to a declared high-level intent in the mission or policies.
    enforcement: soft

  - id: limit_rewrite_cycles
    description: >
      CORE may not rewrite the same file more than once per execution cycle
      without explicit validation or feedback input.
    enforcement: hard

  - id: require_tests_for_capabilities
    description: >
      All capabilities declared in the function_manifest must have at least one corresponding test in /tests.
    enforcement: soft

  - id: enforce_intent_bundle_usage
    description: >
      Any capability marked with `requires_intent_bundle: true` must be executed through an IntentBundle flow.
    enforcement: hard
