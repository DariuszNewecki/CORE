# .intent/knowledge/source_structure.yaml
#
# This document is the single source of truth for the project's architectural
# layout. It defines the domains, their responsibilities, and the rules that
# govern how they can interact. The ConstitutionalAuditor enforces these rules.

paths:
  # Defines the default directory for scaffolding new, independent applications.
  # This path is relative to the repository root.
  workspace: "work"

structure:
  - domain: core
    path: src/core
    description: "Core logic for the application server, service orchestration, and primary capabilities."
    allowed_imports:
      - core
      - shared
      - system
      - agents
      # Standard & External Libraries
      - ast
      - black
      - contextlib
      - datetime
      - dotenv
      - fastapi
      - json
      - os
      - pathlib
      - platform
      - re
      - requests
      - subprocess
      - threading
      - typing
      - uvicorn
      - uuid
      - yaml

  - domain: agents
    path: src/agents
    description: "Specialized AI actors (planners, reviewers) and their supporting models."
    allowed_imports:
      - agents
      - shared
      - system
      - core
      - tooling # <-- FIX #1: Agents are now allowed to use Tools.
      # Standard & External Libraries
      - json
      - re
      - textwrap
      - typing
      - pathlib
      - subprocess

  - domain: system
    path: src/system
    description: "Governance tooling, constitutional auditor, and the admin CLI."
    allowed_imports:
      - system
      - shared
      - core
      - tooling
      - agents # <-- FIX #2: The System (CLI) is now allowed to use Agents.
      # Standard & External Libraries
      - ast
      - collections
      - dataclasses
      - json
      - logging
      - pathlib
      - re
      - rich
      - sys
      - typing
      - yaml

  - domain: shared
    path: src/shared
    description: "Shared utilities, data models, and configuration loaders accessible by all domains."
    allowed_imports:
      - shared
      # Standard & External Libraries
      - ast
      - json
      - jsonschema
      - logging
      - os
      - pathlib
      - typing
      - yaml

  - domain: tooling
    path: src/system/tools
    description: "Internal introspection and self-analysis utilities (e.g., KnowledgeGraphBuilder)."
    allowed_imports:
      - tooling
      - system
      - shared
      - core
      # Standard & External Libraries
      - ast
      - dataclasses
      - json
      - logging
      - pathlib
      - typing

  # --- Placeholder Domains for future expansion ---
  - domain: data
    path: src/data
    description: "Data access layers, storage backends, and data models."
    allowed_imports: [data, shared, typing, pathlib]

  # --- Constitutional Domains (Non-code) ---
  - domain: mission
    path: .intent/mission
    description: "CORE's declared beliefs, principles, and northstar."
    allowed_imports: []

  - domain: policies
    path: .intent/policies
    description: "Machine-readable governance rules and constraints."
    allowed_imports: []