# .intent/charter/schemas/operations/conversational_context_bundle_schema.yaml
id: schema.operations.conversational_context_bundle
version: "1.0.0"
title: "Conversational Context Bundle Schema"
description: |
  Defines the required structure for bundles produced by the Conversational
  Context Extractor (CCE). These bundles provide a tightly-scoped snapshot
  of relevant knowledge, symbols, policies, and runtime artefacts for a
  single irritation, topic, or investigation. Bundles are deterministic,
  reproducible, and governed by Mind policies.

type: object

required:
  - kind
  - version
  - id
  - created_at
  - origin
  - scope
  - symbols
  - policies

properties:

  kind:
    type: string
    enum: ["conversational_context_bundle"]
    description: "Discriminator identifying this schema."

  version:
    type: string
    description: "Schema version for forward compatibility."

  id:
    type: string
    description: "Unique ID assigned to this bundle (e.g. cc-2025-0001)."

  created_at:
    type: string
    format: datetime
    description: "ISO8601 timestamp of bundle creation."

  origin:
    type: object
    required:
      - topic
      - source
    properties:
      irritation_id:
        type: string
        nullable: true
        description: "Optional reference to a recorded irritation event."

      topic:
        type: string
        description: "Human-provided description of what triggered the need for this bundle."

      source:
        type: string
        enum:
          - human
          - test
          - check
          - agent
          - system
        description: "Who or what requested the context."

  scope:
    type: object
    required:
      - repo_root
    properties:
      repo_root:
        type: string
        description: "Absolute path to the repository root used for symbol resolution."

      main_command:
        type: string
        nullable: true
        description: "Primary CLI or workflow that produced the logs/behaviour."

      run_id:
        type: string
        nullable: true
        description: "Optional workflow run identifier for traceability."

  symbols:
    type: array
    description: "List of relevant symbols derived from the knowledge graph."
    items:
      type: object
      required:
        - name
        - file
      properties:
        name:
          type: string
          description: "Fully-qualified symbol name (e.g. shared.logger.configure_root_logger)."

        file:
          type: string
          description: "Path to file where symbol is declared."

        capability:
          type: string
          nullable: true
          description: "Declared capability ID, if applicable."

        id:
          type: string
          nullable: true
          description: "Stable symbol ID from knowledge graph."

  policies:
    type: array
    description: "Relevant constitutional policies governing this context."
    items:
      type: string
      description: "Path + anchor to policy rule (e.g. .intent/charter/policies/body_contracts.yaml#headless_body)."

  runtime_artifacts:
    type: object
    nullable: true
    description: "Optional runtime outputs relevant to understanding the irritation."
    properties:
      logs:
        type: array
        nullable: true
        items:
          type: object
          properties:
            path:
              type: string
            excerpt:
              type: string
              description: "A shortened extract from the referenced logfile."

      audits:
        type: array
        nullable: true
        items:
          type: object
          properties:
            path:
              type: string
            summary:
              type: string
              description: "High-level audit information relevant to the irritation."

      tests:
        type: array
        nullable: true
        items:
          type: object
          properties:
            name:
              type: string
            output:
              type: string
              nullable: true
              description: "Failing test output (redacted)."

  notes:
    type: object
    nullable: true
    description: "Additional machine-generated or human-provided notes."
    properties:
      suspected_violations:
        type: array
        items:
          type: string
      remarks:
        type: string
        nullable: true
