# .intent/charter/policies/risk_classification_policy.yaml
policy_id: "e4d3c2b1-a5f9-4876-9012-34567890abcd"
id: risk_classification_policy
version: "1.0.0"
title: "Risk Classification Policy"
status: active
purpose: >
  Defines how the automated governance engine assigns risk tiers to proposals.
  These tiers determine the required quorum, verification steps, and canary strictness.
  This policy closes the gap between raw file changes and governance intent.

scope:
  applies_to: ["src/**", ".intent/**", "tests/**", "docs/**"]

owners:
  primary: "Governance Lead"
  reviewers: ["Security Lead", "Core Maintainer"]

review:
  frequency: "6 months"
  last_reviewed: "2025-11-30"

# Tiers must match the schema: routine, standard, elevated, critical
tiers:
  routine:
    score: 1
    description: "Low-risk, cosmetic, or documentation changes that do not affect system behavior."
    examples: ["Fix docstrings", "Update README", "Add logging", "Format code"]

  standard:
    score: 2
    description: "Regular functional changes within established domains and patterns."
    examples: ["Add new CLI command", "Refactor internal logic", "Update dependencies", "Add feature tests"]

  elevated:
    score: 3
    description: "Changes to core logic, governance rules, or high-impact domains."
    examples: ["Modify safety policy", "Change core orchestration", "Schema migrations", "Refactor shared services"]

  critical:
    score: 4
    description: "Existential changes to the constitution, security, or identity of the system."
    examples: ["Modify approvers", "Change immutable principles", "Emergency security fixes", "Modify critical paths"]

classification_rules:
  # --- CRITICAL RISK (Level 4) ---
  - tier: critical
    conditions:
      any_of:
        # Reference the Critical Paths Registry we created in Step 1
        - path_matches_any:
            source: ".intent/charter/constitution/critical_paths.yaml"
            rationale: "Modifying constitutionally critical paths is inherently critical."
        - path_pattern: ".intent/charter/constitution/approvers.yaml"
        - path_pattern: ".intent/charter/constitution/immutable_principles.yaml"

  # --- ELEVATED RISK (Level 3) ---
  - tier: elevated
    conditions:
      any_of:
        - path_pattern: ".intent/charter/policies/**"
        - path_pattern: "src/will/**" # Governance/Orchestration logic
        - path_pattern: "src/core/**" # Core engine logic
        - modifies_database_schema: true
        - modifies_schema: true # JSON schema changes

  # --- STANDARD RISK (Level 2) ---
  - tier: standard
    conditions:
      any_of:
        - path_pattern: "src/features/**"
        - path_pattern: "src/body/**"
        - path_pattern: "tests/**"
        - adds_new_capability: true
        - adds_dependency: true

  # --- ROUTINE RISK (Level 1) ---
  - tier: routine
    conditions:
      any_of:
        - changes_only_comments: true
        - changes_only_whitespace: true
        - path_pattern: "docs/**"
        - path_pattern: "README.md"
        - path_pattern: ".gitignore"

escalation_modifiers:
  - condition: "author_is_new_contributor"
    escalate_by: 1
    applies_when: "tier < elevated"
    rationale: "New contributors require higher scrutiny until trust is established."
    source_rule: "safety_framework.yaml#safety.no_dangerous_execution"

override:
  allowed_by: ["maintainer"]
  requires:
    - field: "justification"
      min_length: 50
    - must_match: "charter/constitution/approvers.yaml#approvers[].identity"
  audit_trail: true
  escalation_on_override:
    downgrade_requires: "critical" # Downgrading risk (e.g. Critical -> Standard) requires Critical Quorum
    upgrade_requires: "standard"   # Upgrading risk (e.g. Routine -> Standard) is easier

validation:
  - id: "enforce_tier_definitions"
    enforcement: "error"
    message: "All proposals must be classifiable into one of the defined tiers."
    links_to: "risk_classification_policy.yaml#classification_rules"
