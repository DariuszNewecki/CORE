target_path: charter/policies/code/code_style_policy.yaml
action: replace_file
justification: >
  Extend existing code_style_policy with a gentle nudge toward shared.universal
  to prevent helper-duplication (DRY, clarity_first, single_source_of_truth).
content: |
  policy_id: aaa0a228-125d-4013-bfed-c1b58cec0f66
  id: code_style_policy
  version: "1.2.0"   # â† only change: +0.0.1
  title: "Code Style Policy"
  status: active
  purpose: >
    To ensure consistent, readable code across the repository by standardizing
    tooling and expectations for contributors and agents.
  scope:
    applies_to: [code, agents, cli]
  owners:
    accountable: "Core Maintainer"
  review:
    frequency: "annual"

  rules:
    - id: style.linter_required
      statement: All changes MUST pass ruff (lint) before merge.
      enforcement: error

    - id: style.formatter_required
      statement: All changes MUST be formatted by black; CI runs black --check.
      enforcement: error

    - id: style.docstrings_public_apis
      statement: Public APIs MUST have docstrings summarizing intent and parameters; private/dunder excluded.
      enforcement: warn

    - id: style.import_order
      statement: Imports MUST follow grouping/order and avoid unused imports (enforced by linter).
      enforcement: warn

    - id: style.fail_on_style_in_ci
      statement: CI MUST fail on style or lint violations (no auto-fixing in CI).
      enforcement: error

    - id: style.capability_id_placement
      statement: "Only primary public symbols (top-level functions and classes) that represent a distinct, governable capability require an '# ID:' tag. Internal methods, properties, and private symbols SHOULD NOT be tagged."
      enforcement: warn

    - id: style.universal_helper_first
      statement: |
        Before creating any new helper function, check shared.universal.
        If a function with identical intent exists, you MUST reuse it.
        If a near-match exists, you MUST extend shared.universal via micro-proposal instead of duplicating logic.
      enforcement: warn
