policy_id: 17725f7a-25e0-4747-85c4-8d98ea03310e
id: refactoring_patterns_policy
version: "1.0.0"
title: "Refactoring Patterns Policy"
status: active
purpose: >
  Provide safe, repeatable refactoring patterns for agents and developers to
  reduce risk during structural changes.
scope:
  applies_to: [code, agents, cli]
owners:
  primary: "Core Maintainer"
  reviewers: ["Governance Lead"]
review:
  frequency: "12 months"

patterns:
  - id: extract_function
    description: Move a coherent block of logic into a new function with a clear name and docstring.
    guardrails:
      - must_keep_behavior: true
      - add_unit_tests: true
      - run_audit: true

  - id: extract_module
    description: Move related functions/classes into a new module; update imports and domain boundaries.
    guardrails:
      - must_keep_behavior: true
      - update_import_map: true
      - run_audit: true

  - id: introduce_facade
    description: Add a facade/API layer to hide complexity behind a small, stable surface.
    guardrails:
      - document_contract: true
      - avoid_breaking_changes: true
      - run_audit: true

rules:
  - id: refactor.requires_tests
    statement: Any refactor that changes public behavior MUST include tests or proof of equivalence.
    enforcement: error
  - id: refactor.update_capabilities
    statement: When moving symbols, update capability tags and manifests accordingly.
    enforcement: warn
  - id: refactor.audit_after
    statement: A constitutional audit MUST run after refactors before merge.
    enforcement: error

checklist:
  - Confirm chosen patternâ€™s guardrails are satisfied.
  - Validate imports/domains after moves (no boundary violations).
  - Run tests + audit and attach results to the change.