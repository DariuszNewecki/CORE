policy_id: 1fb8949c-02db-486a-8b9d-556191456de3
id: database_policy
version: "3.0.0" # Major version bump for SSOT mandate
title: "Consolidated Database Governance Policy"
purpose: >
  Provide a durable, auditable ledger of what actually happened in CORE (events, audits, CLI runs, capability history)
  with the database as the single source of operational truth for all runtime configuration and knowledge.
scope:
  applies_to: [postgresql]
owners:
  primary: "Security Lead"
  reviewers: ["Governance Lead"]
review:
  frequency: "12 months"
engine:
  type: postgresql
  schema: core
migrations:
  directory: sql
  order:
    - "001_init.sql"
    - "002_catalog.sql"
    - "002_capability_domains.sql"
    - "003_implementations.sql"
    - "003_capability_domains_idx.sql"
    - "004_refactor_to_symbols.sql"
    - "005_add_symbol_key.sql"
    - "006_knowledge_graph_view.sql"
    - "007_capabilities_registry.sql"
    - "008_operational_tables.sql"
    - "009_domain_and_vector_tables.sql"
rules:
  - id: db.mind_remains_source
    statement: "`.intent/**` is the single source of constitutional truth; DB is the authoritative source for operational data."
    enforcement: error
  - id: db.schema_declared
    statement: "All tables and columns MUST be declared in the database schema/migrations and validated at CI time."
    enforcement: error
  - id: db.migrations_logged
    statement: "Schema migrations MUST have an id, description, created_at, and approver recorded in the repo."
    enforcement: warn
  - id: db.write_via_governed_cli
    statement: "All writes MUST originate from registered CLI commands (see CLI Governance Policy)."
    enforcement: error
  - id: db.domains_in_db
    statement: "Capability domains MUST be stored in and queried from the database, with `.intent/mind/knowledge/domains.yaml` as a read-only export."
    enforcement: error
  - id: db.vector_index_in_db
    statement: "Vector index data MUST be stored in the database with metadata for EMBED_MODEL_REVISION and LOCAL_EMBEDDING_DIM, with file-based indices as read-only exports."
    enforcement: error
  - id: db.privacy.no_pii_or_secrets
    statement: "Personal data and secrets MUST NOT be stored in operational tables unless explicitly exempted."
    enforcement: error
  - id: db.privacy.masking
    statement: "Logs and audit records MUST redact tokens, keys, and secrets before persistence."
    enforcement: error
  - id: db.privacy.access_least_privilege
    statement: "Access to operational data MUST follow least-privilege via roles/groups."
    enforcement: warn

  # --- START OF NEW SSOT MANDATES ---
  - id: db.cli_registry_in_db
    statement: "The canonical list of CLI commands MUST be stored in and queried from the database. `.intent/mind/knowledge/cli_registry.yaml` is deprecated and considered a read-only export."
    enforcement: error
  - id: db.llm_resources_in_db
    statement: "The manifest of available LLM resources MUST be stored in and queried from the database. `.intent/mind/knowledge/resource_manifest.yaml` is deprecated and considered a read-only export."
    enforcement: error
  - id: db.cognitive_roles_in_db
    statement: "The definition of cognitive roles MUST be stored in and queried from the database. `.intent/mind/knowledge/cognitive_roles.yaml` is deprecated and considered a read-only export."
    enforcement: error
  # --- END OF NEW SSOT MANDATES ---

retention:
  audit_runs_days: 180
  cli_runs_days: 90
  capability_history_days: 365
  proposals_days: 1095
drift:
  development: warn
  production: block
backup_restore:
  cadence: daily
  test_restore_quarterly: true
quorum:
  changes_require_critical_paths: true