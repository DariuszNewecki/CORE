# .intent/charter/constitution/META-SCHEMA.yaml
id: constitution_meta_schema
version: "3.0.0"
title: "Constitutional Document Meta-Schema"
type: "meta_constitutional_schema"
status: active

owners:
  accountable: "Governance Lead"
  responsible:
    - "Core Maintainer"

review:
  frequency: "12 months"

schema_id: "constitution.meta"

description: |
  Defines the canonical structure ALL constitutional documents must follow.
  Every .intent/charter/constitution/*.yaml file is validated against this schema.

canonical_document_structure:
  description: "Every constitutional document follows this exact structure"

  required_fields:
    - version
    - type
    - domain
    - principles

  optional_fields:
    - metadata
    - references

  max_nesting_depth: 5

  template: |
    version: "X.Y.Z"
    type: "constitutional_<domain>"
    domain: "authority|boundaries|risk|enforcement"

    principles:
      <principle_id>:
        statement: "..."
        rationale: "..."
        scope:
          - "path_pattern|action_type"
        enforcement:
          method: "validator_function"
          parameters: {}

principle_schema:
  description: "Every principle follows this structure"

  principle_id:
    format: "lowercase_snake_case"
    pattern: "^[a-z][a-z0-9_]*$"
    examples:
      - "database_ssot"
      - "human_approval_required"
      - "audit_all_actions"

  statement:
    type: "string"
    description: "Clear, imperative declaration of the rule"
    max_length: 200
    required: true
    examples:
      - "The database is the single source of truth"
      - "Critical paths require human approval before modification"
      - "All autonomous actions must be logged"

  rationale:
    type: "string"
    description: "Why this principle exists (for human understanding)"
    max_length: 500
    required: true
    examples:
      - "Prevents split-brain scenarios and ensures state consistency"
      - "Maintains human authority over system architecture"

  scope:
    type: "list[string]"
    description: "Where this principle applies (paths, actions, contexts)"
    required: true
    min_items: 1
    examples:
      - ["src/body/core/database.py", "alembic/versions/*"]
      - ["schema_migration", "config_change"]
      - ["elevated_risk", "critical_risk"]

  enforcement:
    type: "object"
    description: "How to validate compliance with this principle"
    required: true
    required_fields:
      - method
      - parameters

    method:
      type: "string"
      description: "Validation mechanism to use"
      allowed_values:
        - "path_match"
        - "action_classification"
        - "boundary_check"
        - "risk_calculation"
        - "audit_verification"
        - "architectural_validation"
        - "layer_boundary_check"
        - "pre_execution_validation"
        - "audit_logging"
        - "execution_context_check"
        - "storage_policy"

validation_rules:
  structural:
    - "All documents must have required fields: version, type, domain, principles"
    - "principles must be a dict, not a list"
    - "Each principle must have: statement, rationale, scope, enforcement"
    - "Maximum nesting depth is defined by max_nesting_depth"
    - "No arbitrary keys allowed outside optional_fields"
    - "principle_id must match pattern defined in principle_schema"

  semantic:
    - "principle_id must be unique within document"
    - "scope must contain at least one item"
    - "enforcement.method must be from allowed_values list"
    - "enforcement.parameters must be a non-empty object"
    - "statement length must not exceed max_length"
    - "rationale length must not exceed max_length"

  cross_document:
    - "Referenced documents in references field must exist"
    - "Referenced principles must exist in target documents"
    - "domain field must match one of defined document_types"
    - "type field should match type_prefix for domain"

document_types:
  authority:
    description: "Defines who may decide what, and under which conditions"
    domain: "authority"
    type_prefix: "constitutional_authority"
    principle_categories:
      - human_approval_required
      - autonomous_allowed
      - conditional_autonomy

  boundaries:
    description: "Defines immutable constitutional boundaries and separation of concerns"
    domain: "boundaries"
    type_prefix: "constitutional_boundaries"
    principle_categories:
      - data_integrity
      - separation_of_concerns
      - transparency_and_auditability

  risk:
    description: "Defines risk tiers, critical paths, and gating mechanisms"
    domain: "risk"
    type_prefix: "constitutional_risk"
    principle_categories:
      - routine
      - standard
      - elevated
      - critical

  enforcement:
    description: "Defines how governance is validated and enforced"
    domain: "enforcement"
    type_prefix: "constitutional_enforcement"
    principle_categories:
      - pre_execution
      - post_execution
      - continuous
