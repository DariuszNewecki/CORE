# .intent/charter/standards/operations/operations.yaml
id: standard_operations_general
version: "1.0.0"
title: "Operations Standard â€“ General Operational Rules"
type: "standard_operations"
status: active

owners:
  accountable: "Platform SRE"
  responsible:
    - "Core Maintainer"

review:
  frequency: "12 months"

schema_id: "standard.operations.general"

policy_id: "a3e1b0c4-9f8d-4a7b-8c1d-6e5f4a3b2c1d"

purpose: >
  Unified operational policies for workflows, canary deployments, incident response,
  intent crates, and developer fastpaths.

# === INTENT CRATES (Change Management) ===
intent_crates:
  validation:
    - rule: "schema_compliance"
      description: "All crates must pass schema validation against intent_crate_schema.json."
      enforcement: error
    - rule: "canary_required"
      description: "All crates must pass a canary audit in an isolated environment before application."
      enforcement: error
  lifecycle:
    - rule: "immutable_history"
      description: "Processed crates must be moved to accepted/rejected and never modified in place."
      enforcement: error

# === MANDATORY INTEGRATION WORKFLOW ===
integration_workflow:
  - id: "linkage.assign_ids"
    command: "core-admin fix ids --write"
    description: "Assign stable UUIDs to new public symbols."
    continues_on_failure: false

  - id: "linkage.duplicate_ids"
    command: "core-admin fix duplicate-ids --write"
    description: "Find and resolve duplicate '# ID:' tags."
    continues_on_failure: false

  - id: "ssot.sync_knowledge"
    command: "core-admin manage database sync-knowledge --write"
    description: "Synchronize codebase state with database SSOT."
    continues_on_failure: false

  - id: "quality.test_suite"
    command: "core-admin check tests"
    description: "Run full test suite to ensure all tests pass."
    continues_on_failure: false

  - id: "quality.coverage_check"
    command: "core-admin coverage check"
    description: "Verify test coverage meets constitutional minimum (75%)."
    continues_on_failure: false

  - id: "governance.audit"
    command: "core-admin check audit"
    description: "Run full constitutional audit on new state."
    continues_on_failure: false

# === SELF-HEALING ROUTINES ===
self_healing_routines:
  - id: "style.headers"
    command: "core-admin fix headers --write"
    description: "Enforce constitutional header conventions."

  - id: "docs.docstrings"
    command: "core-admin fix docstrings --write"
    description: "Add missing docstrings to public functions."

  - id: "quality.generate_tests"
    command: "core-admin coverage remediate"
    description: "Autonomously generate tests to restore coverage compliance."
    trigger: "coverage < 75%"

# === CANARY DEPLOYMENTS ===
canary:
  enabled: true
  scope:
    paths:
      - "src/**"
      - "cli/**"
      - "agents/**"
    modes:
      - "development"
      - "staging"

  abort_conditions:
    - "audit:level=error"
    - "tests:failed>0"
    - "latency:p95>threshold"

  metrics:
    - name: "audit.errors"
      threshold: 0
      direction: "less"
    - name: "tests.failed"
      threshold: 0
      direction: "less"

# === DEVELOPER FASTPATH ===
dev_fastpath:
  thresholds:
    max_changed_files: 20
    allow_intent_changes: false

  required_checks:
    - syntax
    - linter
    - formatter

  disallowed_paths:
    - ".intent/**"
    - "src/system/governance/**"

# === INCIDENT RESPONSE ===
incident_response:
  severity_levels:
    - low
    - medium
    - high
    - critical

  response_rules:
    - id: ir.triage_required
      statement: "All incidents MUST be triaged within 24h with severity and owner assigned."
      enforcement: error

    - id: ir.timeline
      statement: "Minimal timeline (what happened, when, who, evidence) MUST be recorded."
      enforcement: warn

    - id: ir.comms
      statement: "Notifications MUST be sent to maintainers for high/critical incidents."
      enforcement: warn

    - id: ir.postmortem
      statement: "High/critical incidents REQUIRE short postmortem with actions and owners."
      enforcement: warn

# === RUNTIME REQUIREMENTS ===
runtime_rules:
  - id: operations.runtime.env_vars_defined
    statement: "All environment variables marked as 'required' in the runtime_requirements policy MUST be set."
    enforcement: error
