# .intent/charter/standards/operations/secrets_management.yaml
id: standard_operations_secrets
version: "1.0.0"
title: "Operations Standard â€“ Secrets Management"
type: "standard_operations"
status: active

owners:
  accountable: "Security Lead"
  responsible:
    - "Platform SRE"

review:
  frequency: "6 months"

schema_id: "standard.operations.secrets"

purpose: >
  Defines how secrets are accessed, rotated, and injected.
  Ensures Agents never handle raw secret values in their thought processes/context.

rules:
  - id: secrets.no_raw_access
    statement: "Agents and Logs MUST NEVER contain raw secret values."
    enforcement: error
    mitigation: "Use secret references (e.g., 'env:OPENAI_API_KEY')."

  - id: secrets.provider_abstraction
    statement: "All secret access MUST go through the SecretsService abstraction."
    enforcement: error

  - id: secrets.rotation_autonomy
    statement: "Agents MAY trigger rotation but MUST NOT see the new key."
    enforcement: error

architecture:
  secret_references:
    format: "{provider}:{key_name}"
    examples:
      - "env:DATABASE_URL"
      - "vault:production/llm/openai_key"

  injection:
    mechanism: "Runtime environment injection"
    process:
      1. Agent requests task.
      2. Orchestrator identifies required capabilities.
      3. Orchestrator resolves secret references to values.
      4. Orchestrator injects values into the *process environment* of the tool.
      5. Tool reads from os.environ.
    benefit: "The LLM generating the tool call never sees the key."

  rotation_workflow:
    trigger: "AuthError detected by SelfHealingAgent."
    action: "core-admin manage secrets rotate <key_id>"
    behavior:
      - "Agent calls rotation tool."
      - "Tool contacts SecretProvider."
      - "Provider generates new key."
      - "Provider updates storage."
      - "Tool returns {ok: true, message: 'Rotated'}, NOT the key."
