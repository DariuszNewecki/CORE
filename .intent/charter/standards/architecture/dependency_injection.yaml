# .intent/charter/standards/architecture/dependency_injection.yaml
id: standard_architecture_dependency_injection
version: "1.0.0"
title: "Architecture Standard â€“ Dependency Injection"
type: "standard_architecture"
status: active

owners:
  accountable: "Architecture Owner"
  responsible:
    - "Core Maintainer"

review:
  frequency: "12 months"

schema_id: "standard.architecture.dependency_injection"

policy_id: "b9b2b1b8-4e62-4b20-8cb4-8b4f0c9d8e21"

purpose: >
  Canonical rules for dependency injection in CORE. Ensures that major services
  are wired through explicit constructors or factories, avoiding hidden globals
  and hard-coded wiring inside feature modules.

scope:
  paths:
    - "src/**/*.py"

rules:
  - id: di.no_direct_instantiation
    statement: >
      Services and features MUST NOT directly instantiate other major services.
      Dependencies MUST be injected via constructors or well-defined factories.
    enforcement: error
    scope:
      - "src/features/**/*.py"
      - "src/services/**/*.py"
    exclusions:
      - "src/body/cli/admin_cli.py"
      - "src/features/governance/runtime_validator.py"
      - "tests/**/*.py"
    forbidden_instantiations:
      - "CognitiveService"
      - "GitService"
      - "ConstitutionalAuditor"
      - "QdrantService"
      - "ActionRegistry"
      - "PlanExecutor"
      - "SelfHealingAdvisor"
      - "CapabilityInvoker"
      - "CoderAgent"

  - id: di.no_global_session_import
    statement: >
      Modules within 'features' and 'services' MUST NOT directly import
      a global `get_session` provider. Database sessions MUST be injected,
      not retrieved via global accessors.
    enforcement: error
    scope:
      - "src/features/**/*.py"
      - "src/services/repositories/**/*.py"
    forbidden_imports:
      - "services.database.session_manager.get_session"
      - "services.repositories.db.engine.get_session"

  - id: di.constructor_injection_preferred
    statement: >
      Services SHOULD receive their dependencies through the `__init__`
      constructor with clear type hints, rather than via module-level
      singletons or hidden wiring.
    enforcement: warn
    scope:
      - "src/features/**/*.py"
      - "src/services/**/*.py"
