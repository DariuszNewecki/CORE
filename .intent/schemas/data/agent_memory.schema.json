{
  "id": "schema_data_agent_memory",
  "version": "1.0.0",
  "title": "Agent Memory & Experience Schema",
  "type": "schema_data",
  "status": "active",
  "owners": {
    "accountable": "AI Architecture Lead",
    "responsible": [
      "Core Maintainer"
    ]
  },
  "review": {
    "frequency": "12 months"
  },
  "schema_id": "schema.data.agent_memory",
  "description": "Defines the schema for long-term agent memory. This allows agents to retrieve past \"Episodes\" (attempts at tasks) and \"Reflections\" (generalized lessons), preventing cyclical mistakes and enabling transfer learning across the swarm.\n",
  "tables": {
    "agent_episodes": {
      "description": "A specific attempt by an agent to perform a task.",
      "columns": [
        {
          "name": "id",
          "type": "uuid",
          "constraints": [
            "primary_key"
          ]
        },
        {
          "name": "task_id",
          "type": "string",
          "description": "Link to the operational task"
        },
        {
          "name": "agent_id",
          "type": "string",
          "description": "The agent instance/class that performed the action"
        },
        {
          "name": "context_packet_id",
          "type": "uuid",
          "description": "Link to the input context used"
        },
        {
          "name": "outcome",
          "type": "string",
          "constraints": [
            {
              "check_enum": "success"
            },
            "failure",
            "partial"
          ]
        },
        {
          "name": "duration_ms",
          "type": "integer"
        },
        {
          "name": "created_at",
          "type": "timestamptz"
        }
      ]
    },
    "agent_decisions": {
      "description": "Granular steps taken within an episode.",
      "columns": [
        {
          "name": "id",
          "type": "uuid",
          "constraints": [
            "primary_key"
          ]
        },
        {
          "name": "episode_id",
          "type": "uuid",
          "constraints": [
            {
              "foreign_key": "agent_episodes.id"
            }
          ]
        },
        {
          "name": "tool_name",
          "type": "string"
        },
        {
          "name": "reasoning_trace",
          "type": "jsonb",
          "description": "The chain-of-thought leading to this decision"
        },
        {
          "name": "tool_output_summary",
          "type": "text",
          "description": "Summarized result of the tool invocation"
        }
      ]
    },
    "agent_reflections": {
      "description": "Generalized lessons learned from one or more episodes.",
      "columns": [
        {
          "name": "id",
          "type": "uuid",
          "constraints": [
            "primary_key"
          ]
        },
        {
          "name": "source_episode_ids",
          "type": "jsonb",
          "description": "Array of episode IDs that triggered this reflection"
        },
        {
          "name": "topic",
          "type": "string",
          "description": "The capability or domain this reflection applies to"
        },
        {
          "name": "insight",
          "type": "text",
          "description": "The learned lesson (e.g., 'Do not use regex for HTML')"
        },
        {
          "name": "confidence_score",
          "type": "float",
          "description": "0.0 to 1.0 rating of insight reliability"
        },
        {
          "name": "created_at",
          "type": "timestamptz"
        }
      ]
    }
  },
  "vector_integration": {
    "reflections": {
      "collection": "core_agent_reflections",
      "payload_fields": [
        "topic",
        "insight",
        "outcome"
      ],
      "description": "Reflections are vectorized to allow retrieval by semantic similarity during planning."
    }
  }
}
