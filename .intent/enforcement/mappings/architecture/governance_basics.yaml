# .intent/enforcement/mappings/architecture/governance_basics.yaml
#
# Governance enforcement mappings for constitutional compliance

mappings:
  # 1. Protection of the Constitution itself
  governance.constitution.read_only:
    engine: glob_gate
    params:
      patterns_prohibited:
        - .intent/constitution/**
    scope:
      applies_to:
        - src/**/*.py

  # 2. THE BLOCKING LAW: Logic mutations must be governed.
  # This list EXCLUDES components that are allowed to use direct writes.
  governance.logic_mutation.governed:
    engine: ast_gate
    params:
      check_type: no_direct_writes
    scope:
      applies_to:
        - "src/**/*.py"
      excludes:
        # --- THE BOOTSTRAP: Infrastructure that enables governance ---
        # These components implement the governed surface itself and must
        # operate before governance is active (Load Phase)
        - "src/shared/infrastructure/storage/file_handler.py" # IS the governed surface
        - "src/shared/path_utils.py" # Path resolution utilities
        - "src/body/services/crate_processing_service.py" # Crate generation infrastructure
        - "src/mind/governance/runtime_validator.py" # Validation infrastructure
        - "src/shared/infrastructure/validation/ruff_linter.py" # Linting infrastructure

        # --- THE PROTECTED ZONE: Reporting & Metadata ---
        # These components generate reports/artifacts and are governed by
        # governance.artifact_mutation.traceable (reporting-level enforcement)
        - "src/body/cli/commands/governance.py"
        - "src/body/cli/logic/db.py"
        - "src/body/cli/logic/cli_utils.py"
        - "src/body/cli/logic/byor.py"
        - "src/features/introspection/**"
        - "src/mind/governance/constitutional_monitor.py"
        - "src/mind/governance/key_management_service.py"
        - "src/features/maintenance/scripts/context_export.py"

        # --- AUTONOMOUS CODE: Now enforced (no exclusions) ---
        # Self-healing modules MUST route writes through FileHandler
        # Violations will be detected and must be fixed in P3

  # 3. THE REPORTING LAW: Artifacts should use FileHandler.
  # This rule issues WARNINGS for the files in THE PROTECTED ZONE.
  governance.artifact_mutation.traceable:
    engine: ast_gate
    params:
      check_type: no_direct_writes
    scope:
      applies_to:
        - "src/body/cli/commands/governance.py"
        - "src/body/cli/logic/**"
        - "src/features/introspection/**"
        - "src/mind/governance/constitutional_monitor.py"
        - "src/mind/governance/key_management_service.py"
        - "src/features/self_healing/coverage_watcher.py"
        - "src/features/self_healing/full_project_remediation.py"
        - "src/features/maintenance/scripts/context_export.py"

  governance.no_governance_bypass:
    engine: ast_gate
    params:
      check_type: forbidden_primitives
      forbidden:
        - "IntentGuard(bypass=True)"
        - "bypass_governance"
        - "disable_governance"

  governance.dangerous_execution_primitives:
    engine: ast_gate
    params:
      check_type: forbidden_primitives
      forbidden:
        - "eval"
        - "exec"
        - "compile"
        - "os.system"
        - "subprocess.Popen"
        - "subprocess.call"
        - "subprocess.run"
        - "os.getenv"
        - "os.environ"
  scope:
    applies_to:
      - "src/**/*.py"
    excludes:
      - "src/shared/logger.py"
      - "src/shared/config.py"
      - "tests/**"

  governance.intent_meta.required:
    engine: glob_gate
    params:
      check_type: path_match
      patterns:
        - ".intent/META/GLOBAL-DOCUMENT-META-SCHEMA.json"
    scope:
      applies_to:
        - ".intent/META/GLOBAL-DOCUMENT-META-SCHEMA.json"
