# tests/fixtures/a2_validation_tasks.yaml
# Phase 0: A2 Capability Validation Task Definitions
#
# These tasks test if CoderAgentV0 can generate constitutionally-compliant code
# using only existing CORE infrastructure (no semantic enhancements yet).
#
# Success Thresholds:
# - Constitutional Compliance: ≥70% (syntax + docstrings + type hints)
# - Semantic Placement: ≥80% (correct module)
# - Execution Success: ≥50% (code runs)

version: "1.0"
created: "2024-11-25"
purpose: "Validate core A2 capability before building semantic infrastructure"

tasks:
  # =========================================================================
  # SIMPLE TASKS (3 tasks)
  # - Single function utilities
  # - Clear, well-defined behavior
  # - Minimal dependencies
  # =========================================================================

  - id: "util_markdown_headers"
    goal: "Create a utility function that extracts all markdown headers (h1-h6) from a string and returns them as a list of tuples (level, text). The function should handle edge cases like empty strings and strings with no headers."
    expected_location: "src/shared/utils/markdown.py"
    difficulty: "simple"
    success_criteria:
      - "Function has proper docstring with examples"
      - "Uses type hints: str -> list[tuple[int, str]]"
      - "Handles edge cases (empty string, no headers)"
      - "Returns correct format: [(1, 'Header'), (2, 'Subheader')]"
    constitutional_requirements:
      - "Must have docstring"
      - "Must have type hints"
      - "Must follow clarity_first principle"

  - id: "util_json_validator"
    goal: "Create a utility function that validates if a string is valid JSON and returns a boolean. The function should safely handle malformed input without raising exceptions."
    expected_location: "src/shared/utils/json_utils.py"
    difficulty: "simple"
    success_criteria:
      - "Function signature: validate_json(input: str) -> bool"
      - "Proper error handling (no uncaught exceptions)"
      - "Clear docstring with usage examples"
      - "Type hints present"
    constitutional_requirements:
      - "Must have docstring"
      - "Must have type hints"
      - "Must handle errors gracefully (safe_by_default)"

  - id: "util_path_normalizer"
    goal: "Create a utility function that normalizes file paths by handling ~, .., relative paths, and mixed separators (/ and \\), returning an absolute Path object. Should work cross-platform."
    expected_location: "src/shared/path_utils.py"
    difficulty: "simple"
    success_criteria:
      - "Uses pathlib.Path for cross-platform compatibility"
      - "Handles ~, .., ./, and mixed separators"
      - "Returns absolute Path object"
      - "Docstring includes platform-specific notes"
    constitutional_requirements:
      - "Must have docstring"
      - "Must have type hints"
      - "Must use pathlib (CORE standard)"

  # =========================================================================
  # MEDIUM TASKS (4 tasks)
  # - Classes with methods
  # - Domain logic patterns
  # - Integration with CORE patterns
  # =========================================================================

  - id: "validator_email"
    goal: "Create an email validator class in the domain layer that validates email format using regex. The validator should return a ValidationResult dataclass with is_valid (bool) and error_message (str | None) fields."
    expected_location: "src/domain/validators/email_validator.py"
    difficulty: "medium"
    success_criteria:
      - "EmailValidator class with validate() method"
      - "Returns ValidationResult dataclass"
      - "Uses regex for email validation"
      - "Handles edge cases (empty, whitespace, invalid format)"
      - "Proper docstrings on class and methods"
    constitutional_requirements:
      - "Must follow domain layer patterns"
      - "Must have comprehensive docstrings"
      - "Must have type hints"
      - "Must use dataclass for result"

  - id: "validator_semver"
    goal: "Create a semantic version validator that checks if a string matches semver format (major.minor.patch) and can compare two semantic versions. Should return ValidationResult for validation and support comparison operators."
    expected_location: "src/domain/validators/version_validator.py"
    difficulty: "medium"
    success_criteria:
      - "SemverValidator class with validate() and compare() methods"
      - "Validates format: X.Y.Z where X, Y, Z are integers"
      - "compare() method returns -1, 0, or 1"
      - "Returns ValidationResult for validation"
      - "Comprehensive docstrings with examples"
    constitutional_requirements:
      - "Must follow domain layer patterns"
      - "Must have docstrings on all public methods"
      - "Must have complete type hints"
      - "Must handle edge cases"

  - id: "action_fix_imports"
    goal: "Create a new self-healing action handler that detects and removes unused imports in Python files. The action should follow CORE's ActionHandler pattern and integrate with the ActionRegistry."
    expected_location: "src/core/actions/healing_actions_extended.py"
    difficulty: "medium"
    success_criteria:
      - "Follows ActionHandler base class pattern"
      - "Integrates with ActionRegistry"
      - "Has proper risk_level metadata"
      - "Includes validation of target file"
      - "Returns ActionResult with success status"
    constitutional_requirements:
      - "Must follow separation_of_concerns"
      - "Must have comprehensive docstrings"
      - "Must have type hints"
      - "Must follow CORE action patterns"

  - id: "service_config_reader"
    goal: "Create a configuration reader service that loads YAML configuration files and provides type-safe access to config values. Should handle missing keys gracefully with defaults."
    expected_location: "src/services/config_reader.py"
    difficulty: "medium"
    success_criteria:
      - "ConfigReader class with get() and get_or_default() methods"
      - "Loads YAML files using CORE's yaml_processor"
      - "Returns typed values (str, int, bool, dict)"
      - "Handles missing keys without exceptions"
      - "Has comprehensive docstrings"
    constitutional_requirements:
      - "Must use existing yaml_processor"
      - "Must follow service layer patterns"
      - "Must have type hints"
      - "Must handle errors gracefully"

  # =========================================================================
  # COMPLEX TASKS (3 tasks)
  # - Multiple methods/classes
  # - Integration with multiple CORE systems
  # - Requires understanding of architecture
  # =========================================================================

  - id: "feature_code_formatter"
    goal: "Create a code formatter service in the features layer that can format Python code using Black and return a formatted result with metadata (success status, changes made, error message if failed). Should handle files that can't be formatted gracefully."
    expected_location: "src/features/formatting/formatter_service.py"
    difficulty: "complex"
    success_criteria:
      - "FormatterService class with format_code() async method"
      - "Uses Black for formatting"
      - "Returns FormatterResult dataclass with metadata"
      - "Handles formatting errors without crashing"
      - "Includes proper logging"
      - "Has comprehensive docstrings"
    constitutional_requirements:
      - "Must follow async patterns"
      - "Must use CORE's logger"
      - "Must have complete type hints"
      - "Must return structured results"
      - "Must follow features layer patterns"

  - id: "feature_diff_generator"
    goal: "Create a diff generation service that compares two strings (original and modified) and produces a unified diff output. Should handle both text and binary content indicators, and provide structured diff results."
    expected_location: "src/features/introspection/diff_service.py"
    difficulty: "complex"
    success_criteria:
      - "DiffService class with generate_diff() method"
      - "Uses difflib for unified diff"
      - "Returns DiffResult dataclass with diff text and metadata"
      - "Handles binary content appropriately"
      - "Provides line-by-line change counts"
      - "Has comprehensive docstrings with examples"
    constitutional_requirements:
      - "Must follow features layer patterns"
      - "Must use standard library (difflib)"
      - "Must have complete type hints"
      - "Must return structured results"
      - "Must have comprehensive docstrings"

  - id: "agent_validator"
    goal: "Create a validation agent in the will layer that checks if generated code follows constitutional rules. The agent should validate syntax, docstrings, type hints, and return a structured validation report with pass/fail status and specific violations found."
    expected_location: "src/will/agents/validator_agent.py"
    difficulty: "complex"
    success_criteria:
      - "ValidatorAgent class following Agent base patterns"
      - "Integrates with CognitiveService"
      - "Checks: syntax, docstrings, type hints, imports"
      - "Returns ValidationReport with detailed violations"
      - "Has async validate() method"
      - "Comprehensive docstrings on all methods"
    constitutional_requirements:
      - "Must follow Will layer Agent patterns"
      - "Must use CognitiveService for AI operations"
      - "Must have complete type hints"
      - "Must return structured results"
      - "Must follow separation_of_concerns"

# =========================================================================
# Validation Configuration
# =========================================================================
validation:
  thresholds:
    constitutional_compliance_rate: 0.70  # 70% of tasks must pass
    semantic_placement_accuracy: 0.80     # 80% must be in correct module
    execution_success_rate: 0.50          # 50% must execute without errors

  constitutional_checks:
    - "Has docstring (all functions/classes)"
    - "Has type hints (parameters and return)"
    - "Valid Python syntax"
    - "Follows CORE naming conventions"
    - "Uses appropriate imports"

  semantic_checks:
    - "File in correct layer (shared/domain/features/will)"
    - "Module matches expected location"
    - "Dependencies are appropriate for layer"

  execution_checks:
    - "Code compiles without SyntaxError"
    - "Can be imported without ImportError"
    - "No immediate runtime errors"

# =========================================================================
# Expected Difficulty Distribution
# =========================================================================
# Simple:  3 tasks (30%) - Should have ~90% success rate
# Medium:  4 tasks (40%) - Should have ~70% success rate
# Complex: 3 tasks (30%) - Should have ~50% success rate
#
# Overall expected: ~70% success rate (meeting threshold)
# =========================================================================
