{
  "id": "code.refactor",
  "version": "1.1.0",
  "title": "Refactoring Standards",
  "type": "policy",
  "schema_id": "schema.policy",
  "description": "Defines requirements for safe code restructuring and capability updates.",
  "owners": {
    "accountable": "Governance Lead",
    "responsible": [
      "Core Maintainer"
    ]
  },
  "rules": [
    {
      "id": "refactor.requires_tests",
      "rationale": "Ensures that autonomous or manual structural changes do not introduce functional regressions.",
      "enforcement": "error",
      "statement": "Any refactor that changes public behavior MUST include tests or proof of equivalence.",
      "check": {
        "engine": "workflow_gate",
        "params": {
          "check_type": "test_verification"
        }
      }
    },
    {
      "id": "refactor.update_capabilities",
      "rationale": "Maintains synchronization between the executable logic and the system's semantic memory.",
      "enforcement": "warn",
      "statement": "When moving symbols, update capability tags and manifests accordingly.",
      "check": {
        "engine": "llm_gate",
        "params": {
          "instruction": "Verify adherence to: When moving symbols, update capability tags and manifests accordingly."
        }
      }
    },
    {
      "id": "code_standards.max_file_lines",
      "rationale": "Prevents God Objects while allowing necessary complexity for system-critical orchestration and algorithmic density.",
      "enforcement": "warn",
      "statement": "Python modules MUST NOT exceed line limits based on their role: Core/Orchestration (600 lines), Features/Services (400 lines), Utilities (200 lines).",
      "check": {
        "engine": "glob_gate",
        "params": {
          "thresholds": [
            {
              "path": "src/will/orchestration/**",
              "limit": 600
            },
            {
              "path": "src/mind/logic/**",
              "limit": 600
            },
            {
              "path": "src/features/self_healing/test_generation/**",
              "limit": 500
            },
            {
              "path": "default",
              "limit": 400
            }
          ]
        }
      }
    },
    {
      "id": "code_standards.max_function_lines",
      "rationale": "Encourages decomposition of complex logic into smaller, more testable units.",
      "enforcement": "warn",
      "statement": "Functions SHOULD NOT exceed 50 lines.",
      "check": {
        "engine": "ast_gate",
        "params": {
          "check_type": "max_function_length",
          "limit": 50
        }
      }
    }
  ],
  "removed_rules": {
    "note": "The following rule was removed as a duplicate of existing workflow_gate enforcement:",
    "refactor.audit_after": "Duplicate of integration.audit_required (workflow_gate) in operations/general.json. That rule already ensures constitutional audit runs before integration/merge."
  },
  "review": {
    "frequency": "12 months"
  }
}
