(core-py3.12) lira@lira:/opt/dev/CORE$ pytest --cov=src --cov-report=term-missing
======================================================================= test session starts ========================================================================
platform linux -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- /opt/dev/CORE/.venv/bin/python
cachedir: .pytest_cache
rootdir: /opt/dev/CORE
configfile: pyproject.toml
testpaths: tests
plugins: dotenv-0.5.2, asyncio-0.23.8, anyio-4.10.0, cov-6.2.1, mock-3.14.1
asyncio: mode=Mode.AUTO
collected 650 items

tests/admin/test_guard_drift_cli.py::test_drift_analysis_clean[asyncio] PASSED                                                                               [  0%]
tests/admin/test_guard_drift_cli.py::test_drift_analysis_detects_drift[asyncio] PASSED                                                                       [  0%]
tests/admin/test_guard_drift_cli.py::test_drift_analysis_clean[trio] PASSED                                                                                  [  0%]
tests/admin/test_guard_drift_cli.py::test_drift_analysis_detects_drift[trio] PASSED                                                                          [  0%]
tests/api/test_knowledge_api.py::test_list_capabilities_endpoint PASSED                                                                                      [  0%]
tests/body/actions/test_code_actions.py::test_get_symbol_start_end_lines_found PASSED                                                                        [  0%]
tests/body/actions/test_code_actions.py::test_get_symbol_start_end_lines_not_found PASSED                                                                    [  1%]
tests/body/actions/test_code_actions.py::test_replace_symbol_in_code_success PASSED                                                                          [  1%]
tests/body/actions/test_code_actions.py::test_replace_symbol_in_code_symbol_not_found PASSED                                                                 [  1%]
tests/body/actions/test_code_actions.py::test_replace_symbol_in_code_invalid_syntax PASSED                                                                   [  1%]
tests/body/actions/test_code_actions.py::test_create_file_success PASSED                                                                                     [  1%]
tests/body/actions/test_code_actions.py::test_create_file_missing_params_raises PASSED                                                                       [  1%]
tests/body/actions/test_code_actions.py::test_create_file_exists_raises PASSED                                                                               [  2%]
tests/body/actions/test_code_actions.py::test_create_file_validation_fails PASSED                                                                            [  2%]
tests/body/actions/test_code_actions.py::test_edit_file_success PASSED                                                                                       [  2%]
tests/body/actions/test_code_actions.py::test_edit_file_missing_params PASSED                                                                                [  2%]
tests/body/actions/test_code_actions.py::test_edit_file_not_exists PASSED                                                                                    [  2%]
tests/body/actions/test_code_actions.py::test_edit_file_validation_dirty PASSED                                                                              [  2%]
tests/body/actions/test_code_actions.py::test_edit_function_success PASSED                                                                                   [  2%]
tests/body/actions/test_code_actions.py::test_edit_function_missing_params PASSED                                                                            [  3%]
tests/body/actions/test_code_actions.py::test_edit_function_file_not_found PASSED                                                                            [  3%]
tests/body/actions/test_code_actions.py::test_edit_function_validation_dirty PASSED                                                                          [  3%]
tests/body/actions/test_code_actions.py::test_edit_function_symbol_not_found PASSED                                                                          [  3%]
tests/body/cli/commands/test_fix.py::TestSecretManager::test_init PASSED                                                                                     [  3%]
tests/body/cli/commands/test_fix.py::TestSecretManager::test_encrypt_value FAILED                                                                            [  3%]
tests/body/cli/commands/test_fix.py::TestSecretManager::test_decrypt_value FAILED                                                                            [  4%]
tests/body/cli/commands/test_fix.py::TestSecretManager::test_validate_secret_name_valid FAILED                                                               [  4%]
tests/body/cli/commands/test_fix.py::TestSecretManager::test_validate_secret_name_invalid FAILED                                                             [  4%]
tests/body/cli/commands/test_fix.py::TestSecretManager::test_set_secret FAILED                                                                               [  4%]
tests/body/cli/commands/test_fix.py::TestSecretManager::test_get_secret FAILED                                                                               [  4%]
tests/body/cli/commands/test_fix.py::TestSecretManager::test_delete_secret FAILED                                                                            [  4%]
tests/body/cli/commands/test_fix.py::TestSecretManager::test_list_secrets FAILED                                                                             [  4%]
tests/body/cli/commands/test_fix.py::TestSecretManager::test_rotate_secret FAILED                                                                            [  5%]
tests/body/cli/commands/test_fix.py::TestSecretManager::test_export_secrets FAILED                                                                           [  5%]
tests/body/cli/commands/test_fix.py::TestSecretManager::test_import_secrets FAILED                                                                           [  5%]
tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_list_secrets_command FAILED                                                                        [  5%]
tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_list_secrets_empty FAILED                                                                          [  5%]
tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_get_secret_command FAILED                                                                          [  5%]
tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_get_secret_not_found FAILED                                                                        [  6%]
tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_set_secret_command FAILED                                                                          [  6%]
tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_set_secret_invalid_name FAILED                                                                     [  6%]
tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_set_secret_with_prompt PASSED                                                                      [  6%]
tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_delete_secret_command FAILED                                                                       [  6%]
tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_delete_secret_cancelled FAILED                                                                     [  6%]
tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_rotate_secrets_command FAILED                                                                      [  6%]
tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_export_secrets_command FAILED                                                                      [  7%]
tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_export_secrets_encrypted FAILED                                                                    [  7%]
tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_import_secrets_command FAILED                                                                      [  7%]
tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_import_secrets_overwrite FAILED                                                                    [  7%]
tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_verify_encryption_command FAILED                                                                   [  7%]
tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_verify_encryption_failed FAILED                                                                    [  7%]
tests/body/cli/commands/test_fix.py::TestSecretStorage::test_save_secret FAILED                                                                              [  8%]
tests/body/cli/commands/test_fix.py::TestSecretStorage::test_get_secret FAILED                                                                               [  8%]
tests/body/cli/commands/test_fix.py::TestSecretStorage::test_get_secret_not_found FAILED                                                                     [  8%]
tests/body/cli/commands/test_fix.py::TestSecretStorage::test_delete_secret FAILED                                                                            [  8%]
tests/body/cli/commands/test_fix.py::TestSecretStorage::test_list_all_secrets FAILED                                                                         [  8%]
tests/body/cli/commands/test_fix.py::TestSecretStorage::test_get_all_secrets FAILED                                                                          [  8%]
tests/body/cli/commands/test_fix.py::TestSecretStorage::test_update_secret FAILED                                                                            [  8%]
tests/body/cli/commands/test_fix.py::TestSecretStorage::test_exists FAILED                                                                                   [  9%]
tests/body/cli/commands/test_fix.py::TestSecretValidation::test_validate_encryption_key PASSED                                                               [  9%]
tests/body/cli/commands/test_fix.py::TestSecretValidation::test_validate_secret_value PASSED                                                                 [  9%]
tests/body/cli/commands/test_fix.py::TestSecretValidation::test_sanitize_secret_name PASSED                                                                  [  9%]
tests/body/cli/commands/test_fix.py::TestErrorHandling::test_database_connection_error FAILED                                                                [  9%]
tests/body/cli/commands/test_fix.py::TestErrorHandling::test_encryption_error FAILED                                                                         [  9%]
tests/body/cli/commands/test_fix.py::TestErrorHandling::test_json_parse_error FAILED                                                                         [ 10%]
tests/body/cli/commands/test_fix.py::TestIntegration::test_full_secret_lifecycle FAILED                                                                      [ 10%]
tests/body/cli/commands/test_fix.py::TestIntegration::test_export_import_roundtrip FAILED                                                                    [ 10%]
tests/body/cli/commands/test_secrets.py::TestSecretManager::test_init PASSED                                                                                 [ 10%]
tests/body/cli/commands/test_secrets.py::TestSecretManager::test_encrypt_value FAILED                                                                        [ 10%]
tests/body/cli/commands/test_secrets.py::TestSecretManager::test_decrypt_value FAILED                                                                        [ 10%]
tests/body/cli/commands/test_secrets.py::TestSecretManager::test_validate_secret_name_valid FAILED                                                           [ 10%]
tests/body/cli/commands/test_secrets.py::TestSecretManager::test_validate_secret_name_invalid FAILED                                                         [ 11%]
tests/body/cli/commands/test_secrets.py::TestSecretManager::test_set_secret FAILED                                                                           [ 11%]
tests/body/cli/commands/test_secrets.py::TestSecretManager::test_get_secret FAILED                                                                           [ 11%]
tests/body/cli/commands/test_secrets.py::TestSecretManager::test_delete_secret FAILED                                                                        [ 11%]
tests/body/cli/commands/test_secrets.py::TestSecretManager::test_list_secrets FAILED                                                                         [ 11%]
tests/body/cli/commands/test_secrets.py::TestSecretManager::test_rotate_secret FAILED                                                                        [ 11%]
tests/body/cli/commands/test_secrets.py::TestSecretManager::test_export_secrets FAILED                                                                       [ 12%]
tests/body/cli/commands/test_secrets.py::TestSecretManager::test_import_secrets FAILED                                                                       [ 12%]
tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_list_secrets_command FAILED                                                                    [ 12%]
tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_list_secrets_empty FAILED                                                                      [ 12%]
tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_get_secret_command FAILED                                                                      [ 12%]
tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_get_secret_not_found FAILED                                                                    [ 12%]
tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_set_secret_command FAILED                                                                      [ 12%]
tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_set_secret_invalid_name FAILED                                                                 [ 13%]
tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_set_secret_with_prompt PASSED                                                                  [ 13%]
tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_delete_secret_command FAILED                                                                   [ 13%]
tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_delete_secret_cancelled FAILED                                                                 [ 13%]
tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_rotate_secrets_command FAILED                                                                  [ 13%]
tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_export_secrets_command FAILED                                                                  [ 13%]
tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_export_secrets_encrypted FAILED                                                                [ 14%]
tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_import_secrets_command FAILED                                                                  [ 14%]
tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_import_secrets_overwrite FAILED                                                                [ 14%]
tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_verify_encryption_command FAILED                                                               [ 14%]
tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_verify_encryption_failed FAILED                                                                [ 14%]
tests/body/cli/commands/test_secrets.py::TestSecretStorage::test_save_secret FAILED                                                                          [ 14%]
tests/body/cli/commands/test_secrets.py::TestSecretStorage::test_get_secret FAILED                                                                           [ 14%]
tests/body/cli/commands/test_secrets.py::TestSecretStorage::test_get_secret_not_found FAILED                                                                 [ 15%]
tests/body/cli/commands/test_secrets.py::TestSecretStorage::test_delete_secret FAILED                                                                        [ 15%]
tests/body/cli/commands/test_secrets.py::TestSecretStorage::test_list_all_secrets FAILED                                                                     [ 15%]
tests/body/cli/commands/test_secrets.py::TestSecretStorage::test_get_all_secrets FAILED                                                                      [ 15%]
tests/body/cli/commands/test_secrets.py::TestSecretStorage::test_update_secret FAILED                                                                        [ 15%]
tests/body/cli/commands/test_secrets.py::TestSecretStorage::test_exists FAILED                                                                               [ 15%]
tests/body/cli/commands/test_secrets.py::TestSecretValidation::test_validate_encryption_key PASSED                                                           [ 16%]
tests/body/cli/commands/test_secrets.py::TestSecretValidation::test_validate_secret_value PASSED                                                             [ 16%]
tests/body/cli/commands/test_secrets.py::TestSecretValidation::test_sanitize_secret_name PASSED                                                              [ 16%]
tests/body/cli/commands/test_secrets.py::TestErrorHandling::test_database_connection_error FAILED                                                            [ 16%]
tests/body/cli/commands/test_secrets.py::TestErrorHandling::test_encryption_error FAILED                                                                     [ 16%]
tests/body/cli/commands/test_secrets.py::TestErrorHandling::test_json_parse_error FAILED                                                                     [ 16%]
tests/body/cli/commands/test_secrets.py::TestIntegration::test_full_secret_lifecycle FAILED                                                                  [ 16%]
tests/body/cli/commands/test_secrets.py::TestIntegration::test_export_import_roundtrip FAILED                                                                [ 17%]
tests/body/cli/test_admin_cli.py::TestAdminCLI::test_admin_cli_help FAILED                                                                                   [ 17%]
tests/body/cli/test_admin_cli.py::TestAdminCLI::test_admin_cli_version FAILED                                                                                [ 17%]
tests/body/cli/test_admin_cli.py::TestAdminCLI::test_admin_cli_no_command FAILED                                                                             [ 17%]
tests/body/cli/test_admin_cli.py::TestStatusCommand::test_status_basic FAILED                                                                                [ 17%]
tests/body/cli/test_admin_cli.py::TestStatusCommand::test_status_detailed FAILED                                                                             [ 17%]
tests/body/cli/test_admin_cli.py::TestStatusCommand::test_status_json_format FAILED                                                                          [ 18%]
tests/body/cli/test_admin_cli.py::TestStatusCommand::test_status_yaml_format FAILED                                                                          [ 18%]
tests/body/cli/test_admin_cli.py::TestStatusCommand::test_status_connection_error FAILED                                                                     [ 18%]
tests/body/cli/test_admin_cli.py::TestAuditCommand::test_audit_all FAILED                                                                                    [ 18%]
tests/body/cli/test_admin_cli.py::TestAuditCommand::test_audit_specific_check FAILED                                                                         [ 18%]
tests/body/cli/test_admin_cli.py::TestAuditCommand::test_audit_multiple_checks FAILED                                                                        [ 18%]
tests/body/cli/test_admin_cli.py::TestAuditCommand::test_audit_fix_flag FAILED                                                                               [ 18%]
tests/body/cli/test_admin_cli.py::TestAuditCommand::test_audit_strict_mode FAILED                                                                            [ 19%]
tests/body/cli/test_admin_cli.py::TestAuditCommand::test_audit_output_file FAILED                                                                            [ 19%]
tests/body/cli/test_admin_cli.py::TestAuditCommand::test_audit_list_available FAILED                                                                         [ 19%]
tests/body/cli/test_admin_cli.py::TestRemediateCommand::test_remediate_all FAILED                                                                            [ 19%]
tests/body/cli/test_admin_cli.py::TestRemediateCommand::test_remediate_specific_type FAILED                                                                  [ 19%]
tests/body/cli/test_admin_cli.py::TestRemediateCommand::test_remediate_coverage FAILED                                                                       [ 19%]
tests/body/cli/test_admin_cli.py::TestRemediateCommand::test_remediate_dry_run FAILED                                                                        [ 20%]
tests/body/cli/test_admin_cli.py::TestRemediateCommand::test_remediate_interactive PASSED                                                                    [ 20%]
tests/body/cli/test_admin_cli.py::TestRemediateCommand::test_remediate_with_ai FAILED                                                                        [ 20%]
tests/body/cli/test_admin_cli.py::TestRemediateCommand::test_remediate_target_coverage FAILED                                                                [ 20%]
tests/body/cli/test_admin_cli.py::TestSyncCommand::test_sync_all FAILED                                                                                      [ 20%]
tests/body/cli/test_admin_cli.py::TestSyncCommand::test_sync_database_only FAILED                                                                            [ 20%]
tests/body/cli/test_admin_cli.py::TestSyncCommand::test_sync_vectorstore_only FAILED                                                                         [ 20%]
tests/body/cli/test_admin_cli.py::TestSyncCommand::test_sync_knowledge_graph FAILED                                                                          [ 21%]
tests/body/cli/test_admin_cli.py::TestSyncCommand::test_sync_force_rebuild FAILED                                                                            [ 21%]
tests/body/cli/test_admin_cli.py::TestSyncCommand::test_sync_verify FAILED                                                                                   [ 21%]
tests/body/cli/test_admin_cli.py::TestInitCommand::test_init_new_project FAILED                                                                              [ 21%]
tests/body/cli/test_admin_cli.py::TestInitCommand::test_init_existing_directory FAILED                                                                       [ 21%]
tests/body/cli/test_admin_cli.py::TestInitCommand::test_init_with_template FAILED                                                                            [ 21%]
tests/body/cli/test_admin_cli.py::TestInitCommand::test_init_minimal FAILED                                                                                  [ 22%]
tests/body/cli/test_admin_cli.py::TestConfigCommand::test_config_list FAILED                                                                                 [ 22%]
tests/body/cli/test_admin_cli.py::TestConfigCommand::test_config_get FAILED                                                                                  [ 22%]
tests/body/cli/test_admin_cli.py::TestConfigCommand::test_config_set FAILED                                                                                  [ 22%]
tests/body/cli/test_admin_cli.py::TestConfigCommand::test_config_validate FAILED                                                                             [ 22%]
tests/body/cli/test_admin_cli.py::TestErrorHandling::test_handle_database_error FAILED                                                                       [ 22%]
tests/body/cli/test_admin_cli.py::TestErrorHandling::test_handle_permission_error FAILED                                                                     [ 22%]
tests/body/cli/test_admin_cli.py::TestErrorHandling::test_handle_keyboard_interrupt FAILED                                                                   [ 23%]
tests/body/cli/test_admin_cli.py::TestIntegration::test_full_audit_remediate_cycle PASSED                                                                    [ 23%]
tests/body/cli/test_admin_cli.py::TestIntegration::test_sync_and_verify PASSED                                                                               [ 23%]
tests/body/services/test_capabilities.py::TestCapabilities::test_introspection_success PASSED                                                                [ 23%]
tests/body/services/test_capabilities.py::TestCapabilities::test_introspection_exception_handling PASSED                                                     [ 23%]
tests/body/services/test_capabilities.py::TestCapabilities::test_introspection_return_value_consistency PASSED                                               [ 23%]
tests/body/services/test_capabilities.py::TestCapabilities::test_introspection_first_tool_fails PASSED                                                       [ 24%]
tests/body/services/test_capabilities.py::TestCapabilities::test_introspection_second_tool_fails PASSED                                                      [ 24%]
tests/body/services/test_capabilities.py::TestCapabilities::test_introspection_all_tools_fail PASSED                                                         [ 24%]
tests/body/services/test_capabilities.py::TestCapabilities::test_introspection_tool_order PASSED                                                             [ 24%]
tests/body/services/test_capabilities.py::TestCapabilities::test_main_success PASSED                                                                         [ 24%]
tests/body/services/test_capabilities.py::TestCapabilities::test_main_failure PASSED                                                                         [ 24%]
tests/body/services/test_crate_processing_service.py::TestCrate::test_crate_initialization PASSED                                                            [ 24%]
tests/body/services/test_crate_processing_service.py::TestCrateProcessingService::test_init_creates_directories PASSED                                       [ 25%]
tests/body/services/test_crate_processing_service.py::TestCrateProcessingService::test_scan_and_validate_inbox_valid_crate PASSED                            [ 25%]
tests/body/services/test_crate_processing_service.py::TestCrateProcessingService::test_scan_and_validate_inbox_missing_manifest PASSED                       [ 25%]
tests/body/services/test_crate_processing_service.py::TestCrateProcessingService::test_scan_and_validate_inbox_validation_error PASSED                       [ 25%]
tests/body/services/test_crate_processing_service.py::TestCrateProcessingService::test_copy_tree_with_ignore_patterns PASSED                                 [ 25%]
tests/body/services/test_crate_processing_service.py::TestCrateProcessingService::test_copy_file_creates_parents PASSED                                      [ 25%]
tests/body/services/test_crate_processing_service.py::TestCrateProcessingService::test_run_canary_validation_success PASSED                                  [ 26%]
tests/body/services/test_crate_processing_service.py::TestCrateProcessingService::test_run_canary_validation_failure PASSED                                  [ 26%]
tests/body/services/test_crate_processing_service.py::TestCrateProcessingService::test_apply_accepted_crate_standard_type PASSED                             [ 26%]
tests/body/services/test_crate_processing_service.py::TestCrateProcessingService::test_apply_accepted_crate_constitutional_amendment PASSED                  [ 26%]
tests/body/services/test_crate_processing_service.py::TestCrateProcessingService::test_write_result_manifest_with_string_details PASSED                      [ 26%]
tests/body/services/test_crate_processing_service.py::TestCrateProcessingService::test_write_result_manifest_with_list_details PASSED                        [ 26%]
tests/body/services/test_crate_processing_service.py::TestCrateProcessingService::test_process_pending_crates_async_no_crates PASSED                         [ 26%]
tests/body/services/test_crate_processing_service.py::TestCrateProcessingService::test_process_pending_crates_async_flow PASSED                              [ 27%]
tests/body/services/test_crate_processing_service.py::test_process_crates_function PASSED                                                                    [ 27%]
tests/core/actions/test_healing_actions_extended.py::TestFixUnusedImportsHandler::test_handler_name PASSED                                                   [ 27%]
tests/core/actions/test_healing_actions_extended.py::TestFixUnusedImportsHandler::test_execute_with_file_path PASSED                                         [ 27%]
tests/core/actions/test_healing_actions_extended.py::TestFixUnusedImportsHandler::test_execute_without_file_path PASSED                                      [ 27%]
tests/core/actions/test_healing_actions_extended.py::TestRemoveDeadCodeHandler::test_handler_name PASSED                                                     [ 27%]
tests/core/actions/test_healing_actions_extended.py::TestRemoveDeadCodeHandler::test_execute PASSED                                                          [ 28%]
tests/core/actions/test_healing_actions_extended.py::TestEnforceLineLengthHandler::test_handler_name PASSED                                                  [ 28%]
tests/core/actions/test_healing_actions_extended.py::TestEnforceLineLengthHandler::test_execute_with_file_path PASSED                                        [ 28%]
tests/core/actions/test_healing_actions_extended.py::TestEnforceLineLengthHandler::test_execute_all_files PASSED                                             [ 28%]
tests/core/actions/test_healing_actions_extended.py::TestAddPolicyIDsHandler::test_handler_name PASSED                                                       [ 28%]
tests/core/actions/test_healing_actions_extended.py::TestAddPolicyIDsHandler::test_execute PASSED                                                            [ 28%]
tests/core/actions/test_healing_actions_extended.py::TestSortImportsHandler::test_handler_name PASSED                                                        [ 28%]
tests/core/actions/test_healing_actions_extended.py::TestSortImportsHandler::test_execute PASSED                                                             [ 29%]
tests/core/agents/test_self_correction_engine.py::test_attempt_correction_success PASSED                                                                     [ 29%]
tests/core/agents/test_self_correction_engine.py::test_attempt_correction_missing_context PASSED                                                             [ 29%]
tests/core/agents/test_self_correction_engine.py::test_attempt_correction_llm_no_write_block PASSED                                                          [ 29%]
tests/core/agents/test_self_correction_engine.py::test_attempt_correction_validation_fails PASSED                                                            [ 29%]
tests/core/agents/test_self_correction_engine.py::test_attempt_correction_llm_error PASSED                                                                   [ 29%]
tests/features/governance/test_key_management_service.py::TestKeyManagementService::test_keygen_successful_generation PASSED                                 [ 30%]
tests/features/governance/test_key_management_service.py::TestKeyManagementService::test_keygen_existing_key_abort PASSED                                    [ 30%]
tests/features/governance/test_key_management_service.py::TestKeyManagementService::test_keygen_yaml_output PASSED                                           [ 30%]
tests/features/governance/test_key_management_service.py::TestKeyManagementService::test_keygen_existing_key_overwrite PASSED                                [ 30%]
tests/features/governance/test_key_management_service.py::TestKeyManagementService::test_keygen_function_signature PASSED                                    [ 30%]
tests/features/governance/test_key_management_service.py::TestKeyManagementService::test_keygen_directory_creation PASSED                                    [ 30%]
tests/features/introspection/test_capability_discovery_service.py::test_load_and_validate_success PASSED                                                     [ 30%]
tests/features/introspection/test_capability_discovery_service.py::test_load_and_validate_raises_error_on_cycle PASSED                                       [ 31%]
tests/features/introspection/test_capability_discovery_service.py::test_load_and_validate_raises_error_on_unresolved_alias PASSED                            [ 31%]
tests/features/introspection/test_capability_discovery_service.py::test_capability_registry_resolve PASSED                                                   [ 31%]
tests/features/introspection/test_capability_discovery_service.py::test_validate_agent_roles_success PASSED                                                  [ 31%]
tests/features/introspection/test_capability_discovery_service.py::test_validate_agent_roles_raises_error_on_unknown_tag PASSED                              [ 31%]
tests/features/test_actions_policy_contract.py::test_every_policy_action_has_a_registered_handler[asyncio] PASSED                                            [ 31%]
tests/features/test_actions_policy_contract.py::test_registry_exposes_only_constitutional_actions[asyncio] XFAIL (Registry contains handlers not declare...) [ 32%]
tests/features/test_actions_policy_contract.py::test_every_policy_action_has_a_registered_handler[trio] PASSED                                               [ 32%]
tests/features/test_actions_policy_contract.py::test_registry_exposes_only_constitutional_actions[trio] XFAIL (Registry contains handlers not declared i...) [ 32%]
tests/features/test_audit_unassigned_capabilities.py::TestAuditUnassignedCapabilities::test_get_unassigned_symbols_finds_matching_symbols PASSED             [ 32%]
tests/features/test_audit_unassigned_capabilities.py::TestAuditUnassignedCapabilities::test_get_unassigned_symbols_no_matches PASSED                         [ 32%]
tests/features/test_audit_unassigned_capabilities.py::TestAuditUnassignedCapabilities::test_get_unassigned_symbols_empty_symbols PASSED                      [ 32%]
tests/features/test_audit_unassigned_capabilities.py::TestAuditUnassignedCapabilities::test_get_unassigned_symbols_missing_symbols_key PASSED                [ 32%]
tests/features/test_audit_unassigned_capabilities.py::TestAuditUnassignedCapabilities::test_get_unassigned_symbols_missing_capability_field PASSED           [ 33%]
tests/features/test_audit_unassigned_capabilities.py::TestAuditUnassignedCapabilities::test_get_unassigned_symbols_missing_name_field PASSED                 [ 33%]
tests/features/test_audit_unassigned_capabilities.py::TestAuditUnassignedCapabilities::test_get_unassigned_symbols_exception_handling PASSED                 [ 33%]
tests/features/test_audit_unassigned_capabilities.py::TestAuditUnassignedCapabilities::test_get_unassigned_symbols_key_added_to_result PASSED                [ 33%]
tests/features/test_export_vectors.py::TestExportVectors::test_async_export_success PASSED                                                                   [ 33%]
tests/features/test_export_vectors.py::TestExportVectors::test_async_export_no_vectors PASSED                                                                [ 33%]
tests/features/test_export_vectors.py::TestExportVectors::test_async_export_creates_parent_directories PASSED                                                [ 34%]
tests/features/test_export_vectors.py::TestExportVectors::test_async_export_database_error PASSED                                                            [ 34%]
tests/features/test_export_vectors.py::TestExportVectors::test_export_vectors_function PASSED                                                                [ 34%]
tests/features/test_export_vectors.py::TestExportVectors::test_export_vectors_default_output PASSED                                                          [ 34%]
tests/features/test_export_vectors.py::TestExportVectors::test_async_export_json_serialization PASSED                                                        [ 34%]
tests/features/test_export_vectors.py::TestExportVectors::test_async_export_empty_payload PASSED                                                             [ 34%]
tests/features/test_generate_correction_map.py::TestGenerateCorrectionMap::test_generate_maps_success PASSED                                                 [ 34%]
tests/features/test_generate_correction_map.py::TestGenerateCorrectionMap::test_generate_maps_nonexistent_input_file PASSED                                  [ 35%]
tests/features/test_generate_correction_map.py::TestGenerateCorrectionMap::test_generate_maps_invalid_json PASSED                                            [ 35%]
tests/features/test_generate_correction_map.py::TestGenerateCorrectionMap::test_generate_maps_empty_domains PASSED                                           [ 35%]
tests/features/test_generate_correction_map.py::TestGenerateCorrectionMap::test_generate_maps_creates_output_directory PASSED                                [ 35%]
tests/features/test_generate_correction_map.py::TestGenerateCorrectionMap::test_generate_maps_complex_domains PASSED                                         [ 35%]
tests/features/test_generate_correction_map.py::TestGenerateCorrectionMap::test_generate_maps_yaml_format PASSED                                             [ 35%]
tests/features/test_generate_correction_map.py::TestGenerateCorrectionMap::test_generate_maps_default_parameters PASSED                                      [ 36%]
tests/features/test_generate_correction_map.py::TestGenerateCorrectionMap::test_generate_maps_unicode_characters PASSED                                      [ 36%]
tests/governance/test_local_mode_governance.py::test_local_fallback_requires_git_checkpoint PASSED                                                           [ 36%]
tests/integration/test_a1_autonomy_loop.py::test_fix_docstrings_autonomously PASSED                                                                          [ 36%]
tests/integration/test_full_run.py::test_list_capabilities_endpoint PASSED                                                                                   [ 36%]
tests/mind/governance/test_policy_loader.py::TestLoadPolicyYaml::test_load_valid_yaml_file PASSED                                                            [ 36%]
tests/mind/governance/test_policy_loader.py::TestLoadPolicyYaml::test_load_nonexistent_file PASSED                                                           [ 36%]
tests/mind/governance/test_policy_loader.py::TestLoadPolicyYaml::test_load_invalid_yaml_format PASSED                                                        [ 37%]
tests/mind/governance/test_policy_loader.py::TestLoadPolicyYaml::test_load_empty_yaml_file PASSED                                                            [ 37%]
tests/mind/governance/test_policy_loader.py::TestLoadPolicyYaml::test_load_yaml_with_non_dict_content PASSED                                                 [ 37%]
tests/mind/governance/test_policy_loader.py::TestLoadPolicyYaml::test_logging_on_file_not_found PASSED                                                       [ 37%]
tests/mind/governance/test_policy_loader.py::TestLoadPolicyYaml::test_logging_on_yaml_loading_error PASSED                                                   [ 37%]
tests/mind/governance/test_policy_loader.py::TestLoadAvailableActions::test_load_valid_actions_policy PASSED                                                 [ 37%]
tests/mind/governance/test_policy_loader.py::TestLoadAvailableActions::test_load_actions_policy_missing_actions PASSED                                       [ 38%]
tests/mind/governance/test_policy_loader.py::TestLoadAvailableActions::test_load_actions_policy_empty_actions PASSED                                         [ 38%]
tests/mind/governance/test_policy_loader.py::TestLoadAvailableActions::test_load_actions_policy_wrong_actions_type PASSED                                    [ 38%]
tests/mind/governance/test_policy_loader.py::TestLoadMicroProposalPolicy::test_load_valid_micro_proposal_policy PASSED                                       [ 38%]
tests/mind/governance/test_policy_loader.py::TestLoadMicroProposalPolicy::test_load_micro_proposal_policy_missing_rules PASSED                               [ 38%]
tests/mind/governance/test_policy_loader.py::TestLoadMicroProposalPolicy::test_load_micro_proposal_policy_empty_rules PASSED                                 [ 38%]
tests/mind/governance/test_policy_loader.py::TestLoadMicroProposalPolicy::test_load_micro_proposal_policy_wrong_rules_type PASSED                            [ 38%]
tests/mind/governance/test_policy_loader.py::TestPolicyLoaderIntegration::test_directory_paths_are_correct PASSED                                            [ 39%]
tests/mind/governance/test_policy_loader.py::TestPolicyLoaderIntegration::test_module_exports_correct_functions PASSED                                       [ 39%]
tests/shared/test_time.py::TestTimeModule::test_now_iso_returns_string PASSED                                                                                [ 39%]
tests/shared/test_time.py::TestTimeModule::test_now_iso_contains_iso_format_indicators PASSED                                                                [ 39%]
tests/shared/test_time.py::TestTimeModule::test_now_iso_calls_datetime_now_with_utc PASSED                                                                   [ 39%]
tests/shared/test_time.py::TestTimeModule::test_now_iso_returns_isoformat_result PASSED                                                                      [ 39%]
tests/shared/test_time.py::TestTimeModule::test_now_iso_returns_valid_iso_format PASSED                                                                      [ 40%]
tests/shared/test_time.py::TestTimeModule::test_now_iso_uses_utc_timezone PASSED                                                                             [ 40%]
tests/shared/test_time.py::TestTimeModule::test_now_iso_multiple_calls PASSED                                                                                [ 40%]
tests/shared/test_time.py::TestTimeModule::test_now_iso_no_external_dependencies PASSED                                                                      [ 40%]
tests/shared/test_time.py::TestTimeModule::test_now_iso_exception_handling PASSED                                                                            [ 40%]
tests/shared/utils/test_common_knowledge.py::TestActionName::test_action_name_returns_string PASSED                                                          [ 40%]
tests/shared/utils/test_common_knowledge.py::TestSanitizeKey::test_sanitize_key_lowercases PASSED                                                            [ 40%]
tests/shared/utils/test_common_knowledge.py::TestSanitizeKey::test_sanitize_key_replaces_special_chars_with_underscore PASSED                                [ 41%]
tests/shared/utils/test_common_knowledge.py::TestSanitizeKey::test_sanitize_key_preserves_alphanumeric PASSED                                                [ 41%]
tests/shared/utils/test_common_knowledge.py::TestSanitizeKey::test_sanitize_key_handles_mixed_case PASSED                                                    [ 41%]
tests/shared/utils/test_common_knowledge.py::TestSanitizeKey::test_sanitize_key_handles_multiple_special_chars PASSED                                        [ 41%]
tests/shared/utils/test_common_knowledge.py::TestSanitizeKey::test_sanitize_key_handles_spaces PASSED                                                        [ 41%]
tests/shared/utils/test_common_knowledge.py::TestSanitizeKey::test_sanitize_key_empty_string PASSED                                                          [ 41%]
tests/shared/utils/test_common_knowledge.py::TestNormalizeText::test_normalize_text_collapses_whitespace PASSED                                              [ 42%]
tests/shared/utils/test_common_knowledge.py::TestNormalizeText::test_normalize_text_strips_whitespace PASSED                                                 [ 42%]
tests/shared/utils/test_common_knowledge.py::TestNormalizeText::test_normalize_text_handles_tabs_and_newlines PASSED                                         [ 42%]
tests/shared/utils/test_common_knowledge.py::TestNormalizeText::test_normalize_text_empty_string PASSED                                                      [ 42%]
tests/shared/utils/test_common_knowledge.py::TestNormalizeText::test_normalize_text_only_whitespace PASSED                                                   [ 42%]
tests/shared/utils/test_common_knowledge.py::TestNormalizeText::test_normalize_text_preserves_single_spaces PASSED                                           [ 42%]
tests/shared/utils/test_crypto.py::TestGetCanonicalPayload::test_get_canonical_payload_basic_proposal PASSED                                                 [ 42%]
tests/shared/utils/test_crypto.py::TestGetCanonicalPayload::test_get_canonical_payload_missing_optional_fields PASSED                                        [ 43%]
tests/shared/utils/test_crypto.py::TestGetCanonicalPayload::test_get_canonical_payload_ignores_extra_fields PASSED                                           [ 43%]
tests/shared/utils/test_crypto.py::TestGetCanonicalPayload::test_get_canonical_payload_empty_content PASSED                                                  [ 43%]
tests/shared/utils/test_crypto.py::TestGenerateApprovalToken::test_generate_approval_token_basic PASSED                                                      [ 43%]
tests/shared/utils/test_crypto.py::TestGenerateApprovalToken::test_generate_approval_token_deterministic PASSED                                              [ 43%]
tests/shared/utils/test_crypto.py::TestGenerateApprovalToken::test_generate_approval_token_different_content_different_tokens PASSED                         [ 43%]
tests/shared/utils/test_crypto.py::TestGenerateApprovalToken::test_generate_approval_token_different_action_different_tokens PASSED                          [ 44%]
tests/shared/utils/test_crypto.py::TestGenerateApprovalToken::test_generate_approval_token_minimal_proposal PASSED                                           [ 44%]
tests/shared/utils/test_crypto.py::TestGenerateApprovalToken::test_generate_approval_token_with_none_fields PASSED                                           [ 44%]
tests/shared/utils/test_crypto.py::TestGenerateApprovalToken::test_generate_approval_token_hash_usage PASSED                                                 [ 44%]
tests/shared/utils/test_header_tools.py::TestHeaderComponents::test_default_values PASSED                                                                    [ 44%]
tests/shared/utils/test_header_tools.py::TestHeaderComponents::test_custom_values PASSED                                                                     [ 44%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsParse::test_parse_empty_source PASSED                                                                [ 44%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsParse::test_parse_only_location PASSED                                                               [ 45%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsParse::test_parse_location_and_docstring PASSED                                                      [ 45%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsParse::test_parse_with_future_import PASSED                                                          [ 45%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsParse::test_parse_with_other_imports PASSED                                                          [ 45%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsParse::test_parse_with_body PASSED                                                                   [ 45%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsParse::test_parse_multi_line_docstring PASSED                                                        [ 45%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsParse::test_parse_single_quotes_docstring PASSED                                                     [ 46%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsParse::test_parse_with_blank_lines_before_body PASSED                                                [ 46%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsParse::test_parse_invalid_syntax PASSED                                                              [ 46%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsParse::test_parse_only_body PASSED                                                                   [ 46%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsReconstruct::test_reconstruct_empty_components PASSED                                                [ 46%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsReconstruct::test_reconstruct_only_location PASSED                                                   [ 46%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsReconstruct::test_reconstruct_location_and_docstring PASSED                                          [ 46%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsReconstruct::test_reconstruct_with_future_import PASSED                                              [ 47%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsReconstruct::test_reconstruct_with_other_imports PASSED                                              [ 47%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsReconstruct::test_reconstruct_with_body PASSED                                                       [ 47%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsReconstruct::test_reconstruct_complex_example PASSED                                                 [ 47%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsReconstruct::test_reconstruct_preserves_import_order PASSED                                          [ 47%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsReconstruct::test_reconstruct_removes_trailing_blank_lines PASSED                                    [ 47%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsRoundTrip::test_round_trip_simple PASSED                                                             [ 48%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsRoundTrip::test_round_trip_with_imports PASSED                                                       [ 48%]
tests/shared/utils/test_header_tools.py::TestHeaderToolsRoundTrip::test_round_trip_multi_line_docstring PASSED                                               [ 48%]
tests/shared/utils/test_parsing.py::TestExtractJsonFromResponse::test_extract_json_object_from_markdown PASSED                                               [ 48%]
tests/shared/utils/test_parsing.py::TestExtractJsonFromResponse::test_extract_json_array_from_markdown PASSED                                                [ 48%]
tests/shared/utils/test_parsing.py::TestExtractJsonFromResponse::test_extract_json_markdown_without_json_label PASSED                                        [ 48%]
tests/shared/utils/test_parsing.py::TestExtractJsonFromResponse::test_extract_json_from_raw_object PASSED                                                    [ 48%]
tests/shared/utils/test_parsing.py::TestExtractJsonFromResponse::test_extract_json_from_raw_array PASSED                                                     [ 49%]
tests/shared/utils/test_parsing.py::TestExtractJsonFromResponse::test_no_json_found_returns_none PASSED                                                      [ 49%]
tests/shared/utils/test_parsing.py::TestExtractJsonFromResponse::test_invalid_json_in_markdown_returns_none PASSED                                           [ 49%]
tests/shared/utils/test_parsing.py::TestExtractJsonFromResponse::test_invalid_raw_json_returns_none PASSED                                                   [ 49%]
tests/shared/utils/test_parsing.py::TestExtractFromMarkdown::test_valid_json_object_in_markdown PASSED                                                       [ 49%]
tests/shared/utils/test_parsing.py::TestExtractFromMarkdown::test_valid_json_array_in_markdown PASSED                                                        [ 49%]
tests/shared/utils/test_parsing.py::TestExtractFromMarkdown::test_no_markdown_block_returns_none PASSED                                                      [ 50%]
tests/shared/utils/test_parsing.py::TestExtractFromMarkdown::test_invalid_json_in_markdown_returns_none PASSED                                               [ 50%]
tests/shared/utils/test_parsing.py::TestExtractRawJson::test_extract_object_from_middle_of_text PASSED                                                       [ 50%]
tests/shared/utils/test_parsing.py::TestExtractRawJson::test_extract_array_from_middle_of_text PASSED                                                        [ 50%]
tests/shared/utils/test_parsing.py::TestExtractRawJson::test_find_first_json_when_multiple_present PASSED                                                    [ 50%]
tests/shared/utils/test_parsing.py::TestExtractRawJson::test_find_first_valid_json_when_multiple_objects PASSED                                              [ 50%]
tests/shared/utils/test_parsing.py::TestExtractRawJson::test_no_json_returns_none PASSED                                                                     [ 50%]
tests/shared/utils/test_parsing.py::TestExtractRawJson::test_invalid_json_returns_none PASSED                                                                [ 51%]
tests/shared/utils/test_parsing.py::TestExtractRawJson::test_unclosed_brace_returns_none PASSED                                                              [ 51%]
tests/shared/utils/test_parsing.py::TestParseWriteBlocks::test_single_write_block PASSED                                                                     [ 51%]
tests/shared/utils/test_parsing.py::TestParseWriteBlocks::test_multiple_write_blocks PASSED                                                                  [ 51%]
tests/shared/utils/test_parsing.py::TestParseWriteBlocks::test_write_block_with_whitespace PASSED                                                            [ 51%]
tests/shared/utils/test_parsing.py::TestParseWriteBlocks::test_no_write_blocks_returns_empty_dict PASSED                                                     [ 51%]
tests/shared/utils/test_parsing.py::TestParseWriteBlocks::test_write_block_with_multiline_content PASSED                                                     [ 52%]
tests/shared/utils/test_parsing.py::TestParseWriteBlocks::test_malformed_write_block_ignored PASSED                                                          [ 52%]
tests/test_import_graph.py::test_import_layers[module_info0] PASSED                                                                                          [ 52%]
tests/test_import_graph.py::test_import_layers[module_info1] PASSED                                                                                          [ 52%]
tests/test_import_graph.py::test_import_layers[module_info2] PASSED                                                                                          [ 52%]
tests/test_import_graph.py::test_import_layers[module_info3] PASSED                                                                                          [ 52%]
tests/test_import_graph.py::test_import_layers[module_info4] PASSED                                                                                          [ 52%]
tests/test_import_graph.py::test_import_layers[module_info5] PASSED                                                                                          [ 53%]
tests/test_import_graph.py::test_import_layers[module_info6] PASSED                                                                                          [ 53%]
tests/test_import_graph.py::test_import_layers[module_info7] PASSED                                                                                          [ 53%]
tests/test_import_graph.py::test_import_layers[module_info8] PASSED                                                                                          [ 53%]
tests/test_import_graph.py::test_import_layers[module_info9] PASSED                                                                                          [ 53%]
tests/test_import_graph.py::test_import_layers[module_info10] PASSED                                                                                         [ 53%]
tests/test_import_graph.py::test_import_layers[module_info11] PASSED                                                                                         [ 54%]
tests/test_import_graph.py::test_import_layers[module_info12] PASSED                                                                                         [ 54%]
tests/test_import_graph.py::test_import_layers[module_info13] PASSED                                                                                         [ 54%]
tests/test_import_graph.py::test_import_layers[module_info14] PASSED                                                                                         [ 54%]
tests/test_import_graph.py::test_import_layers[module_info15] PASSED                                                                                         [ 54%]
tests/test_import_graph.py::test_import_layers[module_info16] PASSED                                                                                         [ 54%]
tests/test_import_graph.py::test_import_layers[module_info17] PASSED                                                                                         [ 54%]
tests/test_import_graph.py::test_import_layers[module_info18] PASSED                                                                                         [ 55%]
tests/test_import_graph.py::test_import_layers[module_info19] PASSED                                                                                         [ 55%]
tests/test_import_graph.py::test_import_layers[module_info20] PASSED                                                                                         [ 55%]
tests/test_import_graph.py::test_import_layers[module_info21] PASSED                                                                                         [ 55%]
tests/test_import_graph.py::test_import_layers[module_info22] PASSED                                                                                         [ 55%]
tests/test_import_graph.py::test_import_layers[module_info23] PASSED                                                                                         [ 55%]
tests/test_import_graph.py::test_import_layers[module_info24] PASSED                                                                                         [ 56%]
tests/test_import_graph.py::test_import_layers[module_info25] PASSED                                                                                         [ 56%]
tests/test_import_graph.py::test_import_layers[module_info26] PASSED                                                                                         [ 56%]
tests/test_import_graph.py::test_import_layers[module_info27] PASSED                                                                                         [ 56%]
tests/test_import_graph.py::test_import_layers[module_info28] PASSED                                                                                         [ 56%]
tests/test_import_graph.py::test_import_layers[module_info29] PASSED                                                                                         [ 56%]
tests/test_import_graph.py::test_import_layers[module_info30] PASSED                                                                                         [ 56%]
tests/test_import_graph.py::test_import_layers[module_info31] PASSED                                                                                         [ 57%]
tests/test_import_graph.py::test_import_layers[module_info32] PASSED                                                                                         [ 57%]
tests/test_import_graph.py::test_import_layers[module_info33] PASSED                                                                                         [ 57%]
tests/test_import_graph.py::test_import_layers[module_info34] PASSED                                                                                         [ 57%]
tests/test_import_graph.py::test_import_layers[module_info35] PASSED                                                                                         [ 57%]
tests/test_import_graph.py::test_import_layers[module_info36] PASSED                                                                                         [ 57%]
tests/test_import_graph.py::test_import_layers[module_info37] PASSED                                                                                         [ 58%]
tests/test_import_graph.py::test_import_layers[module_info38] PASSED                                                                                         [ 58%]
tests/test_import_graph.py::test_import_layers[module_info39] PASSED                                                                                         [ 58%]
tests/test_import_graph.py::test_import_layers[module_info40] PASSED                                                                                         [ 58%]
tests/test_import_graph.py::test_import_layers[module_info41] PASSED                                                                                         [ 58%]
tests/test_import_graph.py::test_import_layers[module_info42] PASSED                                                                                         [ 58%]
tests/test_import_graph.py::test_import_layers[module_info43] PASSED                                                                                         [ 58%]
tests/test_import_graph.py::test_import_layers[module_info44] PASSED                                                                                         [ 59%]
tests/test_import_graph.py::test_import_layers[module_info45] PASSED                                                                                         [ 59%]
tests/test_import_graph.py::test_import_layers[module_info46] PASSED                                                                                         [ 59%]
tests/test_import_graph.py::test_import_layers[module_info47] PASSED                                                                                         [ 59%]
tests/test_import_graph.py::test_import_layers[module_info48] PASSED                                                                                         [ 59%]
tests/test_import_graph.py::test_import_layers[module_info49] PASSED                                                                                         [ 59%]
tests/test_import_graph.py::test_import_layers[module_info50] PASSED                                                                                         [ 60%]
tests/test_import_graph.py::test_import_layers[module_info51] PASSED                                                                                         [ 60%]
tests/test_import_graph.py::test_import_layers[module_info52] PASSED                                                                                         [ 60%]
tests/test_import_graph.py::test_import_layers[module_info53] PASSED                                                                                         [ 60%]
tests/test_import_graph.py::test_import_layers[module_info54] PASSED                                                                                         [ 60%]
tests/test_import_graph.py::test_import_layers[module_info55] PASSED                                                                                         [ 60%]
tests/test_import_graph.py::test_import_layers[module_info56] PASSED                                                                                         [ 60%]
tests/test_import_graph.py::test_import_layers[module_info57] PASSED                                                                                         [ 61%]
tests/test_import_graph.py::test_import_layers[module_info58] PASSED                                                                                         [ 61%]
tests/test_import_graph.py::test_import_layers[module_info59] PASSED                                                                                         [ 61%]
tests/test_import_graph.py::test_import_layers[module_info60] PASSED                                                                                         [ 61%]
tests/test_import_graph.py::test_import_layers[module_info61] PASSED                                                                                         [ 61%]
tests/test_import_graph.py::test_import_layers[module_info62] PASSED                                                                                         [ 61%]
tests/test_import_graph.py::test_import_layers[module_info63] PASSED                                                                                         [ 62%]
tests/test_import_graph.py::test_import_layers[module_info64] PASSED                                                                                         [ 62%]
tests/test_import_graph.py::test_import_layers[module_info65] PASSED                                                                                         [ 62%]
tests/test_import_graph.py::test_import_layers[module_info66] PASSED                                                                                         [ 62%]
tests/test_import_graph.py::test_import_layers[module_info67] PASSED                                                                                         [ 62%]
tests/test_import_graph.py::test_import_layers[module_info68] PASSED                                                                                         [ 62%]
tests/test_import_graph.py::test_import_layers[module_info69] PASSED                                                                                         [ 62%]
tests/test_import_graph.py::test_import_layers[module_info70] PASSED                                                                                         [ 63%]
tests/test_import_graph.py::test_import_layers[module_info71] PASSED                                                                                         [ 63%]
tests/test_import_graph.py::test_import_layers[module_info72] PASSED                                                                                         [ 63%]
tests/test_import_graph.py::test_import_layers[module_info73] PASSED                                                                                         [ 63%]
tests/test_import_graph.py::test_import_layers[module_info74] PASSED                                                                                         [ 63%]
tests/test_import_graph.py::test_import_layers[module_info75] PASSED                                                                                         [ 63%]
tests/test_import_graph.py::test_import_layers[module_info76] PASSED                                                                                         [ 64%]
tests/test_import_graph.py::test_import_layers[module_info77] PASSED                                                                                         [ 64%]
tests/test_import_graph.py::test_import_layers[module_info78] PASSED                                                                                         [ 64%]
tests/test_import_graph.py::test_import_layers[module_info79] PASSED                                                                                         [ 64%]
tests/test_import_graph.py::test_import_layers[module_info80] PASSED                                                                                         [ 64%]
tests/test_import_graph.py::test_import_layers[module_info81] PASSED                                                                                         [ 64%]
tests/test_import_graph.py::test_import_layers[module_info82] PASSED                                                                                         [ 64%]
tests/test_import_graph.py::test_import_layers[module_info83] PASSED                                                                                         [ 65%]
tests/test_import_graph.py::test_import_layers[module_info84] PASSED                                                                                         [ 65%]
tests/test_import_graph.py::test_import_layers[module_info85] PASSED                                                                                         [ 65%]
tests/test_import_graph.py::test_import_layers[module_info86] PASSED                                                                                         [ 65%]
tests/test_import_graph.py::test_import_layers[module_info87] PASSED                                                                                         [ 65%]
tests/test_import_graph.py::test_import_layers[module_info88] PASSED                                                                                         [ 65%]
tests/test_import_graph.py::test_import_layers[module_info89] PASSED                                                                                         [ 66%]
tests/test_import_graph.py::test_import_layers[module_info90] PASSED                                                                                         [ 66%]
tests/test_import_graph.py::test_import_layers[module_info91] PASSED                                                                                         [ 66%]
tests/test_import_graph.py::test_import_layers[module_info92] PASSED                                                                                         [ 66%]
tests/test_import_graph.py::test_import_layers[module_info93] PASSED                                                                                         [ 66%]
tests/test_import_graph.py::test_import_layers[module_info94] PASSED                                                                                         [ 66%]
tests/test_import_graph.py::test_import_layers[module_info95] PASSED                                                                                         [ 66%]
tests/test_import_graph.py::test_import_layers[module_info96] PASSED                                                                                         [ 67%]
tests/test_import_graph.py::test_import_layers[module_info97] PASSED                                                                                         [ 67%]
tests/test_import_graph.py::test_import_layers[module_info98] PASSED                                                                                         [ 67%]
tests/test_import_graph.py::test_import_layers[module_info99] PASSED                                                                                         [ 67%]
tests/test_import_graph.py::test_import_layers[module_info100] PASSED                                                                                        [ 67%]
tests/test_import_graph.py::test_import_layers[module_info101] PASSED                                                                                        [ 67%]
tests/test_import_graph.py::test_import_layers[module_info102] PASSED                                                                                        [ 68%]
tests/test_import_graph.py::test_import_layers[module_info103] PASSED                                                                                        [ 68%]
tests/test_import_graph.py::test_import_layers[module_info104] PASSED                                                                                        [ 68%]
tests/test_import_graph.py::test_import_layers[module_info105] PASSED                                                                                        [ 68%]
tests/test_import_graph.py::test_import_layers[module_info106] PASSED                                                                                        [ 68%]
tests/test_import_graph.py::test_import_layers[module_info107] PASSED                                                                                        [ 68%]
tests/test_import_graph.py::test_import_layers[module_info108] PASSED                                                                                        [ 68%]
tests/test_import_graph.py::test_import_layers[module_info109] PASSED                                                                                        [ 69%]
tests/test_import_graph.py::test_import_layers[module_info110] PASSED                                                                                        [ 69%]
tests/test_import_graph.py::test_import_layers[module_info111] PASSED                                                                                        [ 69%]
tests/test_import_graph.py::test_import_layers[module_info112] PASSED                                                                                        [ 69%]
tests/test_import_graph.py::test_import_layers[module_info113] PASSED                                                                                        [ 69%]
tests/test_import_graph.py::test_import_layers[module_info114] PASSED                                                                                        [ 69%]
tests/test_import_graph.py::test_import_layers[module_info115] PASSED                                                                                        [ 70%]
tests/test_import_graph.py::test_import_layers[module_info116] PASSED                                                                                        [ 70%]
tests/test_import_graph.py::test_import_layers[module_info117] PASSED                                                                                        [ 70%]
tests/test_import_graph.py::test_import_layers[module_info118] PASSED                                                                                        [ 70%]
tests/test_import_graph.py::test_import_layers[module_info119] PASSED                                                                                        [ 70%]
tests/test_import_graph.py::test_import_layers[module_info120] PASSED                                                                                        [ 70%]
tests/test_import_graph.py::test_import_layers[module_info121] PASSED                                                                                        [ 70%]
tests/test_import_graph.py::test_import_layers[module_info122] PASSED                                                                                        [ 71%]
tests/test_import_graph.py::test_import_layers[module_info123] PASSED                                                                                        [ 71%]
tests/test_import_graph.py::test_import_layers[module_info124] PASSED                                                                                        [ 71%]
tests/test_import_graph.py::test_import_layers[module_info125] PASSED                                                                                        [ 71%]
tests/test_import_graph.py::test_import_layers[module_info126] PASSED                                                                                        [ 71%]
tests/test_import_graph.py::test_import_layers[module_info127] PASSED                                                                                        [ 71%]
tests/test_import_graph.py::test_import_layers[module_info128] PASSED                                                                                        [ 72%]
tests/test_import_graph.py::test_import_layers[module_info129] PASSED                                                                                        [ 72%]
tests/test_import_graph.py::test_import_layers[module_info130] PASSED                                                                                        [ 72%]
tests/test_import_graph.py::test_import_layers[module_info131] PASSED                                                                                        [ 72%]
tests/test_import_graph.py::test_import_layers[module_info132] PASSED                                                                                        [ 72%]
tests/test_import_graph.py::test_import_layers[module_info133] PASSED                                                                                        [ 72%]
tests/test_import_graph.py::test_import_layers[module_info134] PASSED                                                                                        [ 72%]
tests/test_import_graph.py::test_import_layers[module_info135] PASSED                                                                                        [ 73%]
tests/test_import_graph.py::test_import_layers[module_info136] PASSED                                                                                        [ 73%]
tests/test_import_graph.py::test_import_layers[module_info137] PASSED                                                                                        [ 73%]
tests/test_import_graph.py::test_import_layers[module_info138] PASSED                                                                                        [ 73%]
tests/test_import_graph.py::test_import_layers[module_info139] PASSED                                                                                        [ 73%]
tests/test_import_graph.py::test_import_layers[module_info140] PASSED                                                                                        [ 73%]
tests/test_import_graph.py::test_import_layers[module_info141] PASSED                                                                                        [ 74%]
tests/test_import_graph.py::test_import_layers[module_info142] PASSED                                                                                        [ 74%]
tests/test_import_graph.py::test_import_layers[module_info143] PASSED                                                                                        [ 74%]
tests/test_import_graph.py::test_import_layers[module_info144] PASSED                                                                                        [ 74%]
tests/test_import_graph.py::test_import_layers[module_info145] PASSED                                                                                        [ 74%]
tests/test_import_graph.py::test_import_layers[module_info146] PASSED                                                                                        [ 74%]
tests/test_import_graph.py::test_import_layers[module_info147] PASSED                                                                                        [ 74%]
tests/test_import_graph.py::test_import_layers[module_info148] PASSED                                                                                        [ 75%]
tests/test_import_graph.py::test_import_layers[module_info149] PASSED                                                                                        [ 75%]
tests/test_import_graph.py::test_import_layers[module_info150] PASSED                                                                                        [ 75%]
tests/test_import_graph.py::test_import_layers[module_info151] PASSED                                                                                        [ 75%]
tests/test_import_graph.py::test_import_layers[module_info152] PASSED                                                                                        [ 75%]
tests/test_import_graph.py::test_import_layers[module_info153] PASSED                                                                                        [ 75%]
tests/test_import_graph.py::test_import_layers[module_info154] PASSED                                                                                        [ 76%]
tests/test_import_graph.py::test_import_layers[module_info155] PASSED                                                                                        [ 76%]
tests/test_import_graph.py::test_import_layers[module_info156] PASSED                                                                                        [ 76%]
tests/test_import_graph.py::test_import_layers[module_info157] PASSED                                                                                        [ 76%]
tests/test_import_graph.py::test_import_layers[module_info158] PASSED                                                                                        [ 76%]
tests/test_import_graph.py::test_import_layers[module_info159] PASSED                                                                                        [ 76%]
tests/test_import_graph.py::test_import_layers[module_info160] PASSED                                                                                        [ 76%]
tests/test_import_graph.py::test_import_layers[module_info161] PASSED                                                                                        [ 77%]
tests/test_import_graph.py::test_import_layers[module_info162] PASSED                                                                                        [ 77%]
tests/test_import_graph.py::test_import_layers[module_info163] PASSED                                                                                        [ 77%]
tests/test_import_graph.py::test_import_layers[module_info164] PASSED                                                                                        [ 77%]
tests/test_import_graph.py::test_import_layers[module_info165] PASSED                                                                                        [ 77%]
tests/test_import_graph.py::test_import_layers[module_info166] PASSED                                                                                        [ 77%]
tests/test_import_graph.py::test_import_layers[module_info167] PASSED                                                                                        [ 78%]
tests/test_import_graph.py::test_import_layers[module_info168] PASSED                                                                                        [ 78%]
tests/test_import_graph.py::test_import_layers[module_info169] PASSED                                                                                        [ 78%]
tests/test_import_graph.py::test_import_layers[module_info170] PASSED                                                                                        [ 78%]
tests/test_import_graph.py::test_import_layers[module_info171] PASSED                                                                                        [ 78%]
tests/test_import_graph.py::test_import_layers[module_info172] PASSED                                                                                        [ 78%]
tests/test_import_graph.py::test_import_layers[module_info173] PASSED                                                                                        [ 78%]
tests/test_import_graph.py::test_import_layers[module_info174] PASSED                                                                                        [ 79%]
tests/test_import_graph.py::test_import_layers[module_info175] PASSED                                                                                        [ 79%]
tests/test_import_graph.py::test_import_layers[module_info176] PASSED                                                                                        [ 79%]
tests/test_import_graph.py::test_import_layers[module_info177] PASSED                                                                                        [ 79%]
tests/test_import_graph.py::test_import_layers[module_info178] PASSED                                                                                        [ 79%]
tests/test_import_graph.py::test_import_layers[module_info179] PASSED                                                                                        [ 79%]
tests/test_import_graph.py::test_import_layers[module_info180] PASSED                                                                                        [ 80%]
tests/test_import_graph.py::test_import_layers[module_info181] PASSED                                                                                        [ 80%]
tests/test_import_graph.py::test_import_layers[module_info182] PASSED                                                                                        [ 80%]
tests/test_import_graph.py::test_import_layers[module_info183] PASSED                                                                                        [ 80%]
tests/test_import_graph.py::test_import_layers[module_info184] PASSED                                                                                        [ 80%]
tests/test_import_graph.py::test_import_layers[module_info185] PASSED                                                                                        [ 80%]
tests/test_import_graph.py::test_import_layers[module_info186] PASSED                                                                                        [ 80%]
tests/test_import_graph.py::test_import_layers[module_info187] PASSED                                                                                        [ 81%]
tests/test_import_graph.py::test_import_layers[module_info188] PASSED                                                                                        [ 81%]
tests/test_import_graph.py::test_import_layers[module_info189] PASSED                                                                                        [ 81%]
tests/test_import_graph.py::test_import_layers[module_info190] PASSED                                                                                        [ 81%]
tests/test_import_graph.py::test_import_layers[module_info191] PASSED                                                                                        [ 81%]
tests/test_import_graph.py::test_import_layers[module_info192] PASSED                                                                                        [ 81%]
tests/test_import_graph.py::test_import_layers[module_info193] PASSED                                                                                        [ 82%]
tests/test_import_graph.py::test_import_layers[module_info194] PASSED                                                                                        [ 82%]
tests/test_import_graph.py::test_import_layers[module_info195] PASSED                                                                                        [ 82%]
tests/test_import_graph.py::test_import_layers[module_info196] PASSED                                                                                        [ 82%]
tests/test_import_graph.py::test_import_layers[module_info197] PASSED                                                                                        [ 82%]
tests/test_import_graph.py::test_import_layers[module_info198] PASSED                                                                                        [ 82%]
tests/test_import_graph.py::test_import_layers[module_info199] PASSED                                                                                        [ 82%]
tests/test_import_graph.py::test_import_layers[module_info200] PASSED                                                                                        [ 83%]
tests/test_import_graph.py::test_import_layers[module_info201] PASSED                                                                                        [ 83%]
tests/test_import_graph.py::test_import_layers[module_info202] PASSED                                                                                        [ 83%]
tests/test_import_graph.py::test_import_layers[module_info203] PASSED                                                                                        [ 83%]
tests/test_import_graph.py::test_import_layers[module_info204] PASSED                                                                                        [ 83%]
tests/test_import_graph.py::test_import_layers[module_info205] PASSED                                                                                        [ 83%]
tests/test_import_graph.py::test_import_layers[module_info206] PASSED                                                                                        [ 84%]
tests/test_import_graph.py::test_import_layers[module_info207] PASSED                                                                                        [ 84%]
tests/test_import_graph.py::test_import_layers[module_info208] PASSED                                                                                        [ 84%]
tests/test_import_graph.py::test_import_layers[module_info209] PASSED                                                                                        [ 84%]
tests/test_import_graph.py::test_import_layers[module_info210] PASSED                                                                                        [ 84%]
tests/test_import_graph.py::test_import_layers[module_info211] PASSED                                                                                        [ 84%]
tests/test_import_graph.py::test_import_layers[module_info212] PASSED                                                                                        [ 84%]
tests/test_import_graph.py::test_import_layers[module_info213] PASSED                                                                                        [ 85%]
tests/test_import_graph.py::test_import_layers[module_info214] PASSED                                                                                        [ 85%]
tests/test_import_graph.py::test_import_layers[module_info215] PASSED                                                                                        [ 85%]
tests/test_import_graph.py::test_import_layers[module_info216] PASSED                                                                                        [ 85%]
tests/test_import_graph.py::test_import_layers[module_info217] PASSED                                                                                        [ 85%]
tests/test_import_graph.py::test_import_layers[module_info218] PASSED                                                                                        [ 85%]
tests/test_import_graph.py::test_import_layers[module_info219] PASSED                                                                                        [ 86%]
tests/test_import_graph.py::test_import_layers[module_info220] PASSED                                                                                        [ 86%]
tests/test_import_graph.py::test_import_layers[module_info221] PASSED                                                                                        [ 86%]
tests/test_import_graph.py::test_import_layers[module_info222] PASSED                                                                                        [ 86%]
tests/test_import_graph.py::test_import_layers[module_info223] PASSED                                                                                        [ 86%]
tests/test_import_graph.py::test_import_layers[module_info224] PASSED                                                                                        [ 86%]
tests/test_import_graph.py::test_import_layers[module_info225] PASSED                                                                                        [ 86%]
tests/test_import_graph.py::test_import_layers[module_info226] PASSED                                                                                        [ 87%]
tests/test_import_graph.py::test_import_layers[module_info227] PASSED                                                                                        [ 87%]
tests/test_import_graph.py::test_import_layers[module_info228] PASSED                                                                                        [ 87%]
tests/test_import_graph.py::test_import_layers[module_info229] PASSED                                                                                        [ 87%]
tests/test_import_graph.py::test_import_layers[module_info230] PASSED                                                                                        [ 87%]
tests/test_import_graph.py::test_import_layers[module_info231] PASSED                                                                                        [ 87%]
tests/unit/agents/test_deduction_agent.py::test_deduction_agent_initializes_without_policy PASSED                                                            [ 88%]
tests/unit/agents/test_deduction_agent.py::test_deduction_agent_loads_policy PASSED                                                                          [ 88%]
tests/unit/agents/test_deduction_agent.py::test_select_resource_with_cost_rating PASSED                                                                      [ 88%]
tests/unit/agents/test_deduction_agent.py::test_select_resource_returns_none_when_no_candidates PASSED                                                       [ 88%]
tests/unit/agents/test_deduction_agent.py::test_select_resource_handles_missing_metadata PASSED                                                              [ 88%]
tests/unit/agents/test_execution_agent.py::test_execute_plan_success[asyncio] PASSED                                                                         [ 88%]
tests/unit/agents/test_execution_agent.py::test_execute_plan_handles_executor_failure[asyncio] PASSED                                                        [ 88%]
tests/unit/agents/test_execution_agent.py::test_execute_plan_success[trio] PASSED                                                                            [ 89%]
tests/unit/agents/test_execution_agent.py::test_execute_plan_handles_executor_failure[trio] PASSED                                                           [ 89%]
tests/unit/agents/test_intent_translator.py::test_translator_handles_vague_goal PASSED                                                                       [ 89%]
tests/unit/agents/test_planner_agent.py::test_create_execution_plan_success[asyncio] PASSED                                                                  [ 89%]
tests/unit/agents/test_planner_agent.py::test_create_execution_plan_raises_plan_error_on_bad_data[asyncio] PASSED                                            [ 89%]
tests/unit/agents/test_planner_agent.py::test_create_execution_plan_success[trio] PASSED                                                                     [ 89%]
tests/unit/agents/test_planner_agent.py::test_create_execution_plan_raises_plan_error_on_bad_data[trio] PASSED                                               [ 90%]
tests/unit/test_config.py::test_settings_loads_defined_attributes PASSED                                                                                     [ 90%]
tests/unit/test_config.py::test_settings_loads_extra_vars_via_constructor PASSED                                                                             [ 90%]
tests/unit/test_config.py::test_settings_accessing_nonexistent_attribute_raises_error PASSED                                                                 [ 90%]
tests/unit/test_file_handler.py::test_file_handler_initialization PASSED                                                                                     [ 90%]
tests/unit/test_file_handler.py::test_file_handler_rejects_invalid_path PASSED                                                                               [ 90%]
tests/unit/test_file_handler.py::test_add_pending_write_creates_entry PASSED                                                                                 [ 90%]
tests/unit/test_file_handler.py::test_confirm_write_creates_file PASSED                                                                                      [ 91%]
tests/unit/test_file_handler.py::test_confirm_write_creates_parent_directories PASSED                                                                        [ 91%]
tests/unit/test_file_handler.py::test_confirm_write_fails_for_nonexistent_id PASSED                                                                          [ 91%]
tests/unit/test_file_handler.py::test_confirm_write_prevents_path_traversal PASSED                                                                           [ 91%]
tests/unit/test_file_handler.py::test_multiple_pending_writes PASSED                                                                                         [ 91%]
tests/unit/test_file_handler.py::test_pending_write_includes_timestamp PASSED                                                                                [ 91%]
tests/unit/test_file_handler.py::test_confirm_write_with_existing_file PASSED                                                                                [ 92%]
tests/unit/test_file_handler.py::test_thread_safety_of_pending_writes PASSED                                                                                 [ 92%]
tests/unit/test_git_service.py::test_git_add_all PASSED                                                                                                      [ 92%]
tests/unit/test_git_service.py::test_git_commit PASSED                                                                                                       [ 92%]
tests/unit/test_git_service.py::test_is_git_repo_true PASSED                                                                                                 [ 92%]
tests/unit/test_git_service.py::test_is_git_repo_false PASSED                                                                                                [ 92%]
tests/unit/test_llm_client.py::test_client_initialization PASSED                                                                                             [ 92%]
tests/unit/test_llm_client.py::test_make_request_async_success PASSED                                                                                        [ 93%]
tests/unit/test_llm_client.py::test_make_request_async_with_custom_user_id PASSED                                                                            [ 93%]
tests/unit/test_llm_client.py::test_get_embedding_success PASSED                                                                                             [ 93%]
tests/unit/test_llm_client.py::test_request_with_retry_success_first_attempt PASSED                                                                          [ 93%]
tests/unit/test_llm_client.py::test_request_with_retry_succeeds_after_failure PASSED                                                                         [ 93%]
tests/unit/test_llm_client.py::test_request_with_retry_fails_after_max_attempts PASSED                                                                       [ 93%]
tests/unit/test_llm_client.py::test_rate_limiting_enforced PASSED                                                                                            [ 94%]
tests/unit/test_llm_client.py::test_rate_limiting_not_enforced_when_disabled PASSED                                                                          [ 94%]
tests/unit/test_llm_client.py::test_semaphore_limits_concurrent_requests PASSED                                                                              [ 94%]
tests/unit/test_llm_client.py::test_client_without_semaphore_raises_error PASSED                                                                             [ 94%]
tests/unit/test_llm_client.py::test_create_factory_method PASSED                                                                                             [ 94%]
tests/unit/test_llm_client.py::test_exponential_backoff_timing PASSED                                                                                        [ 94%]
tests/unit/test_service_registry.py::test_registry_initializes_from_database PASSED                                                                          [ 94%]
tests/unit/test_service_registry.py::test_registry_only_initializes_once PASSED                                                                              [ 95%]
tests/unit/test_service_registry.py::test_get_service_raises_on_unknown_service PASSED                                                                       [ 95%]
tests/unit/test_service_registry.py::test_get_service_returns_singleton PASSED                                                                               [ 95%]
tests/unit/test_service_registry.py::test_import_class_loads_module_dynamically PASSED                                                                       [ 95%]
tests/unit/test_service_registry.py::test_get_service_with_repo_path_services PASSED                                                                         [ 95%]
tests/unit/test_service_registry.py::test_get_service_with_no_args_services PASSED                                                                           [ 95%]
tests/unit/test_service_registry.py::test_registry_handles_db_initialization_failure PASSED                                                                  [ 96%]
tests/unit/test_service_registry.py::test_registry_thread_safety_with_lock PASSED                                                                            [ 96%]
tests/unit/test_service_registry.py::test_import_class_handles_invalid_path PASSED                                                                           [ 96%]
tests/unit/test_service_registry.py::test_import_class_handles_missing_class PASSED                                                                          [ 96%]
tests/will/agents/test_plan_executor.py::test_execute_plan_success PASSED                                                                                    [ 96%]
tests/will/agents/test_plan_executor.py::test_execute_plan_skips_missing_handler PASSED                                                                      [ 96%]
tests/will/agents/test_plan_executor.py::test_execute_task_timeout PASSED                                                                                    [ 96%]
tests/will/agents/test_plan_executor.py::test_execute_task_generic_exception PASSED                                                                          [ 97%]
tests/will/agents/test_plan_executor.py::test_execute_plan_multiple_tasks PASSED                                                                             [ 97%]
tests/will/orchestration/test_cognitive_service.py::test_cognitive_service_selects_cheapest_model[asyncio] PASSED                                            [ 97%]
tests/will/orchestration/test_cognitive_service.py::test_cognitive_service_selects_cheapest_model[trio] PASSED                                               [ 97%]
tests/will/orchestration/test_cognitive_service_unit.py::test_initialize_success PASSED                                                                      [ 97%]
tests/will/orchestration/test_cognitive_service_unit.py::test_initialize_handles_exception PASSED                                                            [ 97%]
tests/will/orchestration/test_cognitive_service_unit.py::test_create_provider_openai PASSED                                                                  [ 98%]
tests/will/orchestration/test_cognitive_service_unit.py::test_create_provider_ollama PASSED                                                                  [ 98%]
tests/will/orchestration/test_cognitive_service_unit.py::test_create_provider_missing_prefix PASSED                                                          [ 98%]
tests/will/orchestration/test_cognitive_service_unit.py::test_create_provider_missing_config PASSED                                                          [ 98%]
tests/will/orchestration/test_cognitive_service_unit.py::test_create_provider_secret_keyerror PASSED                                                         [ 98%]
tests/will/orchestration/test_cognitive_service_unit.py::test_aget_client_for_role_success PASSED                                                            [ 98%]
tests/will/orchestration/test_cognitive_service_unit.py::test_aget_client_reuses_cached PASSED                                                               [ 98%]
tests/will/orchestration/test_cognitive_service_unit.py::test_aget_client_no_resource PASSED                                                                 [ 99%]
tests/will/orchestration/test_cognitive_service_unit.py::test_aget_client_create_provider_fails PASSED                                                       [ 99%]
tests/will/orchestration/test_cognitive_service_unit.py::test_get_embedding_for_code_none PASSED                                                             [ 99%]
tests/will/orchestration/test_cognitive_service_unit.py::test_get_embedding_for_code_success PASSED                                                          [ 99%]
tests/will/orchestration/test_cognitive_service_unit.py::test_search_capabilities_success PASSED                                                             [ 99%]
tests/will/orchestration/test_cognitive_service_unit.py::test_search_capabilities_handles_errors PASSED                                                      [ 99%]
tests/will/orchestration/test_cognitive_service_unit.py::test_search_capabilities_no_vector PASSED                                                           [100%]

============================================================================= FAILURES =============================================================================
_______________________________________________________________ TestSecretManager.test_encrypt_value _______________________________________________________________

self = <test_fix.TestSecretManager object at 0x798960bbcd40>, secret_manager = <MagicMock name='mock.SecretManager()' id='133630779187392'>

    def test_encrypt_value(self, secret_manager):
        """Test encrypting a secret value"""
        test_value = "my-secret-password"
        encrypted = secret_manager.encrypt_value(test_value)
        assert encrypted != test_value
>       assert isinstance(encrypted, bytes)
E       AssertionError: assert False
E        +  where False = isinstance(<MagicMock name='mock.SecretManager().encrypt_value()' id='133630771868208'>, bytes)

tests/body/cli/commands/test_fix.py:79: AssertionError
_______________________________________________________________ TestSecretManager.test_decrypt_value _______________________________________________________________

self = <test_fix.TestSecretManager object at 0x798960bbcf20>, secret_manager = <MagicMock name='mock.SecretManager()' id='133630779187392'>

    def test_decrypt_value(self, secret_manager):
        """Test decrypting a secret value"""
        test_value = "my-secret-password"
        encrypted = secret_manager.encrypt_value(test_value)
        decrypted = secret_manager.decrypt_value(encrypted)
>       assert decrypted == test_value
E       AssertionError: assert <MagicMock name='mock.SecretManager().decrypt_value()' id='133630876755504'> == 'my-secret-password'

tests/body/cli/commands/test_fix.py:86: AssertionError
________________________________________________________ TestSecretManager.test_validate_secret_name_valid _________________________________________________________

self = <test_fix.TestSecretManager object at 0x798960bbd100>, secret_manager = <MagicMock name='mock.SecretManager()' id='133630779187392'>

    def test_validate_secret_name_valid(self, secret_manager):
        """Test validating valid secret names"""
        valid_names = [
            "API_KEY",
            "DATABASE_URL",
            "SECRET_TOKEN_123",
            "MY_SECRET",
        ]
        for name in valid_names:
>           assert secret_manager.validate_secret_name(name) is True
E           AssertionError: assert <MagicMock name='mock.SecretManager().validate_secret_name()' id='133630779180432'> is True
E            +  where <MagicMock name='mock.SecretManager().validate_secret_name()' id='133630779180432'> = <MagicMock name='mock.SecretManager().validate_secret_name' id='133630779190848'>('API_KEY')
E            +    where <MagicMock name='mock.SecretManager().validate_secret_name' id='133630779190848'> = <MagicMock name='mock.SecretManager()' id='133630779187392'>.validate_secret_name

tests/body/cli/commands/test_fix.py:97: AssertionError
_______________________________________________________ TestSecretManager.test_validate_secret_name_invalid ________________________________________________________

self = <test_fix.TestSecretManager object at 0x798960bbd2e0>, secret_manager = <MagicMock name='mock.SecretManager()' id='133630779187392'>

    def test_validate_secret_name_invalid(self, secret_manager):
        """Test validating invalid secret names"""
        invalid_names = [
            "",
            " ",
            "secret with spaces",
            "secret-with-dashes",
            "123startswithnumber",
            "secret.with.dots",
        ]
        for name in invalid_names:
>           assert secret_manager.validate_secret_name(name) is False
E           AssertionError: assert <MagicMock name='mock.SecretManager().validate_secret_name()' id='133630779180432'> is False
E            +  where <MagicMock name='mock.SecretManager().validate_secret_name()' id='133630779180432'> = <MagicMock name='mock.SecretManager().validate_secret_name' id='133630779190848'>('')
E            +    where <MagicMock name='mock.SecretManager().validate_secret_name' id='133630779190848'> = <MagicMock name='mock.SecretManager()' id='133630779187392'>.validate_secret_name

tests/body/cli/commands/test_fix.py:110: AssertionError
________________________________________________________________ TestSecretManager.test_set_secret _________________________________________________________________

self = <test_fix.TestSecretManager object at 0x798960bbd4c0>, secret_manager = <MagicMock name='mock.SecretManager()' id='133630779187392'>

    def test_set_secret(self, secret_manager):
        """Test setting a secret"""
        result = secret_manager.set_secret("API_KEY", "test-key-123")
>       assert result is True
E       AssertionError: assert <MagicMock name='mock.SecretManager().set_secret()' id='133630779088800'> is True

tests/body/cli/commands/test_fix.py:115: AssertionError
________________________________________________________________ TestSecretManager.test_get_secret _________________________________________________________________

self = <MagicMock name='SecretStorage.get' id='133630779088416'>, args = ('API_KEY',), kwargs = {}, expected = "get('API_KEY')", actual = 'not called.'
error_message = "expected call not found.\nExpected: get('API_KEY')\n  Actual: not called."

    def assert_called_with(self, /, *args, **kwargs):
        """assert that the last call was made with the specified arguments.

        Raises an AssertionError if the args and keyword args passed in are
        different to the last call to the mock."""
        if self.call_args is None:
            expected = self._format_mock_call_signature(args, kwargs)
            actual = 'not called.'
            error_message = ('expected call not found.\nExpected: %s\n  Actual: %s'
                    % (expected, actual))
>           raise AssertionError(error_message)
E           AssertionError: expected call not found.
E           Expected: get('API_KEY')
E             Actual: not called.

/usr/lib/python3.12/unittest/mock.py:935: AssertionError

During handling of the above exception, another exception occurred:

self = <test_fix.TestSecretManager object at 0x798960bbd6a0>, secret_manager = <MagicMock name='mock.SecretManager()' id='133630779187392'>

    def test_get_secret(self, secret_manager):
        """Test getting a secret"""
        secret_manager.storage.get.return_value = b"encrypted_value"
        result = secret_manager.get_secret("API_KEY")
        assert result is not None
>       secret_manager.storage.get.assert_called_with("API_KEY")
E       AssertionError: expected call not found.
E       Expected: get('API_KEY')
E         Actual: not called.

tests/body/cli/commands/test_fix.py:123: AssertionError
_______________________________________________________________ TestSecretManager.test_delete_secret _______________________________________________________________

self = <test_fix.TestSecretManager object at 0x798960bbd880>, secret_manager = <MagicMock name='mock.SecretManager()' id='133630779187392'>

    def test_delete_secret(self, secret_manager):
        """Test deleting a secret"""
        secret_manager.storage.delete.return_value = True
        result = secret_manager.delete_secret("API_KEY")
>       assert result is True
E       AssertionError: assert <MagicMock name='mock.SecretManager().delete_secret()' id='133630779030992'> is True

tests/body/cli/commands/test_fix.py:129: AssertionError
_______________________________________________________________ TestSecretManager.test_list_secrets ________________________________________________________________

self = <test_fix.TestSecretManager object at 0x798960bbda60>, secret_manager = <MagicMock name='mock.SecretManager()' id='133630779187392'>

    def test_list_secrets(self, secret_manager):
        """Test listing all secrets"""
        secret_manager.storage.list_all.return_value = ["API_KEY", "DB_URL", "TOKEN"]
        result = secret_manager.list_secrets()
>       assert len(result) == 3
E       AssertionError: assert 0 == 3
E        +  where 0 = len(<MagicMock name='mock.SecretManager().list_secrets()' id='133630778977328'>)

tests/body/cli/commands/test_fix.py:136: AssertionError
_______________________________________________________________ TestSecretManager.test_rotate_secret _______________________________________________________________

self = <test_fix.TestSecretManager object at 0x798960bbdc40>, secret_manager = <MagicMock name='mock.SecretManager()' id='133630779187392'>

    def test_rotate_secret(self, secret_manager):
        """Test rotating a secret"""
        old_value = "old-secret"
        new_value = "new-secret"
        secret_manager.storage.get.return_value = secret_manager.encrypt_value(old_value)

        result = secret_manager.rotate_secret("API_KEY", new_value)
>       assert result is True
E       AssertionError: assert <MagicMock name='mock.SecretManager().rotate_secret()' id='133630778878304'> is True

tests/body/cli/commands/test_fix.py:146: AssertionError
______________________________________________________________ TestSecretManager.test_export_secrets _______________________________________________________________

self = <test_fix.TestSecretManager object at 0x798960bbd790>, secret_manager = <MagicMock name='mock.SecretManager()' id='133630779187392'>

    def test_export_secrets(self, secret_manager):
        """Test exporting secrets to JSON"""
        secrets = {
            "API_KEY": "test-key",
            "DB_URL": "postgres://localhost"
        }
        secret_manager.storage.get_all.return_value = secrets

        exported = secret_manager.export_secrets(decrypt=True)
>       assert isinstance(exported, str)
E       AssertionError: assert False
E        +  where False = isinstance(<MagicMock name='mock.SecretManager().export_secrets()' id='133630778598528'>, str)

tests/body/cli/commands/test_fix.py:158: AssertionError
______________________________________________________________ TestSecretManager.test_import_secrets _______________________________________________________________

self = <test_fix.TestSecretManager object at 0x798960bbcf50>, secret_manager = <MagicMock name='mock.SecretManager()' id='133630779187392'>

    def test_import_secrets(self, secret_manager):
        """Test importing secrets from JSON"""
        import_data = {
            "API_KEY": "new-key",
            "TOKEN": "new-token"
        }
        json_str = json.dumps(import_data)

        result = secret_manager.import_secrets(json_str, overwrite=True)
>       assert result is True
E       AssertionError: assert <MagicMock name='mock.SecretManager().import_secrets()' id='133630860636672'> is True

tests/body/cli/commands/test_fix.py:171: AssertionError
_____________________________________________________________ TestSecretsCLI.test_list_secrets_command _____________________________________________________________

self = <test_fix.TestSecretsCLI object at 0x798960bbde80>, runner = <click.testing.CliRunner object at 0x79895bfb65a0>
mock_manager = <MagicMock name='SecretManager()' id='133630778714032'>

    def test_list_secrets_command(self, runner, mock_manager):
        """Test the list-secrets CLI command"""
        mock_manager.list_secrets.return_value = ["API_KEY", "DB_URL"]

        result = runner.invoke(list_secrets)
        assert result.exit_code == 0
>       assert "API_KEY" in result.output
E       AssertionError: assert 'API_KEY' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/commands/test_fix.py:195: AssertionError
______________________________________________________________ TestSecretsCLI.test_list_secrets_empty ______________________________________________________________

self = <test_fix.TestSecretsCLI object at 0x798960bbe060>, runner = <click.testing.CliRunner object at 0x79895abae8a0>
mock_manager = <MagicMock name='SecretManager()' id='133630778604144'>

    def test_list_secrets_empty(self, runner, mock_manager):
        """Test list-secrets when no secrets exist"""
        mock_manager.list_secrets.return_value = []

        result = runner.invoke(list_secrets)
        assert result.exit_code == 0
>       assert "No secrets found" in result.output
E       AssertionError: assert 'No secrets found' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/commands/test_fix.py:204: AssertionError
______________________________________________________________ TestSecretsCLI.test_get_secret_command ______________________________________________________________

self = <test_fix.TestSecretsCLI object at 0x798960bbe240>, runner = <click.testing.CliRunner object at 0x7989571b21e0>
mock_manager = <MagicMock name='SecretManager()' id='133630778973344'>

    def test_get_secret_command(self, runner, mock_manager):
        """Test the get-secret CLI command"""
        mock_manager.get_secret.return_value = "my-secret-value"

        result = runner.invoke(get_secret, ["API_KEY"])
        assert result.exit_code == 0
>       assert "my-secret-value" in result.output
E       AssertionError: assert 'my-secret-value' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/commands/test_fix.py:212: AssertionError
_____________________________________________________________ TestSecretsCLI.test_get_secret_not_found _____________________________________________________________

self = <test_fix.TestSecretsCLI object at 0x798960bbe420>, runner = <click.testing.CliRunner object at 0x7989571e5400>
mock_manager = <MagicMock name='SecretManager()' id='133630779112288'>

    def test_get_secret_not_found(self, runner, mock_manager):
        """Test get-secret when secret doesn't exist"""
        mock_manager.get_secret.return_value = None

        result = runner.invoke(get_secret, ["NONEXISTENT"])
>       assert result.exit_code == 1
E       assert 0 == 1
E        +  where 0 = <Result okay>.exit_code

tests/body/cli/commands/test_fix.py:219: AssertionError
______________________________________________________________ TestSecretsCLI.test_set_secret_command ______________________________________________________________

self = <test_fix.TestSecretsCLI object at 0x798960bbe600>, runner = <click.testing.CliRunner object at 0x7989571eba40>
mock_manager = <MagicMock name='SecretManager()' id='133630771866528'>

    def test_set_secret_command(self, runner, mock_manager):
        """Test the set-secret CLI command"""
        mock_manager.validate_secret_name.return_value = True
        mock_manager.set_secret.return_value = True

        result = runner.invoke(set_secret, ["API_KEY", "new-value"])
        assert result.exit_code == 0
>       assert "Secret 'API_KEY' has been set" in result.output
E       assert "Secret 'API_KEY' has been set" in ''
E        +  where '' = <Result okay>.output

tests/body/cli/commands/test_fix.py:229: AssertionError
___________________________________________________________ TestSecretsCLI.test_set_secret_invalid_name ____________________________________________________________

self = <test_fix.TestSecretsCLI object at 0x798960bbe7e0>, runner = <click.testing.CliRunner object at 0x798956b63230>
mock_manager = <MagicMock name='SecretManager()' id='133630772252976'>

    def test_set_secret_invalid_name(self, runner, mock_manager):
        """Test set-secret with invalid name"""
        mock_manager.validate_secret_name.return_value = False

        result = runner.invoke(set_secret, ["invalid name", "value"])
>       assert result.exit_code == 1
E       assert 0 == 1
E        +  where 0 = <Result okay>.exit_code

tests/body/cli/commands/test_fix.py:236: AssertionError
____________________________________________________________ TestSecretsCLI.test_delete_secret_command _____________________________________________________________

self = <test_fix.TestSecretsCLI object at 0x798960bbeba0>, runner = <click.testing.CliRunner object at 0x798956bb7650>
mock_manager = <MagicMock name='SecretManager()' id='133630772627024'>

    def test_delete_secret_command(self, runner, mock_manager):
        """Test the delete-secret CLI command"""
        mock_manager.delete_secret.return_value = True

        result = runner.invoke(delete_secret, ["API_KEY"], input="y\n")
        assert result.exit_code == 0
>       assert "Secret 'API_KEY' has been deleted" in result.output
E       assert "Secret 'API_KEY' has been deleted" in ''
E        +  where '' = <Result okay>.output

tests/body/cli/commands/test_fix.py:257: AssertionError
___________________________________________________________ TestSecretsCLI.test_delete_secret_cancelled ____________________________________________________________

self = <test_fix.TestSecretsCLI object at 0x798960bbed80>, runner = <click.testing.CliRunner object at 0x798956bbeab0>
mock_manager = <MagicMock name='SecretManager()' id='133630772640512'>

    def test_delete_secret_cancelled(self, runner, mock_manager):
        """Test delete-secret when user cancels"""
        result = runner.invoke(delete_secret, ["API_KEY"], input="n\n")
        assert result.exit_code == 0
>       assert "Cancelled" in result.output
E       AssertionError: assert 'Cancelled' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/commands/test_fix.py:263: AssertionError
____________________________________________________________ TestSecretsCLI.test_rotate_secrets_command ____________________________________________________________

self = <test_fix.TestSecretsCLI object at 0x798960bbef60>, runner = <click.testing.CliRunner object at 0x798956ba1160>
mock_manager = <MagicMock name='SecretManager()' id='133630772519296'>

    def test_rotate_secrets_command(self, runner, mock_manager):
        """Test the rotate-secrets CLI command"""
        mock_manager.list_secrets.return_value = ["API_KEY", "DB_URL"]
        mock_manager.rotate_secret.return_value = True

        result = runner.invoke(rotate_secrets, input="y\n")
        assert result.exit_code == 0
>       assert "Rotating 2 secrets" in result.output
E       AssertionError: assert 'Rotating 2 secrets' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/commands/test_fix.py:273: AssertionError
____________________________________________________________ TestSecretsCLI.test_export_secrets_command ____________________________________________________________

self = <test_fix.TestSecretsCLI object at 0x798960bbf140>, runner = <click.testing.CliRunner object at 0x798956bbd250>
mock_manager = <MagicMock name='SecretManager()' id='133630772638256'>

    def test_export_secrets_command(self, runner, mock_manager):
        """Test the export-secrets CLI command"""
        export_data = {"API_KEY": "value1", "DB_URL": "value2"}
        mock_manager.export_secrets.return_value = json.dumps(export_data)

        with runner.isolated_filesystem():
            result = runner.invoke(export_secrets, ["--output", "secrets.json"])
            assert result.exit_code == 0
>           assert "Secrets exported to secrets.json" in result.output
E           AssertionError: assert 'Secrets exported to secrets.json' in ''
E            +  where '' = <Result okay>.output

tests/body/cli/commands/test_fix.py:283: AssertionError
___________________________________________________________ TestSecretsCLI.test_export_secrets_encrypted ___________________________________________________________

self = <MagicMock name='SecretManager().export_secrets' id='133630778791536'>, args = (), kwargs = {'decrypt': False}, expected = 'export_secrets(decrypt=False)'
actual = 'not called.', error_message = 'expected call not found.\nExpected: export_secrets(decrypt=False)\n  Actual: not called.'

    def assert_called_with(self, /, *args, **kwargs):
        """assert that the last call was made with the specified arguments.

        Raises an AssertionError if the args and keyword args passed in are
        different to the last call to the mock."""
        if self.call_args is None:
            expected = self._format_mock_call_signature(args, kwargs)
            actual = 'not called.'
            error_message = ('expected call not found.\nExpected: %s\n  Actual: %s'
                    % (expected, actual))
>           raise AssertionError(error_message)
E           AssertionError: expected call not found.
E           Expected: export_secrets(decrypt=False)
E             Actual: not called.

/usr/lib/python3.12/unittest/mock.py:935: AssertionError

During handling of the above exception, another exception occurred:

self = <test_fix.TestSecretsCLI object at 0x798960bbf320>, runner = <click.testing.CliRunner object at 0x79895719f620>
mock_manager = <MagicMock name='SecretManager()' id='133630779191568'>

    def test_export_secrets_encrypted(self, runner, mock_manager):
        """Test export-secrets with encryption"""
        mock_manager.export_secrets.return_value = '{"encrypted": "data"}'

        result = runner.invoke(export_secrets, ["--encrypted"])
        assert result.exit_code == 0
>       mock_manager.export_secrets.assert_called_with(decrypt=False)
E       AssertionError: expected call not found.
E       Expected: export_secrets(decrypt=False)
E         Actual: not called.

tests/body/cli/commands/test_fix.py:295: AssertionError
____________________________________________________________ TestSecretsCLI.test_import_secrets_command ____________________________________________________________

self = <test_fix.TestSecretsCLI object at 0x798960bbf500>, runner = <click.testing.CliRunner object at 0x7989571e9550>
mock_manager = <MagicMock name='SecretManager()' id='133630779101008'>

    def test_import_secrets_command(self, runner, mock_manager):
        """Test the import-secrets CLI command"""
        mock_manager.import_secrets.return_value = True

        with runner.isolated_filesystem():
            # Create test file
            import_data = {"API_KEY": "imported"}
            with open("secrets.json", "w") as f:
                json.dump(import_data, f)

            result = runner.invoke(import_secrets, ["secrets.json"])
            assert result.exit_code == 0
>           assert "Secrets imported successfully" in result.output
E           AssertionError: assert 'Secrets imported successfully' in ''
E            +  where '' = <Result okay>.output

tests/body/cli/commands/test_fix.py:309: AssertionError
___________________________________________________________ TestSecretsCLI.test_import_secrets_overwrite ___________________________________________________________

self = <MagicMock name='SecretManager().import_secrets' id='133630778872688'>, args = ('{"API_KEY": "new"}',), kwargs = {'overwrite': True}
expected = 'import_secrets(\'{"API_KEY": "new"}\', overwrite=True)', actual = 'not called.'
error_message = 'expected call not found.\nExpected: import_secrets(\'{"API_KEY": "new"}\', overwrite=True)\n  Actual: not called.'

    def assert_called_with(self, /, *args, **kwargs):
        """assert that the last call was made with the specified arguments.

        Raises an AssertionError if the args and keyword args passed in are
        different to the last call to the mock."""
        if self.call_args is None:
            expected = self._format_mock_call_signature(args, kwargs)
            actual = 'not called.'
            error_message = ('expected call not found.\nExpected: %s\n  Actual: %s'
                    % (expected, actual))
>           raise AssertionError(error_message)
E           AssertionError: expected call not found.
E           Expected: import_secrets('{"API_KEY": "new"}', overwrite=True)
E             Actual: not called.

/usr/lib/python3.12/unittest/mock.py:935: AssertionError

During handling of the above exception, another exception occurred:

self = <test_fix.TestSecretsCLI object at 0x798960bbf6e0>, runner = <click.testing.CliRunner object at 0x7989571b0f80>
mock_manager = <MagicMock name='SecretManager()' id='133630778867792'>

    def test_import_secrets_overwrite(self, runner, mock_manager):
        """Test import-secrets with overwrite flag"""
        mock_manager.import_secrets.return_value = True

        with runner.isolated_filesystem():
            with open("secrets.json", "w") as f:
                json.dump({"API_KEY": "new"}, f)

            result = runner.invoke(import_secrets, ["secrets.json", "--overwrite"])
            assert result.exit_code == 0
>           mock_manager.import_secrets.assert_called_with(
                '{"API_KEY": "new"}',
                overwrite=True
            )
E           AssertionError: expected call not found.
E           Expected: import_secrets('{"API_KEY": "new"}', overwrite=True)
E             Actual: not called.

tests/body/cli/commands/test_fix.py:321: AssertionError
__________________________________________________________ TestSecretsCLI.test_verify_encryption_command ___________________________________________________________

self = <test_fix.TestSecretsCLI object at 0x798960bbf8c0>, runner = <click.testing.CliRunner object at 0x79895716fb60>
mock_manager = <MagicMock name='SecretManager()' id='133630772454384'>

    def test_verify_encryption_command(self, runner, mock_manager):
        """Test the verify-encryption CLI command"""
        mock_manager.verify_encryption.return_value = True

        result = runner.invoke(verify_encryption)
        assert result.exit_code == 0
>       assert "Encryption is properly configured" in result.output
E       AssertionError: assert 'Encryption is properly configured' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/commands/test_fix.py:332: AssertionError
___________________________________________________________ TestSecretsCLI.test_verify_encryption_failed ___________________________________________________________

self = <test_fix.TestSecretsCLI object at 0x798960bbfaa0>, runner = <click.testing.CliRunner object at 0x798956b89fa0>
mock_manager = <MagicMock name='SecretManager()' id='133630772425504'>

    def test_verify_encryption_failed(self, runner, mock_manager):
        """Test verify-encryption when encryption is broken"""
        mock_manager.verify_encryption.return_value = False

        result = runner.invoke(verify_encryption)
>       assert result.exit_code == 1
E       assert 0 == 1
E        +  where 0 = <Result okay>.exit_code

tests/body/cli/commands/test_fix.py:339: AssertionError
________________________________________________________________ TestSecretStorage.test_save_secret ________________________________________________________________

self = <test_fix.TestSecretStorage object at 0x798960bbfa10>, storage = <MagicMock name='mock.SecretStorage()' id='133630772447904'>

    def test_save_secret(self, storage):
        """Test saving a secret to database"""
        result = storage.save("API_KEY", b"encrypted_value")
>       assert result is True
E       AssertionError: assert <MagicMock name='mock.SecretStorage().save()' id='133630778881856'> is True

tests/body/cli/commands/test_fix.py:357: AssertionError
________________________________________________________________ TestSecretStorage.test_get_secret _________________________________________________________________

self = <test_fix.TestSecretStorage object at 0x798960bbf470>, storage = <MagicMock name='mock.SecretStorage()' id='133630772447904'>

    def test_get_secret(self, storage):
        """Test retrieving a secret from database"""
        mock_secret = Mock()
        mock_secret.encrypted_value = b"encrypted"
        storage.session.query().filter_by().first.return_value = mock_secret

        result = storage.get("API_KEY")
>       assert result == b"encrypted"
E       AssertionError: assert <MagicMock na...630778828288'> == b'encrypted'
E
E         Full diff:
E         - (b'encrypted')
E         + <MagicMock name='mock.SecretStorage().get()' id='133630778828288'>

tests/body/cli/commands/test_fix.py:367: AssertionError
___________________________________________________________ TestSecretStorage.test_get_secret_not_found ____________________________________________________________

self = <test_fix.TestSecretStorage object at 0x798960bbee70>, storage = <MagicMock name='mock.SecretStorage()' id='133630772447904'>

    def test_get_secret_not_found(self, storage):
        """Test retrieving non-existent secret"""
        storage.session.query().filter_by().first.return_value = None

        result = storage.get("NONEXISTENT")
>       assert result is None
E       AssertionError: assert <MagicMock name='mock.SecretStorage().get()' id='133630778828288'> is None

tests/body/cli/commands/test_fix.py:374: AssertionError
_______________________________________________________________ TestSecretStorage.test_delete_secret _______________________________________________________________

self = <test_fix.TestSecretStorage object at 0x798960bbe630>, storage = <MagicMock name='mock.SecretStorage()' id='133630772447904'>

    def test_delete_secret(self, storage):
        """Test deleting a secret"""
        mock_secret = Mock()
        storage.session.query().filter_by().first.return_value = mock_secret

        result = storage.delete("API_KEY")
>       assert result is True
E       AssertionError: assert <MagicMock name='mock.SecretStorage().delete()' id='133630860674784'> is True

tests/body/cli/commands/test_fix.py:382: AssertionError
_____________________________________________________________ TestSecretStorage.test_list_all_secrets ______________________________________________________________

self = <test_fix.TestSecretStorage object at 0x798960bbe1b0>, storage = <MagicMock name='mock.SecretStorage()' id='133630772447904'>

    def test_list_all_secrets(self, storage):
        """Test listing all secret names"""
        mock_secrets = [
            Mock(name="API_KEY"),
            Mock(name="DB_URL"),
            Mock(name="TOKEN")
        ]
        storage.session.query().all.return_value = mock_secrets

        result = storage.list_all()
>       assert len(result) == 3
E       AssertionError: assert 0 == 3
E        +  where 0 = len(<MagicMock name='mock.SecretStorage().list_all()' id='133630848385440'>)

tests/body/cli/commands/test_fix.py:396: AssertionError
______________________________________________________________ TestSecretStorage.test_get_all_secrets ______________________________________________________________

self = <test_fix.TestSecretStorage object at 0x798960bbd430>, storage = <MagicMock name='mock.SecretStorage()' id='133630772447904'>

    def test_get_all_secrets(self, storage):
        """Test getting all secrets with values"""
        mock_secrets = [
            Mock(name="API_KEY", encrypted_value=b"enc1"),
            Mock(name="DB_URL", encrypted_value=b"enc2")
        ]
        storage.session.query().all.return_value = mock_secrets

        result = storage.get_all()
>       assert len(result) == 2
E       AssertionError: assert 0 == 2
E        +  where 0 = len(<MagicMock name='mock.SecretStorage().get_all()' id='133630771866192'>)

tests/body/cli/commands/test_fix.py:408: AssertionError
_______________________________________________________________ TestSecretStorage.test_update_secret _______________________________________________________________

self = <test_fix.TestSecretStorage object at 0x798960bbfe60>, storage = <MagicMock name='mock.SecretStorage()' id='133630772447904'>

    def test_update_secret(self, storage):
        """Test updating an existing secret"""
        mock_secret = Mock()
        storage.session.query().filter_by().first.return_value = mock_secret

        result = storage.update("API_KEY", b"new_encrypted")
>       assert result is True
E       AssertionError: assert <MagicMock name='mock.SecretStorage().update()' id='133630772205552'> is True

tests/body/cli/commands/test_fix.py:417: AssertionError
__________________________________________________________________ TestSecretStorage.test_exists ___________________________________________________________________

self = <test_fix.TestSecretStorage object at 0x798960be4080>, storage = <MagicMock name='mock.SecretStorage()' id='133630772447904'>

    def test_exists(self, storage):
        """Test checking if secret exists"""
        storage.session.query().filter_by().first.return_value = Mock()
>       assert storage.exists("API_KEY") is True
E       AssertionError: assert <MagicMock name='mock.SecretStorage().exists()' id='133630779112528'> is True
E        +  where <MagicMock name='mock.SecretStorage().exists()' id='133630779112528'> = <MagicMock name='mock.SecretStorage().exists' id='133630779092832'>('API_KEY')
E        +    where <MagicMock name='mock.SecretStorage().exists' id='133630779092832'> = <MagicMock name='mock.SecretStorage()' id='133630772447904'>.exists

tests/body/cli/commands/test_fix.py:424: AssertionError
_________________________________________________________ TestErrorHandling.test_database_connection_error _________________________________________________________

self = <test_fix.TestErrorHandling object at 0x798960be49b0>, runner = <click.testing.CliRunner object at 0x7989571e8080>

    def test_database_connection_error(self, runner):
        """Test handling database connection errors"""
        with patch('src.body.cli.commands.secrets.get_db_session') as mock:
            mock.side_effect = Exception("Database connection failed")

            result = runner.invoke(list_secrets)
>           assert result.exit_code == 1
E           assert 0 == 1
E            +  where 0 = <Result okay>.exit_code

tests/body/cli/commands/test_fix.py:487: AssertionError
_____________________________________________________________ TestErrorHandling.test_encryption_error ______________________________________________________________

self = <test_fix.TestErrorHandling object at 0x798960be4b90>, runner = <click.testing.CliRunner object at 0x79895bb69640>

    def test_encryption_error(self, runner):
        """Test handling encryption errors"""
        with patch('src.body.cli.commands.secrets.Fernet') as mock:
            mock.side_effect = Exception("Encryption failed")

            result = runner.invoke(set_secret, ["API_KEY", "value"])
>           assert result.exit_code == 1
E           assert 0 == 1
E            +  where 0 = <Result okay>.exit_code

tests/body/cli/commands/test_fix.py:496: AssertionError
_____________________________________________________________ TestErrorHandling.test_json_parse_error ______________________________________________________________

self = <test_fix.TestErrorHandling object at 0x798960be4d70>, runner = <click.testing.CliRunner object at 0x79895bfa8680>

    def test_json_parse_error(self, runner):
        """Test handling JSON parse errors in import"""
        with runner.isolated_filesystem():
            with open("invalid.json", "w") as f:
                f.write("not valid json")

            result = runner.invoke(import_secrets, ["invalid.json"])
>           assert result.exit_code == 1
E           assert 0 == 1
E            +  where 0 = <Result okay>.exit_code

tests/body/cli/commands/test_fix.py:506: AssertionError
____________________________________________________________ TestIntegration.test_full_secret_lifecycle ____________________________________________________________

self = <test_fix.TestIntegration object at 0x798960be5070>

    @pytest.mark.integration
    def test_full_secret_lifecycle(self):
        """Test complete secret lifecycle: create, read, update, delete"""
        manager = SecretManager()

        # Create
>       assert manager.set_secret("TEST_KEY", "initial-value") is True
E       AssertionError: assert <MagicMock name='mock.SecretManager().set_secret()' id='133630779088800'> is True
E        +  where <MagicMock name='mock.SecretManager().set_secret()' id='133630779088800'> = <MagicMock name='mock.SecretManager().set_secret' id='133630779101440'>('TEST_KEY', 'initial-value')
E        +    where <MagicMock name='mock.SecretManager().set_secret' id='133630779101440'> = <MagicMock name='mock.SecretManager()' id='133630779187392'>.set_secret

tests/body/cli/commands/test_fix.py:519: AssertionError
___________________________________________________________ TestIntegration.test_export_import_roundtrip ___________________________________________________________

self = <test_fix.TestIntegration object at 0x798960be5220>

    @pytest.mark.integration
    def test_export_import_roundtrip(self):
        """Test exporting and importing secrets"""
        manager = SecretManager()

        # Set up test secrets
        test_secrets = {
            "API_KEY": "test-api-key",
            "DB_PASSWORD": "test-db-pass",
            "TOKEN": "test-token"
        }

        for name, value in test_secrets.items():
            manager.set_secret(name, value)

        # Export
        exported = manager.export_secrets(decrypt=True)

        # Clear secrets
        for name in test_secrets:
            manager.delete_secret(name)

        # Import
        manager.import_secrets(exported, overwrite=False)

        # Verify
        for name, expected_value in test_secrets.items():
            actual_value = manager.get_secret(name)
>           assert actual_value == expected_value
E           AssertionError: assert <MagicMock name='mock.SecretManager().get_secret()' id='133630779048976'> == 'test-api-key'

tests/body/cli/commands/test_fix.py:566: AssertionError
_______________________________________________________________ TestSecretManager.test_encrypt_value _______________________________________________________________

self = <test_secrets.TestSecretManager object at 0x798960710800>, secret_manager = <MagicMock name='mock.SecretManager()' id='133630848166528'>

    def test_encrypt_value(self, secret_manager):
        """Test encrypting a secret value"""
        test_value = "my-secret-password"
        encrypted = secret_manager.encrypt_value(test_value)
        assert encrypted != test_value
>       assert isinstance(encrypted, bytes)
E       AssertionError: assert False
E        +  where False = isinstance(<MagicMock name='mock.SecretManager().encrypt_value()' id='133630848355264'>, bytes)

tests/body/cli/commands/test_secrets.py:79: AssertionError
_______________________________________________________________ TestSecretManager.test_decrypt_value _______________________________________________________________

self = <test_secrets.TestSecretManager object at 0x7989607109e0>, secret_manager = <MagicMock name='mock.SecretManager()' id='133630848166528'>

    def test_decrypt_value(self, secret_manager):
        """Test decrypting a secret value"""
        test_value = "my-secret-password"
        encrypted = secret_manager.encrypt_value(test_value)
        decrypted = secret_manager.decrypt_value(encrypted)
>       assert decrypted == test_value
E       AssertionError: assert <MagicMock name='mock.SecretManager().decrypt_value()' id='133630772496720'> == 'my-secret-password'

tests/body/cli/commands/test_secrets.py:86: AssertionError
________________________________________________________ TestSecretManager.test_validate_secret_name_valid _________________________________________________________

self = <test_secrets.TestSecretManager object at 0x798960710bc0>, secret_manager = <MagicMock name='mock.SecretManager()' id='133630848166528'>

    def test_validate_secret_name_valid(self, secret_manager):
        """Test validating valid secret names"""
        valid_names = [
            "API_KEY",
            "DATABASE_URL",
            "SECRET_TOKEN_123",
            "MY_SECRET",
        ]
        for name in valid_names:
>           assert secret_manager.validate_secret_name(name) is True
E           AssertionError: assert <MagicMock name='mock.SecretManager().validate_secret_name()' id='133630778706928'> is True
E            +  where <MagicMock name='mock.SecretManager().validate_secret_name()' id='133630778706928'> = <MagicMock name='mock.SecretManager().validate_secret_name' id='133630778819504'>('API_KEY')
E            +    where <MagicMock name='mock.SecretManager().validate_secret_name' id='133630778819504'> = <MagicMock name='mock.SecretManager()' id='133630848166528'>.validate_secret_name

tests/body/cli/commands/test_secrets.py:97: AssertionError
_______________________________________________________ TestSecretManager.test_validate_secret_name_invalid ________________________________________________________

self = <test_secrets.TestSecretManager object at 0x798960710da0>, secret_manager = <MagicMock name='mock.SecretManager()' id='133630848166528'>

    def test_validate_secret_name_invalid(self, secret_manager):
        """Test validating invalid secret names"""
        invalid_names = [
            "",
            " ",
            "secret with spaces",
            "secret-with-dashes",
            "123startswithnumber",
            "secret.with.dots",
        ]
        for name in invalid_names:
>           assert secret_manager.validate_secret_name(name) is False
E           AssertionError: assert <MagicMock name='mock.SecretManager().validate_secret_name()' id='133630778706928'> is False
E            +  where <MagicMock name='mock.SecretManager().validate_secret_name()' id='133630778706928'> = <MagicMock name='mock.SecretManager().validate_secret_name' id='133630778819504'>('')
E            +    where <MagicMock name='mock.SecretManager().validate_secret_name' id='133630778819504'> = <MagicMock name='mock.SecretManager()' id='133630848166528'>.validate_secret_name

tests/body/cli/commands/test_secrets.py:110: AssertionError
________________________________________________________________ TestSecretManager.test_set_secret _________________________________________________________________

self = <test_secrets.TestSecretManager object at 0x798960710f80>, secret_manager = <MagicMock name='mock.SecretManager()' id='133630848166528'>

    def test_set_secret(self, secret_manager):
        """Test setting a secret"""
        result = secret_manager.set_secret("API_KEY", "test-key-123")
>       assert result is True
E       AssertionError: assert <MagicMock name='mock.SecretManager().set_secret()' id='133630848363760'> is True

tests/body/cli/commands/test_secrets.py:115: AssertionError
________________________________________________________________ TestSecretManager.test_get_secret _________________________________________________________________

self = <MagicMock name='SecretStorage.get' id='133630778862928'>, args = ('API_KEY',), kwargs = {}, expected = "get('API_KEY')", actual = 'not called.'
error_message = "expected call not found.\nExpected: get('API_KEY')\n  Actual: not called."

    def assert_called_with(self, /, *args, **kwargs):
        """assert that the last call was made with the specified arguments.

        Raises an AssertionError if the args and keyword args passed in are
        different to the last call to the mock."""
        if self.call_args is None:
            expected = self._format_mock_call_signature(args, kwargs)
            actual = 'not called.'
            error_message = ('expected call not found.\nExpected: %s\n  Actual: %s'
                    % (expected, actual))
>           raise AssertionError(error_message)
E           AssertionError: expected call not found.
E           Expected: get('API_KEY')
E             Actual: not called.

/usr/lib/python3.12/unittest/mock.py:935: AssertionError

During handling of the above exception, another exception occurred:

self = <test_secrets.TestSecretManager object at 0x798960711160>, secret_manager = <MagicMock name='mock.SecretManager()' id='133630848166528'>

    def test_get_secret(self, secret_manager):
        """Test getting a secret"""
        secret_manager.storage.get.return_value = b"encrypted_value"
        result = secret_manager.get_secret("API_KEY")
        assert result is not None
>       secret_manager.storage.get.assert_called_with("API_KEY")
E       AssertionError: expected call not found.
E       Expected: get('API_KEY')
E         Actual: not called.

tests/body/cli/commands/test_secrets.py:123: AssertionError
_______________________________________________________________ TestSecretManager.test_delete_secret _______________________________________________________________

self = <test_secrets.TestSecretManager object at 0x798960711340>, secret_manager = <MagicMock name='mock.SecretManager()' id='133630848166528'>

    def test_delete_secret(self, secret_manager):
        """Test deleting a secret"""
        secret_manager.storage.delete.return_value = True
        result = secret_manager.delete_secret("API_KEY")
>       assert result is True
E       AssertionError: assert <MagicMock name='mock.SecretManager().delete_secret()' id='133630608894208'> is True

tests/body/cli/commands/test_secrets.py:129: AssertionError
_______________________________________________________________ TestSecretManager.test_list_secrets ________________________________________________________________

self = <test_secrets.TestSecretManager object at 0x798960711520>, secret_manager = <MagicMock name='mock.SecretManager()' id='133630848166528'>

    def test_list_secrets(self, secret_manager):
        """Test listing all secrets"""
        secret_manager.storage.list_all.return_value = ["API_KEY", "DB_URL", "TOKEN"]
        result = secret_manager.list_secrets()
>       assert len(result) == 3
E       AssertionError: assert 0 == 3
E        +  where 0 = len(<MagicMock name='mock.SecretManager().list_secrets()' id='133630608566960'>)

tests/body/cli/commands/test_secrets.py:136: AssertionError
_______________________________________________________________ TestSecretManager.test_rotate_secret _______________________________________________________________

self = <test_secrets.TestSecretManager object at 0x798960711700>, secret_manager = <MagicMock name='mock.SecretManager()' id='133630848166528'>

    def test_rotate_secret(self, secret_manager):
        """Test rotating a secret"""
        old_value = "old-secret"
        new_value = "new-secret"
        secret_manager.storage.get.return_value = secret_manager.encrypt_value(old_value)

        result = secret_manager.rotate_secret("API_KEY", new_value)
>       assert result is True
E       AssertionError: assert <MagicMock name='mock.SecretManager().rotate_secret()' id='133630608590704'> is True

tests/body/cli/commands/test_secrets.py:146: AssertionError
______________________________________________________________ TestSecretManager.test_export_secrets _______________________________________________________________

self = <test_secrets.TestSecretManager object at 0x7989607118e0>, secret_manager = <MagicMock name='mock.SecretManager()' id='133630848166528'>

    def test_export_secrets(self, secret_manager):
        """Test exporting secrets to JSON"""
        secrets = {
            "API_KEY": "test-key",
            "DB_URL": "postgres://localhost"
        }
        secret_manager.storage.get_all.return_value = secrets

        exported = secret_manager.export_secrets(decrypt=True)
>       assert isinstance(exported, str)
E       AssertionError: assert False
E        +  where False = isinstance(<MagicMock name='mock.SecretManager().export_secrets()' id='133630608526464'>, str)

tests/body/cli/commands/test_secrets.py:158: AssertionError
______________________________________________________________ TestSecretManager.test_import_secrets _______________________________________________________________

self = <test_secrets.TestSecretManager object at 0x798960711ac0>, secret_manager = <MagicMock name='mock.SecretManager()' id='133630848166528'>

    def test_import_secrets(self, secret_manager):
        """Test importing secrets from JSON"""
        import_data = {
            "API_KEY": "new-key",
            "TOKEN": "new-token"
        }
        json_str = json.dumps(import_data)

        result = secret_manager.import_secrets(json_str, overwrite=True)
>       assert result is True
E       AssertionError: assert <MagicMock name='mock.SecretManager().import_secrets()' id='133630608786256'> is True

tests/body/cli/commands/test_secrets.py:171: AssertionError
_____________________________________________________________ TestSecretsCLI.test_list_secrets_command _____________________________________________________________

self = <test_secrets.TestSecretsCLI object at 0x798960711e50>, runner = <click.testing.CliRunner object at 0x79894cf7db20>
mock_manager = <MagicMock name='SecretManager()' id='133630608796432'>

    def test_list_secrets_command(self, runner, mock_manager):
        """Test the list-secrets CLI command"""
        mock_manager.list_secrets.return_value = ["API_KEY", "DB_URL"]

        result = runner.invoke(list_secrets)
        assert result.exit_code == 0
>       assert "API_KEY" in result.output
E       AssertionError: assert 'API_KEY' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/commands/test_secrets.py:195: AssertionError
______________________________________________________________ TestSecretsCLI.test_list_secrets_empty ______________________________________________________________

self = <test_secrets.TestSecretsCLI object at 0x798960712030>, runner = <click.testing.CliRunner object at 0x79894cffbb30>
mock_manager = <MagicMock name='SecretManager()' id='133630609300304'>

    def test_list_secrets_empty(self, runner, mock_manager):
        """Test list-secrets when no secrets exist"""
        mock_manager.list_secrets.return_value = []

        result = runner.invoke(list_secrets)
        assert result.exit_code == 0
>       assert "No secrets found" in result.output
E       AssertionError: assert 'No secrets found' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/commands/test_secrets.py:204: AssertionError
______________________________________________________________ TestSecretsCLI.test_get_secret_command ______________________________________________________________

self = <test_secrets.TestSecretsCLI object at 0x798960712210>, runner = <click.testing.CliRunner object at 0x79894cfdb260>
mock_manager = <MagicMock name='SecretManager()' id='133630609166688'>

    def test_get_secret_command(self, runner, mock_manager):
        """Test the get-secret CLI command"""
        mock_manager.get_secret.return_value = "my-secret-value"

        result = runner.invoke(get_secret, ["API_KEY"])
        assert result.exit_code == 0
>       assert "my-secret-value" in result.output
E       AssertionError: assert 'my-secret-value' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/commands/test_secrets.py:212: AssertionError
_____________________________________________________________ TestSecretsCLI.test_get_secret_not_found _____________________________________________________________

self = <test_secrets.TestSecretsCLI object at 0x7989607123f0>, runner = <click.testing.CliRunner object at 0x79894cffaa20>
mock_manager = <MagicMock name='SecretManager()' id='133630609300256'>

    def test_get_secret_not_found(self, runner, mock_manager):
        """Test get-secret when secret doesn't exist"""
        mock_manager.get_secret.return_value = None

        result = runner.invoke(get_secret, ["NONEXISTENT"])
>       assert result.exit_code == 1
E       assert 0 == 1
E        +  where 0 = <Result okay>.exit_code

tests/body/cli/commands/test_secrets.py:219: AssertionError
______________________________________________________________ TestSecretsCLI.test_set_secret_command ______________________________________________________________

self = <test_secrets.TestSecretsCLI object at 0x798960712060>, runner = <click.testing.CliRunner object at 0x79894cf7ffb0>
mock_manager = <MagicMock name='SecretManager()' id='133630608797488'>

    def test_set_secret_command(self, runner, mock_manager):
        """Test the set-secret CLI command"""
        mock_manager.validate_secret_name.return_value = True
        mock_manager.set_secret.return_value = True

        result = runner.invoke(set_secret, ["API_KEY", "new-value"])
        assert result.exit_code == 0
>       assert "Secret 'API_KEY' has been set" in result.output
E       assert "Secret 'API_KEY' has been set" in ''
E        +  where '' = <Result okay>.output

tests/body/cli/commands/test_secrets.py:229: AssertionError
___________________________________________________________ TestSecretsCLI.test_set_secret_invalid_name ____________________________________________________________

self = <test_secrets.TestSecretsCLI object at 0x798960711a30>, runner = <click.testing.CliRunner object at 0x7989571e8290>
mock_manager = <MagicMock name='SecretManager()' id='133630608895216'>

    def test_set_secret_invalid_name(self, runner, mock_manager):
        """Test set-secret with invalid name"""
        mock_manager.validate_secret_name.return_value = False

        result = runner.invoke(set_secret, ["invalid name", "value"])
>       assert result.exit_code == 1
E       assert 0 == 1
E        +  where 0 = <Result okay>.exit_code

tests/body/cli/commands/test_secrets.py:236: AssertionError
____________________________________________________________ TestSecretsCLI.test_delete_secret_command _____________________________________________________________

self = <test_secrets.TestSecretsCLI object at 0x798960710bf0>, runner = <click.testing.CliRunner object at 0x7989571ad220>
mock_manager = <MagicMock name='SecretManager()' id='133630609026624'>

    def test_delete_secret_command(self, runner, mock_manager):
        """Test the delete-secret CLI command"""
        mock_manager.delete_secret.return_value = True

        result = runner.invoke(delete_secret, ["API_KEY"], input="y\n")
        assert result.exit_code == 0
>       assert "Secret 'API_KEY' has been deleted" in result.output
E       assert "Secret 'API_KEY' has been deleted" in ''
E        +  where '' = <Result okay>.output

tests/body/cli/commands/test_secrets.py:257: AssertionError
___________________________________________________________ TestSecretsCLI.test_delete_secret_cancelled ____________________________________________________________

self = <test_secrets.TestSecretsCLI object at 0x7989607107a0>, runner = <click.testing.CliRunner object at 0x79894cfa5340>
mock_manager = <MagicMock name='SecretManager()' id='133630608958400'>

    def test_delete_secret_cancelled(self, runner, mock_manager):
        """Test delete-secret when user cancels"""
        result = runner.invoke(delete_secret, ["API_KEY"], input="n\n")
        assert result.exit_code == 0
>       assert "Cancelled" in result.output
E       AssertionError: assert 'Cancelled' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/commands/test_secrets.py:263: AssertionError
____________________________________________________________ TestSecretsCLI.test_rotate_secrets_command ____________________________________________________________

self = <test_secrets.TestSecretsCLI object at 0x798960712630>, runner = <click.testing.CliRunner object at 0x79894cfa7c50>
mock_manager = <MagicMock name='SecretManager()' id='133630608657584'>

    def test_rotate_secrets_command(self, runner, mock_manager):
        """Test the rotate-secrets CLI command"""
        mock_manager.list_secrets.return_value = ["API_KEY", "DB_URL"]
        mock_manager.rotate_secret.return_value = True

        result = runner.invoke(rotate_secrets, input="y\n")
        assert result.exit_code == 0
>       assert "Rotating 2 secrets" in result.output
E       AssertionError: assert 'Rotating 2 secrets' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/commands/test_secrets.py:273: AssertionError
____________________________________________________________ TestSecretsCLI.test_export_secrets_command ____________________________________________________________

self = <test_secrets.TestSecretsCLI object at 0x798960712810>, runner = <click.testing.CliRunner object at 0x79894cd97c50>
mock_manager = <MagicMock name='SecretManager()' id='133630606216416'>

    def test_export_secrets_command(self, runner, mock_manager):
        """Test the export-secrets CLI command"""
        export_data = {"API_KEY": "value1", "DB_URL": "value2"}
        mock_manager.export_secrets.return_value = json.dumps(export_data)

        with runner.isolated_filesystem():
            result = runner.invoke(export_secrets, ["--output", "secrets.json"])
            assert result.exit_code == 0
>           assert "Secrets exported to secrets.json" in result.output
E           AssertionError: assert 'Secrets exported to secrets.json' in ''
E            +  where '' = <Result okay>.output

tests/body/cli/commands/test_secrets.py:283: AssertionError
___________________________________________________________ TestSecretsCLI.test_export_secrets_encrypted ___________________________________________________________

self = <MagicMock name='SecretManager().export_secrets' id='133630608664688'>, args = (), kwargs = {'decrypt': False}, expected = 'export_secrets(decrypt=False)'
actual = 'not called.', error_message = 'expected call not found.\nExpected: export_secrets(decrypt=False)\n  Actual: not called.'

    def assert_called_with(self, /, *args, **kwargs):
        """assert that the last call was made with the specified arguments.

        Raises an AssertionError if the args and keyword args passed in are
        different to the last call to the mock."""
        if self.call_args is None:
            expected = self._format_mock_call_signature(args, kwargs)
            actual = 'not called.'
            error_message = ('expected call not found.\nExpected: %s\n  Actual: %s'
                    % (expected, actual))
>           raise AssertionError(error_message)
E           AssertionError: expected call not found.
E           Expected: export_secrets(decrypt=False)
E             Actual: not called.

/usr/lib/python3.12/unittest/mock.py:935: AssertionError

During handling of the above exception, another exception occurred:

self = <test_secrets.TestSecretsCLI object at 0x7989607129f0>, runner = <click.testing.CliRunner object at 0x79894cf5f9e0>
mock_manager = <MagicMock name='SecretManager()' id='133630608668000'>

    def test_export_secrets_encrypted(self, runner, mock_manager):
        """Test export-secrets with encryption"""
        mock_manager.export_secrets.return_value = '{"encrypted": "data"}'

        result = runner.invoke(export_secrets, ["--encrypted"])
        assert result.exit_code == 0
>       mock_manager.export_secrets.assert_called_with(decrypt=False)
E       AssertionError: expected call not found.
E       Expected: export_secrets(decrypt=False)
E         Actual: not called.

tests/body/cli/commands/test_secrets.py:295: AssertionError
____________________________________________________________ TestSecretsCLI.test_import_secrets_command ____________________________________________________________

self = <test_secrets.TestSecretsCLI object at 0x798960712bd0>, runner = <click.testing.CliRunner object at 0x79894cf5c320>
mock_manager = <MagicMock name='SecretManager()' id='133630608960656'>

    def test_import_secrets_command(self, runner, mock_manager):
        """Test the import-secrets CLI command"""
        mock_manager.import_secrets.return_value = True

        with runner.isolated_filesystem():
            # Create test file
            import_data = {"API_KEY": "imported"}
            with open("secrets.json", "w") as f:
                json.dump(import_data, f)

            result = runner.invoke(import_secrets, ["secrets.json"])
            assert result.exit_code == 0
>           assert "Secrets imported successfully" in result.output
E           AssertionError: assert 'Secrets imported successfully' in ''
E            +  where '' = <Result okay>.output

tests/body/cli/commands/test_secrets.py:309: AssertionError
___________________________________________________________ TestSecretsCLI.test_import_secrets_overwrite ___________________________________________________________

self = <MagicMock name='SecretManager().import_secrets' id='133630608557600'>, args = ('{"API_KEY": "new"}',), kwargs = {'overwrite': True}
expected = 'import_secrets(\'{"API_KEY": "new"}\', overwrite=True)', actual = 'not called.'
error_message = 'expected call not found.\nExpected: import_secrets(\'{"API_KEY": "new"}\', overwrite=True)\n  Actual: not called.'

    def assert_called_with(self, /, *args, **kwargs):
        """assert that the last call was made with the specified arguments.

        Raises an AssertionError if the args and keyword args passed in are
        different to the last call to the mock."""
        if self.call_args is None:
            expected = self._format_mock_call_signature(args, kwargs)
            actual = 'not called.'
            error_message = ('expected call not found.\nExpected: %s\n  Actual: %s'
                    % (expected, actual))
>           raise AssertionError(error_message)
E           AssertionError: expected call not found.
E           Expected: import_secrets('{"API_KEY": "new"}', overwrite=True)
E             Actual: not called.

/usr/lib/python3.12/unittest/mock.py:935: AssertionError

During handling of the above exception, another exception occurred:

self = <test_secrets.TestSecretsCLI object at 0x798960712db0>, runner = <click.testing.CliRunner object at 0x79894cf445c0>
mock_manager = <MagicMock name='SecretManager()' id='133630608557360'>

    def test_import_secrets_overwrite(self, runner, mock_manager):
        """Test import-secrets with overwrite flag"""
        mock_manager.import_secrets.return_value = True

        with runner.isolated_filesystem():
            with open("secrets.json", "w") as f:
                json.dump({"API_KEY": "new"}, f)

            result = runner.invoke(import_secrets, ["secrets.json", "--overwrite"])
            assert result.exit_code == 0
>           mock_manager.import_secrets.assert_called_with(
                '{"API_KEY": "new"}',
                overwrite=True
            )
E           AssertionError: expected call not found.
E           Expected: import_secrets('{"API_KEY": "new"}', overwrite=True)
E             Actual: not called.

tests/body/cli/commands/test_secrets.py:321: AssertionError
__________________________________________________________ TestSecretsCLI.test_verify_encryption_command ___________________________________________________________

self = <test_secrets.TestSecretsCLI object at 0x798960712f90>, runner = <click.testing.CliRunner object at 0x79894cfc4800>
mock_manager = <MagicMock name='SecretManager()' id='133630608797488'>

    def test_verify_encryption_command(self, runner, mock_manager):
        """Test the verify-encryption CLI command"""
        mock_manager.verify_encryption.return_value = True

        result = runner.invoke(verify_encryption)
        assert result.exit_code == 0
>       assert "Encryption is properly configured" in result.output
E       AssertionError: assert 'Encryption is properly configured' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/commands/test_secrets.py:332: AssertionError
___________________________________________________________ TestSecretsCLI.test_verify_encryption_failed ___________________________________________________________

self = <test_secrets.TestSecretsCLI object at 0x798960713170>, runner = <click.testing.CliRunner object at 0x79894cd8f200>
mock_manager = <MagicMock name='SecretManager()' id='133630609212768'>

    def test_verify_encryption_failed(self, runner, mock_manager):
        """Test verify-encryption when encryption is broken"""
        mock_manager.verify_encryption.return_value = False

        result = runner.invoke(verify_encryption)
>       assert result.exit_code == 1
E       assert 0 == 1
E        +  where 0 = <Result okay>.exit_code

tests/body/cli/commands/test_secrets.py:339: AssertionError
________________________________________________________________ TestSecretStorage.test_save_secret ________________________________________________________________

self = <test_secrets.TestSecretStorage object at 0x798960713410>, storage = <MagicMock name='mock.SecretStorage()' id='133630609226448'>

    def test_save_secret(self, storage):
        """Test saving a secret to database"""
        result = storage.save("API_KEY", b"encrypted_value")
>       assert result is True
E       AssertionError: assert <MagicMock name='mock.SecretStorage().save()' id='133630876756128'> is True

tests/body/cli/commands/test_secrets.py:357: AssertionError
________________________________________________________________ TestSecretStorage.test_get_secret _________________________________________________________________

self = <test_secrets.TestSecretStorage object at 0x7989607135c0>, storage = <MagicMock name='mock.SecretStorage()' id='133630609226448'>

    def test_get_secret(self, storage):
        """Test retrieving a secret from database"""
        mock_secret = Mock()
        mock_secret.encrypted_value = b"encrypted"
        storage.session.query().filter_by().first.return_value = mock_secret

        result = storage.get("API_KEY")
>       assert result == b"encrypted"
E       AssertionError: assert <MagicMock na...630606783888'> == b'encrypted'
E
E         Full diff:
E         - (b'encrypted')
E         + <MagicMock name='mock.SecretStorage().get()' id='133630606783888'>

tests/body/cli/commands/test_secrets.py:367: AssertionError
___________________________________________________________ TestSecretStorage.test_get_secret_not_found ____________________________________________________________

self = <test_secrets.TestSecretStorage object at 0x7989607137a0>, storage = <MagicMock name='mock.SecretStorage()' id='133630609226448'>

    def test_get_secret_not_found(self, storage):
        """Test retrieving non-existent secret"""
        storage.session.query().filter_by().first.return_value = None

        result = storage.get("NONEXISTENT")
>       assert result is None
E       AssertionError: assert <MagicMock name='mock.SecretStorage().get()' id='133630606783888'> is None

tests/body/cli/commands/test_secrets.py:374: AssertionError
_______________________________________________________________ TestSecretStorage.test_delete_secret _______________________________________________________________

self = <test_secrets.TestSecretStorage object at 0x798960713980>, storage = <MagicMock name='mock.SecretStorage()' id='133630609226448'>

    def test_delete_secret(self, storage):
        """Test deleting a secret"""
        mock_secret = Mock()
        storage.session.query().filter_by().first.return_value = mock_secret

        result = storage.delete("API_KEY")
>       assert result is True
E       AssertionError: assert <MagicMock name='mock.SecretStorage().delete()' id='133630608965360'> is True

tests/body/cli/commands/test_secrets.py:382: AssertionError
_____________________________________________________________ TestSecretStorage.test_list_all_secrets ______________________________________________________________

self = <test_secrets.TestSecretStorage object at 0x798960713b60>, storage = <MagicMock name='mock.SecretStorage()' id='133630609226448'>

    def test_list_all_secrets(self, storage):
        """Test listing all secret names"""
        mock_secrets = [
            Mock(name="API_KEY"),
            Mock(name="DB_URL"),
            Mock(name="TOKEN")
        ]
        storage.session.query().all.return_value = mock_secrets

        result = storage.list_all()
>       assert len(result) == 3
E       AssertionError: assert 0 == 3
E        +  where 0 = len(<MagicMock name='mock.SecretStorage().list_all()' id='133630607071408'>)

tests/body/cli/commands/test_secrets.py:396: AssertionError
______________________________________________________________ TestSecretStorage.test_get_all_secrets ______________________________________________________________

self = <test_secrets.TestSecretStorage object at 0x798960713d40>, storage = <MagicMock name='mock.SecretStorage()' id='133630609226448'>

    def test_get_all_secrets(self, storage):
        """Test getting all secrets with values"""
        mock_secrets = [
            Mock(name="API_KEY", encrypted_value=b"enc1"),
            Mock(name="DB_URL", encrypted_value=b"enc2")
        ]
        storage.session.query().all.return_value = mock_secrets

        result = storage.get_all()
>       assert len(result) == 2
E       AssertionError: assert 0 == 2
E        +  where 0 = len(<MagicMock name='mock.SecretStorage().get_all()' id='133630606498208'>)

tests/body/cli/commands/test_secrets.py:408: AssertionError
_______________________________________________________________ TestSecretStorage.test_update_secret _______________________________________________________________

self = <test_secrets.TestSecretStorage object at 0x798960713f20>, storage = <MagicMock name='mock.SecretStorage()' id='133630609226448'>

    def test_update_secret(self, storage):
        """Test updating an existing secret"""
        mock_secret = Mock()
        storage.session.query().filter_by().first.return_value = mock_secret

        result = storage.update("API_KEY", b"new_encrypted")
>       assert result is True
E       AssertionError: assert <MagicMock name='mock.SecretStorage().update()' id='133630606210736'> is True

tests/body/cli/commands/test_secrets.py:417: AssertionError
__________________________________________________________________ TestSecretStorage.test_exists ___________________________________________________________________

self = <test_secrets.TestSecretStorage object at 0x79896072c140>, storage = <MagicMock name='mock.SecretStorage()' id='133630609226448'>

    def test_exists(self, storage):
        """Test checking if secret exists"""
        storage.session.query().filter_by().first.return_value = Mock()
>       assert storage.exists("API_KEY") is True
E       AssertionError: assert <MagicMock name='mock.SecretStorage().exists()' id='133630606657248'> is True
E        +  where <MagicMock name='mock.SecretStorage().exists()' id='133630606657248'> = <MagicMock name='mock.SecretStorage().exists' id='133630606609296'>('API_KEY')
E        +    where <MagicMock name='mock.SecretStorage().exists' id='133630606609296'> = <MagicMock name='mock.SecretStorage()' id='133630609226448'>.exists

tests/body/cli/commands/test_secrets.py:424: AssertionError
_________________________________________________________ TestErrorHandling.test_database_connection_error _________________________________________________________

self = <test_secrets.TestErrorHandling object at 0x798960712720>, runner = <click.testing.CliRunner object at 0x79894cd4b950>

    def test_database_connection_error(self, runner):
        """Test handling database connection errors"""
        with patch('src.body.cli.commands.secrets.get_db_session') as mock:
            mock.side_effect = Exception("Database connection failed")

            result = runner.invoke(list_secrets)
>           assert result.exit_code == 1
E           assert 0 == 1
E            +  where 0 = <Result okay>.exit_code

tests/body/cli/commands/test_secrets.py:487: AssertionError
_____________________________________________________________ TestErrorHandling.test_encryption_error ______________________________________________________________

self = <test_secrets.TestErrorHandling object at 0x7989607119d0>, runner = <click.testing.CliRunner object at 0x79894cd49a60>

    def test_encryption_error(self, runner):
        """Test handling encryption errors"""
        with patch('src.body.cli.commands.secrets.Fernet') as mock:
            mock.side_effect = Exception("Encryption failed")

            result = runner.invoke(set_secret, ["API_KEY", "value"])
>           assert result.exit_code == 1
E           assert 0 == 1
E            +  where 0 = <Result okay>.exit_code

tests/body/cli/commands/test_secrets.py:496: AssertionError
_____________________________________________________________ TestErrorHandling.test_json_parse_error ______________________________________________________________

self = <test_secrets.TestErrorHandling object at 0x798960bbfd10>, runner = <click.testing.CliRunner object at 0x79894cd49e50>

    def test_json_parse_error(self, runner):
        """Test handling JSON parse errors in import"""
        with runner.isolated_filesystem():
            with open("invalid.json", "w") as f:
                f.write("not valid json")

            result = runner.invoke(import_secrets, ["invalid.json"])
>           assert result.exit_code == 1
E           assert 0 == 1
E            +  where 0 = <Result okay>.exit_code

tests/body/cli/commands/test_secrets.py:506: AssertionError
____________________________________________________________ TestIntegration.test_full_secret_lifecycle ____________________________________________________________

self = <test_secrets.TestIntegration object at 0x79896072c560>

    @pytest.mark.integration
    def test_full_secret_lifecycle(self):
        """Test complete secret lifecycle: create, read, update, delete"""
        manager = SecretManager()

        # Create
>       assert manager.set_secret("TEST_KEY", "initial-value") is True
E       AssertionError: assert <MagicMock name='mock.SecretManager().set_secret()' id='133630848363760'> is True
E        +  where <MagicMock name='mock.SecretManager().set_secret()' id='133630848363760'> = <MagicMock name='mock.SecretManager().set_secret' id='133630778710768'>('TEST_KEY', 'initial-value')
E        +    where <MagicMock name='mock.SecretManager().set_secret' id='133630778710768'> = <MagicMock name='mock.SecretManager()' id='133630848166528'>.set_secret

tests/body/cli/commands/test_secrets.py:519: AssertionError
___________________________________________________________ TestIntegration.test_export_import_roundtrip ___________________________________________________________

self = <test_secrets.TestIntegration object at 0x79896072c710>

    @pytest.mark.integration
    def test_export_import_roundtrip(self):
        """Test exporting and importing secrets"""
        manager = SecretManager()

        # Set up test secrets
        test_secrets = {
            "API_KEY": "test-api-key",
            "DB_PASSWORD": "test-db-pass",
            "TOKEN": "test-token"
        }

        for name, value in test_secrets.items():
            manager.set_secret(name, value)

        # Export
        exported = manager.export_secrets(decrypt=True)

        # Clear secrets
        for name in test_secrets:
            manager.delete_secret(name)

        # Import
        manager.import_secrets(exported, overwrite=False)

        # Verify
        for name, expected_value in test_secrets.items():
            actual_value = manager.get_secret(name)
>           assert actual_value == expected_value
E           AssertionError: assert <MagicMock name='mock.SecretManager().get_secret()' id='133630927691872'> == 'test-api-key'

tests/body/cli/commands/test_secrets.py:566: AssertionError
_________________________________________________________________ TestAdminCLI.test_admin_cli_help _________________________________________________________________

self = <test_admin_cli.TestAdminCLI object at 0x79896075d730>, runner = <click.testing.CliRunner object at 0x79894cd4fec0>

    def test_admin_cli_help(self, runner):
        """Test admin CLI help command"""
        result = runner.invoke(admin_cli, ["--help"])
        assert result.exit_code == 0
>       assert "CORE Admin CLI" in result.output
E       AssertionError: assert 'CORE Admin CLI' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:63: AssertionError
_______________________________________________________________ TestAdminCLI.test_admin_cli_version ________________________________________________________________

self = <test_admin_cli.TestAdminCLI object at 0x79896075d910>, runner = <click.testing.CliRunner object at 0x79894cddbb90>

    def test_admin_cli_version(self, runner):
        """Test admin CLI version command"""
        result = runner.invoke(admin_cli, ["--version"])
        assert result.exit_code == 0
>       assert "version" in result.output.lower()
E       AssertionError: assert 'version' in ''
E        +  where '' = <built-in method lower of str object at 0xb3c770>()
E        +    where <built-in method lower of str object at 0xb3c770> = ''.lower
E        +      where '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:70: AssertionError
______________________________________________________________ TestAdminCLI.test_admin_cli_no_command ______________________________________________________________

self = <test_admin_cli.TestAdminCLI object at 0x79896075daf0>, runner = <click.testing.CliRunner object at 0x79894cdd8440>

    def test_admin_cli_no_command(self, runner):
        """Test admin CLI with no command shows help"""
        result = runner.invoke(admin_cli)
        assert result.exit_code == 0
>       assert "Usage:" in result.output
E       AssertionError: assert 'Usage:' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:76: AssertionError
_______________________________________________________________ TestStatusCommand.test_status_basic ________________________________________________________________

self = <test_admin_cli.TestStatusCommand object at 0x79896075de80>, runner = <click.testing.CliRunner object at 0x79894cd86630>
mock_service = <MagicMock name='AdminService()' id='133630606734448'>

    def test_status_basic(self, runner, mock_service):
        """Test basic status command"""
        mock_service.get_status.return_value = {
            "autonomy_level": "A1",
            "test_coverage": 38,
            "constitutional_compliance": True,
            "active_agents": ["coder", "tester"],
            "database": "connected"
        }

        result = runner.invoke(status_command)
        assert result.exit_code == 0
>       assert "A1" in result.output
E       AssertionError: assert 'A1' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:103: AssertionError
______________________________________________________________ TestStatusCommand.test_status_detailed ______________________________________________________________

self = <test_admin_cli.TestStatusCommand object at 0x79896075e060>, runner = <click.testing.CliRunner object at 0x79894cfa58e0>
mock_service = <MagicMock name='AdminService()' id='133630608962384'>

    def test_status_detailed(self, runner, mock_service):
        """Test detailed status command"""
        mock_service.get_detailed_status.return_value = {
            "autonomy": {
                "current_level": "A1",
                "capabilities": ["self-healing", "test-generation"],
                "next_level": "A2",
                "requirements_for_next": ["75% coverage", "expanded handlers"]
            },
            "metrics": {
                "test_coverage": 38,
                "code_quality": 85,
                "technical_debt": "low"
            }
        }

        result = runner.invoke(status_command, ["--detailed"])
        assert result.exit_code == 0
>       assert "capabilities" in result.output
E       AssertionError: assert 'capabilities' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:124: AssertionError
____________________________________________________________ TestStatusCommand.test_status_json_format _____________________________________________________________

self = <test_admin_cli.TestStatusCommand object at 0x79896075e240>, runner = <click.testing.CliRunner object at 0x79894cf7f3e0>
mock_service = <MagicMock name='AdminService()' id='133630608798160'>

    def test_status_json_format(self, runner, mock_service):
        """Test status with JSON output"""
        mock_service.get_status.return_value = {"level": "A1", "coverage": 38}

        result = runner.invoke(status_command, ["--format", "json"])
        assert result.exit_code == 0

        # Should be valid JSON
>       data = json.loads(result.output)
               ^^^^^^^^^^^^^^^^^^^^^^^^^

tests/body/cli/test_admin_cli.py:135:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
/usr/lib/python3.12/json/__init__.py:346: in loads
    return _default_decoder.decode(s)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/json/decoder.py:337: in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <json.decoder.JSONDecoder object at 0x798964d13620>, s = '', idx = 0

    def raw_decode(self, s, idx=0):
        """Decode a JSON document from ``s`` (a ``str`` beginning with
        a JSON document) and return a 2-tuple of the Python
        representation and the index in ``s`` where the document ended.

        This can be used to decode a JSON document from a string that may
        have extraneous data at the end.

        """
        try:
            obj, end = self.scan_once(s, idx)
        except StopIteration as err:
>           raise JSONDecodeError("Expecting value", s, err.value) from None
E           json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)

/usr/lib/python3.12/json/decoder.py:355: JSONDecodeError
____________________________________________________________ TestStatusCommand.test_status_yaml_format _____________________________________________________________

self = <test_admin_cli.TestStatusCommand object at 0x79896075e420>, runner = <click.testing.CliRunner object at 0x79894cf4fbc0>
mock_service = <MagicMock name='AdminService()' id='133630608797632'>

    def test_status_yaml_format(self, runner, mock_service):
        """Test status with YAML output"""
        mock_service.get_status.return_value = {"level": "A1", "coverage": 38}

        result = runner.invoke(status_command, ["--format", "yaml"])
        assert result.exit_code == 0

        # Should be valid YAML
        data = yaml.safe_load(result.output)
>       assert data["level"] == "A1"
               ^^^^^^^^^^^^^
E       TypeError: 'NoneType' object is not subscriptable

tests/body/cli/test_admin_cli.py:147: TypeError
__________________________________________________________ TestStatusCommand.test_status_connection_error __________________________________________________________

self = <test_admin_cli.TestStatusCommand object at 0x79896075e600>, runner = <click.testing.CliRunner object at 0x79894cf5c500>
mock_service = <MagicMock name='AdminService()' id='133630608669056'>

    def test_status_connection_error(self, runner, mock_service):
        """Test status when database connection fails"""
        mock_service.get_status.side_effect = ConnectionError("Database unavailable")

        result = runner.invoke(status_command)
>       assert result.exit_code != 0
E       assert 0 != 0
E        +  where 0 = <Result okay>.exit_code

tests/body/cli/test_admin_cli.py:154: AssertionError
_________________________________________________________________ TestAuditCommand.test_audit_all __________________________________________________________________

self = <test_admin_cli.TestAuditCommand object at 0x79896075e930>, runner = <click.testing.CliRunner object at 0x79894cddba10>
mock_audit_manager = <MagicMock name='AuditManager()' id='133630606199984'>

    def test_audit_all(self, runner, mock_audit_manager):
        """Test running all audits"""
        mock_audit_manager.run_all_audits.return_value = {
            "passed": 10,
            "failed": 2,
            "warnings": 5,
            "errors": []
        }

        result = runner.invoke(audit_command)
        assert result.exit_code == 0
>       assert "passed" in result.output
E       AssertionError: assert 'passed' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:181: AssertionError
____________________________________________________________ TestAuditCommand.test_audit_specific_check ____________________________________________________________

self = <test_admin_cli.TestAuditCommand object at 0x79896075e510>, runner = <click.testing.CliRunner object at 0x79894cfe4650>
mock_audit_manager = <MagicMock name='AuditManager()' id='133630606260560'>

    def test_audit_specific_check(self, runner, mock_audit_manager):
        """Test running specific audit check"""
        mock_audit_manager.run_audit.return_value = {
            "check": "coverage",
            "status": "failed",
            "current": 38,
            "required": 75,
            "message": "Coverage below constitutional requirement"
        }

        result = runner.invoke(audit_command, ["--check", "coverage"])
        assert result.exit_code == 0
>       assert "Coverage below constitutional requirement" in result.output
E       AssertionError: assert 'Coverage below constitutional requirement' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:195: AssertionError
___________________________________________________________ TestAuditCommand.test_audit_multiple_checks ____________________________________________________________

self = <test_admin_cli.TestAuditCommand object at 0x79896075dd60>, runner = <click.testing.CliRunner object at 0x79894cd76a80>
mock_audit_manager = <MagicMock name='AuditManager()' id='133630606919008'>

    def test_audit_multiple_checks(self, runner, mock_audit_manager):
        """Test running multiple specific checks"""
        mock_audit_manager.run_audit.return_value = {"status": "passed"}

        result = runner.invoke(
            audit_command,
            ["--check", "coverage", "--check", "imports", "--check", "docstrings"]
        )
        assert result.exit_code == 0
>       assert mock_audit_manager.run_audit.call_count == 3
E       AssertionError: assert 0 == 3
E        +  where 0 = <MagicMock name='AuditManager().run_audit' id='133630606666320'>.call_count
E        +    where <MagicMock name='AuditManager().run_audit' id='133630606666320'> = <MagicMock name='AuditManager()' id='133630606919008'>.run_audit

tests/body/cli/test_admin_cli.py:206: AssertionError
_______________________________________________________________ TestAuditCommand.test_audit_fix_flag _______________________________________________________________

self = <test_admin_cli.TestAuditCommand object at 0x79896075d6d0>, runner = <click.testing.CliRunner object at 0x79894cdb6ae0>
mock_audit_manager = <MagicMock name='AuditManager()' id='133630606932976'>

    def test_audit_fix_flag(self, runner, mock_audit_manager):
        """Test audit with auto-fix flag"""
        mock_audit_manager.run_all_audits.return_value = {
            "passed": 8,
            "failed": 4,
            "fixable": 3
        }
        mock_audit_manager.auto_fix.return_value = {"fixed": 3, "failed": 1}

        result = runner.invoke(audit_command, ["--fix"])
        assert result.exit_code == 0
>       assert "fixed" in result.output.lower()
E       AssertionError: assert 'fixed' in ''
E        +  where '' = <built-in method lower of str object at 0xb3c770>()
E        +    where <built-in method lower of str object at 0xb3c770> = ''.lower
E        +      where '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:219: AssertionError
_____________________________________________________________ TestAuditCommand.test_audit_strict_mode ______________________________________________________________

self = <test_admin_cli.TestAuditCommand object at 0x79896075eba0>, runner = <click.testing.CliRunner object at 0x79894cdbeff0>
mock_audit_manager = <MagicMock name='AuditManager()' id='133630606688672'>

    def test_audit_strict_mode(self, runner, mock_audit_manager):
        """Test audit in strict mode (warnings as errors)"""
        mock_audit_manager.run_all_audits.return_value = {
            "passed": 10,
            "failed": 0,
            "warnings": 2
        }

        result = runner.invoke(audit_command, ["--strict"])
>       assert result.exit_code != 0  # Should fail due to warnings
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       assert 0 != 0
E        +  where 0 = <Result okay>.exit_code

tests/body/cli/test_admin_cli.py:230: AssertionError
_____________________________________________________________ TestAuditCommand.test_audit_output_file ______________________________________________________________

self = <test_admin_cli.TestAuditCommand object at 0x79896075ed80>, runner = <click.testing.CliRunner object at 0x79894cd7e780>
mock_audit_manager = <MagicMock name='AuditManager()' id='133630606702496'>

    def test_audit_output_file(self, runner, mock_audit_manager):
        """Test saving audit results to file"""
        mock_audit_manager.run_all_audits.return_value = {
            "passed": 10,
            "failed": 2
        }

        with runner.isolated_filesystem():
            result = runner.invoke(audit_command, ["--output", "audit_report.json"])
            assert result.exit_code == 0

            # Check file was created
>           assert Path("audit_report.json").exists()
E           AssertionError: assert False
E            +  where False = exists()
E            +    where exists = PosixPath('audit_report.json').exists
E            +      where PosixPath('audit_report.json') = Path('audit_report.json')

tests/body/cli/test_admin_cli.py:244: AssertionError
____________________________________________________________ TestAuditCommand.test_audit_list_available ____________________________________________________________

self = <test_admin_cli.TestAuditCommand object at 0x79896075ef60>, runner = <click.testing.CliRunner object at 0x79894cdc1d60>
mock_audit_manager = <MagicMock name='AuditManager()' id='133630606978432'>

    def test_audit_list_available(self, runner, mock_audit_manager):
        """Test listing available audit checks"""
        mock_audit_manager.list_available_checks.return_value = [
            "coverage",
            "imports",
            "docstrings",
            "security",
            "performance"
        ]

        result = runner.invoke(audit_command, ["--list"])
        assert result.exit_code == 0
>       assert "coverage" in result.output
E       AssertionError: assert 'coverage' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:261: AssertionError
_____________________________________________________________ TestRemediateCommand.test_remediate_all ______________________________________________________________

self = <test_admin_cli.TestRemediateCommand object at 0x79896075f260>, runner = <click.testing.CliRunner object at 0x79894cdc0e60>
mock_engine = <MagicMock name='RemediationEngine()' id='133630606972864'>

    def test_remediate_all(self, runner, mock_engine):
        """Test remediating all issues"""
        mock_engine.remediate_all.return_value = {
            "total_issues": 15,
            "fixed": 12,
            "failed": 3,
            "skipped": 0
        }

        result = runner.invoke(remediate_command)
        assert result.exit_code == 0
>       assert "12" in result.output
E       AssertionError: assert '12' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:288: AssertionError
________________________________________________________ TestRemediateCommand.test_remediate_specific_type _________________________________________________________

self = <test_admin_cli.TestRemediateCommand object at 0x79896075f440>, runner = <click.testing.CliRunner object at 0x79894cdbe630>
mock_engine = <MagicMock name='RemediationEngine()' id='133630606952256'>

    def test_remediate_specific_type(self, runner, mock_engine):
        """Test remediating specific issue type"""
        mock_engine.remediate_type.return_value = {
            "type": "missing_docstrings",
            "fixed": 25,
            "failed": 2
        }

        result = runner.invoke(remediate_command, ["--type", "missing_docstrings"])
        assert result.exit_code == 0
>       assert "25" in result.output
E       AssertionError: assert '25' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:301: AssertionError
___________________________________________________________ TestRemediateCommand.test_remediate_coverage ___________________________________________________________

self = <test_admin_cli.TestRemediateCommand object at 0x79896075f620>, runner = <click.testing.CliRunner object at 0x79894cdb6cc0>
mock_engine = <MagicMock name='RemediationEngine()' id='133630606922512'>

    def test_remediate_coverage(self, runner, mock_engine):
        """Test remediating coverage issues"""
        mock_engine.remediate_coverage.return_value = {
            "tests_generated": 15,
            "coverage_before": 38,
            "coverage_after": 55,
            "target": 75
        }

        result = runner.invoke(remediate_command, ["--type", "coverage"])
        assert result.exit_code == 0
>       assert "38" in result.output
E       AssertionError: assert '38' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:314: AssertionError
___________________________________________________________ TestRemediateCommand.test_remediate_dry_run ____________________________________________________________

self = <test_admin_cli.TestRemediateCommand object at 0x79896075f800>, runner = <click.testing.CliRunner object at 0x79894cd76f90>
mock_engine = <MagicMock name='RemediationEngine()' id='133630606668192'>

    def test_remediate_dry_run(self, runner, mock_engine):
        """Test remediation in dry run mode"""
        mock_engine.analyze_issues.return_value = {
            "total": 20,
            "fixable": 18,
            "requires_manual": 2
        }

        result = runner.invoke(remediate_command, ["--dry-run"])
        assert result.exit_code == 0
>       assert "would fix" in result.output.lower()
E       AssertionError: assert 'would fix' in ''
E        +  where '' = <built-in method lower of str object at 0xb3c770>()
E        +    where <built-in method lower of str object at 0xb3c770> = ''.lower
E        +      where '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:327: AssertionError
___________________________________________________________ TestRemediateCommand.test_remediate_with_ai ____________________________________________________________

self = <test_admin_cli.TestRemediateCommand object at 0x79896075fbc0>, runner = <click.testing.CliRunner object at 0x79896075df10>
mock_engine = <MagicMock name='RemediationEngine()' id='133630606732912'>

    def test_remediate_with_ai(self, runner, mock_engine):
        """Test remediation using AI assistance"""
        mock_engine.remediate_with_ai.return_value = {
            "ai_model": "deepseek-coder",
            "suggestions": 10,
            "applied": 8
        }

        result = runner.invoke(remediate_command, ["--use-ai"])
        assert result.exit_code == 0
>       assert "AI" in result.output or "ai" in result.output
E       AssertionError: assert ('AI' in '' or 'ai' in '')
E        +  where '' = <Result okay>.output
E        +  and   '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:355: AssertionError
_______________________________________________________ TestRemediateCommand.test_remediate_target_coverage ________________________________________________________

self = <test_admin_cli.TestRemediateCommand object at 0x79896075fda0>, runner = <click.testing.CliRunner object at 0x79894cd4f980>
mock_engine = <MagicMock name='RemediationEngine()' id='133630606476544'>

    def test_remediate_target_coverage(self, runner, mock_engine):
        """Test remediating to target coverage"""
        mock_engine.remediate_to_target.return_value = {
            "achieved": True,
            "final_coverage": 76,
            "tests_added": 45
        }

        result = runner.invoke(remediate_command, ["--target-coverage", "75"])
        assert result.exit_code == 0
>       assert "76" in result.output
E       AssertionError: assert '76' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:367: AssertionError
__________________________________________________________________ TestSyncCommand.test_sync_all ___________________________________________________________________

self = <test_admin_cli.TestSyncCommand object at 0x798960778140>, runner = <click.testing.CliRunner object at 0x7989571ea780>
mock_sync_service = <MagicMock name='SyncService()' id='133630608658112'>

    def test_sync_all(self, runner, mock_sync_service):
        """Test syncing all components"""
        mock_sync_service.sync_all.return_value = {
            "database": "synced",
            "vectorstore": "synced",
            "knowledge_graph": "synced",
            "duration": 5.2
        }

        result = runner.invoke(sync_command)
        assert result.exit_code == 0
>       assert "synced" in result.output
E       AssertionError: assert 'synced' in ''
E        +  where '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:393: AssertionError
_____________________________________________________________ TestSyncCommand.test_sync_database_only ______________________________________________________________

self = <MagicMock name='SyncService().sync_database' id='133630608249808'>

    def assert_called_once(self):
        """assert that the mock was called only once.
        """
        if not self.call_count == 1:
            msg = ("Expected '%s' to have been called once. Called %s times.%s"
                   % (self._mock_name or 'mock',
                      self.call_count,
                      self._calls_repr()))
>           raise AssertionError(msg)
E           AssertionError: Expected 'sync_database' to have been called once. Called 0 times.

/usr/lib/python3.12/unittest/mock.py:923: AssertionError

During handling of the above exception, another exception occurred:

self = <test_admin_cli.TestSyncCommand object at 0x7989607782f0>, runner = <click.testing.CliRunner object at 0x79894cefbe30>
mock_sync_service = <MagicMock name='SyncService()' id='133630608254080'>

    def test_sync_database_only(self, runner, mock_sync_service):
        """Test syncing database only"""
        mock_sync_service.sync_database.return_value = {
            "tables_updated": 5,
            "records_processed": 150
        }

        result = runner.invoke(sync_command, ["--database"])
        assert result.exit_code == 0
>       mock_sync_service.sync_database.assert_called_once()
E       AssertionError: Expected 'sync_database' to have been called once. Called 0 times.

tests/body/cli/test_admin_cli.py:404: AssertionError
____________________________________________________________ TestSyncCommand.test_sync_vectorstore_only ____________________________________________________________

self = <MagicMock name='SyncService().sync_vectorstore' id='133630607861248'>

    def assert_called_once(self):
        """assert that the mock was called only once.
        """
        if not self.call_count == 1:
            msg = ("Expected '%s' to have been called once. Called %s times.%s"
                   % (self._mock_name or 'mock',
                      self.call_count,
                      self._calls_repr()))
>           raise AssertionError(msg)
E           AssertionError: Expected 'sync_vectorstore' to have been called once. Called 0 times.

/usr/lib/python3.12/unittest/mock.py:923: AssertionError

During handling of the above exception, another exception occurred:

self = <test_admin_cli.TestSyncCommand object at 0x7989607784d0>, runner = <click.testing.CliRunner object at 0x79894ce9a6c0>
mock_sync_service = <MagicMock name='SyncService()' id='133630608661856'>

    def test_sync_vectorstore_only(self, runner, mock_sync_service):
        """Test syncing vectorstore only"""
        mock_sync_service.sync_vectorstore.return_value = {
            "vectors_updated": 500,
            "collections": ["symbols", "knowledge"]
        }

        result = runner.invoke(sync_command, ["--vectorstore"])
        assert result.exit_code == 0
>       mock_sync_service.sync_vectorstore.assert_called_once()
E       AssertionError: Expected 'sync_vectorstore' to have been called once. Called 0 times.

tests/body/cli/test_admin_cli.py:416: AssertionError
____________________________________________________________ TestSyncCommand.test_sync_knowledge_graph _____________________________________________________________

self = <test_admin_cli.TestSyncCommand object at 0x7989607786b0>, runner = <click.testing.CliRunner object at 0x79894cd05ee0>
mock_sync_service = <MagicMock name='SyncService()' id='133630608951056'>

    def test_sync_knowledge_graph(self, runner, mock_sync_service):
        """Test syncing knowledge graph"""
        mock_sync_service.sync_knowledge_graph.return_value = {
            "nodes_added": 20,
            "edges_added": 45,
            "nodes_removed": 3
        }

        result = runner.invoke(sync_command, ["--knowledge-graph"])
        assert result.exit_code == 0
>       assert "nodes" in result.output.lower()
E       AssertionError: assert 'nodes' in ''
E        +  where '' = <built-in method lower of str object at 0xb3c770>()
E        +    where <built-in method lower of str object at 0xb3c770> = ''.lower
E        +      where '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:428: AssertionError
_____________________________________________________________ TestSyncCommand.test_sync_force_rebuild ______________________________________________________________

self = <MagicMock name='SyncService().rebuild_all' id='133630606734400'>

    def assert_called_once(self):
        """assert that the mock was called only once.
        """
        if not self.call_count == 1:
            msg = ("Expected '%s' to have been called once. Called %s times.%s"
                   % (self._mock_name or 'mock',
                      self.call_count,
                      self._calls_repr()))
>           raise AssertionError(msg)
E           AssertionError: Expected 'rebuild_all' to have been called once. Called 0 times.

/usr/lib/python3.12/unittest/mock.py:923: AssertionError

During handling of the above exception, another exception occurred:

self = <test_admin_cli.TestSyncCommand object at 0x798960778890>, runner = <click.testing.CliRunner object at 0x79894cd87320>
mock_sync_service = <MagicMock name='SyncService()' id='133630935816176'>

    def test_sync_force_rebuild(self, runner, mock_sync_service):
        """Test force rebuild during sync"""
        mock_sync_service.rebuild_all.return_value = {
            "status": "rebuilt",
            "time": 12.5
        }

        result = runner.invoke(sync_command, ["--force-rebuild"])
        assert result.exit_code == 0
>       mock_sync_service.rebuild_all.assert_called_once()
E       AssertionError: Expected 'rebuild_all' to have been called once. Called 0 times.

tests/body/cli/test_admin_cli.py:439: AssertionError
_________________________________________________________________ TestSyncCommand.test_sync_verify _________________________________________________________________

self = <MagicMock name='SyncService().verify_sync' id='133630606250768'>

    def assert_called_once(self):
        """assert that the mock was called only once.
        """
        if not self.call_count == 1:
            msg = ("Expected '%s' to have been called once. Called %s times.%s"
                   % (self._mock_name or 'mock',
                      self.call_count,
                      self._calls_repr()))
>           raise AssertionError(msg)
E           AssertionError: Expected 'verify_sync' to have been called once. Called 0 times.

/usr/lib/python3.12/unittest/mock.py:923: AssertionError

During handling of the above exception, another exception occurred:

self = <test_admin_cli.TestSyncCommand object at 0x798960778a70>, runner = <click.testing.CliRunner object at 0x79894cd49250>
mock_sync_service = <MagicMock name='SyncService()' id='133630606661280'>

    def test_sync_verify(self, runner, mock_sync_service):
        """Test verify after sync"""
        mock_sync_service.sync_all.return_value = {"status": "synced"}
        mock_sync_service.verify_sync.return_value = {
            "database": "verified",
            "vectorstore": "verified",
            "inconsistencies": []
        }

        result = runner.invoke(sync_command, ["--verify"])
        assert result.exit_code == 0
>       mock_sync_service.verify_sync.assert_called_once()
E       AssertionError: Expected 'verify_sync' to have been called once. Called 0 times.

tests/body/cli/test_admin_cli.py:452: AssertionError
______________________________________________________________ TestInitCommand.test_init_new_project _______________________________________________________________

self = <test_admin_cli.TestInitCommand object at 0x79896075fad0>, runner = <click.testing.CliRunner object at 0x79894cdb6540>

    def test_init_new_project(self, runner):
        """Test initializing a new CORE project"""
        with runner.isolated_filesystem():
            result = runner.invoke(init_command, input="TestProject\ny\n")
            assert result.exit_code == 0

            # Check project structure was created
>           assert Path(".intent").exists()
E           AssertionError: assert False
E            +  where False = exists()
E            +    where exists = PosixPath('.intent').exists
E            +      where PosixPath('.intent') = Path('.intent')

tests/body/cli/test_admin_cli.py:469: AssertionError
___________________________________________________________ TestInitCommand.test_init_existing_directory ___________________________________________________________

self = <test_admin_cli.TestInitCommand object at 0x79896075f140>, runner = <click.testing.CliRunner object at 0x79894cdbe330>

    def test_init_existing_directory(self, runner):
        """Test initializing in existing directory"""
        with runner.isolated_filesystem():
            Path("existing_file.py").write_text("# existing")

            result = runner.invoke(init_command, ["--force"])
            assert result.exit_code == 0
>           assert Path(".intent").exists()
E           AssertionError: assert False
E            +  where False = exists()
E            +    where exists = PosixPath('.intent').exists
E            +      where PosixPath('.intent') = Path('.intent')

tests/body/cli/test_admin_cli.py:480: AssertionError
_____________________________________________________________ TestInitCommand.test_init_with_template ______________________________________________________________

self = <test_admin_cli.TestInitCommand object at 0x79896075eb10>, runner = <click.testing.CliRunner object at 0x79894cd7f1a0>

    def test_init_with_template(self, runner):
        """Test initializing with a template"""
        result = runner.invoke(init_command, ["--template", "microservice"])
        assert result.exit_code == 0
>       assert "microservice" in result.output.lower()
E       AssertionError: assert 'microservice' in ''
E        +  where '' = <built-in method lower of str object at 0xb3c770>()
E        +    where <built-in method lower of str object at 0xb3c770> = ''.lower
E        +      where '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:486: AssertionError
________________________________________________________________ TestInitCommand.test_init_minimal _________________________________________________________________

self = <test_admin_cli.TestInitCommand object at 0x798960778c20>, runner = <click.testing.CliRunner object at 0x79894cd7f3b0>

    def test_init_minimal(self, runner):
        """Test minimal initialization"""
        with runner.isolated_filesystem():
            result = runner.invoke(init_command, ["--minimal"])
            assert result.exit_code == 0

            # Should create minimal structure
>           assert Path(".intent").exists()
E           AssertionError: assert False
E            +  where False = exists()
E            +    where exists = PosixPath('.intent').exists
E            +      where PosixPath('.intent') = Path('.intent')

tests/body/cli/test_admin_cli.py:495: AssertionError
________________________________________________________________ TestConfigCommand.test_config_list ________________________________________________________________

self = <test_admin_cli.TestConfigCommand object at 0x798960778050>, runner = <click.testing.CliRunner object at 0x79894cdc0e00>

    def test_config_list(self, runner):
        """Test listing configuration values"""
        with patch('src.body.cli.admin_cli.get_config') as mock_config:
            mock_config.return_value = {
                "autonomy_level": "A1",
                "target_coverage": 75,
                "ai_model": "deepseek-coder"
            }

            result = runner.invoke(config_command, ["list"])
            assert result.exit_code == 0
>           assert "autonomy_level" in result.output
E           AssertionError: assert 'autonomy_level' in ''
E            +  where '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:517: AssertionError
________________________________________________________________ TestConfigCommand.test_config_get _________________________________________________________________

self = <test_admin_cli.TestConfigCommand object at 0x798960778e30>, runner = <click.testing.CliRunner object at 0x79894cd7fb00>

    def test_config_get(self, runner):
        """Test getting specific config value"""
        with patch('src.body.cli.admin_cli.get_config_value') as mock:
            mock.return_value = "deepseek-coder"

            result = runner.invoke(config_command, ["get", "ai_model"])
            assert result.exit_code == 0
>           assert "deepseek-coder" in result.output
E           AssertionError: assert 'deepseek-coder' in ''
E            +  where '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:527: AssertionError
________________________________________________________________ TestConfigCommand.test_config_set _________________________________________________________________

self = <test_admin_cli.TestConfigCommand object at 0x798960779010>, runner = <click.testing.CliRunner object at 0x79894cd76720>

    def test_config_set(self, runner):
        """Test setting config value"""
        with patch('src.body.cli.admin_cli.set_config_value') as mock:
            mock.return_value = True

            result = runner.invoke(config_command, ["set", "target_coverage", "80"])
            assert result.exit_code == 0
>           assert "set" in result.output.lower()
E           AssertionError: assert 'set' in ''
E            +  where '' = <built-in method lower of str object at 0xb3c770>()
E            +    where <built-in method lower of str object at 0xb3c770> = ''.lower
E            +      where '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:536: AssertionError
______________________________________________________________ TestConfigCommand.test_config_validate ______________________________________________________________

self = <test_admin_cli.TestConfigCommand object at 0x7989607791f0>, runner = <click.testing.CliRunner object at 0x79894cdb48f0>

    def test_config_validate(self, runner):
        """Test validating configuration"""
        with patch('src.body.cli.admin_cli.validate_config') as mock:
            mock.return_value = {
                "valid": True,
                "warnings": ["AI model not optimal for code generation"]
            }

            result = runner.invoke(config_command, ["validate"])
            assert result.exit_code == 0
>           assert "valid" in result.output.lower()
E           AssertionError: assert 'valid' in ''
E            +  where '' = <built-in method lower of str object at 0xb3c770>()
E            +    where <built-in method lower of str object at 0xb3c770> = ''.lower
E            +      where '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:548: AssertionError
___________________________________________________________ TestErrorHandling.test_handle_database_error ___________________________________________________________

self = <test_admin_cli.TestErrorHandling object at 0x798960779520>, runner = <click.testing.CliRunner object at 0x79894cd49c70>

    def test_handle_database_error(self, runner):
        """Test handling database connection errors"""
        with patch('src.body.cli.admin_cli.AdminService') as mock:
            mock.return_value.get_status.side_effect = Exception("Database connection failed")

            result = runner.invoke(status_command)
>           assert result.exit_code != 0
E           assert 0 != 0
E            +  where 0 = <Result okay>.exit_code

tests/body/cli/test_admin_cli.py:565: AssertionError
__________________________________________________________ TestErrorHandling.test_handle_permission_error __________________________________________________________

self = <test_admin_cli.TestErrorHandling object at 0x798960779700>, runner = <click.testing.CliRunner object at 0x79894cd87f20>

    def test_handle_permission_error(self, runner):
        """Test handling permission errors"""
        with patch('src.body.cli.admin_cli.Path.mkdir') as mock:
            mock.side_effect = PermissionError("Permission denied")

            result = runner.invoke(init_command)
>           assert result.exit_code != 0
E           assert 0 != 0
E            +  where 0 = <Result okay>.exit_code

tests/body/cli/test_admin_cli.py:574: AssertionError
_________________________________________________________ TestErrorHandling.test_handle_keyboard_interrupt _________________________________________________________

self = <test_admin_cli.TestErrorHandling object at 0x7989607798e0>, runner = <click.testing.CliRunner object at 0x79894cf5eba0>

    def test_handle_keyboard_interrupt(self, runner):
        """Test handling keyboard interrupt"""
        with patch('src.body.cli.admin_cli.AdminService') as mock:
            mock.return_value.get_status.side_effect = KeyboardInterrupt()

            result = runner.invoke(status_command)
>           assert "Interrupted" in result.output or "Cancelled" in result.output
E           AssertionError: assert ('Interrupted' in '' or 'Cancelled' in '')
E            +  where '' = <Result okay>.output
E            +  and   '' = <Result okay>.output

tests/body/cli/test_admin_cli.py:583: AssertionError
========================================================================= warnings summary =========================================================================
tests/will/orchestration/test_cognitive_service_unit.py::test_create_provider_openai
tests/will/orchestration/test_cognitive_service_unit.py::test_create_provider_ollama
tests/will/orchestration/test_cognitive_service_unit.py::test_create_provider_secret_keyerror
  /usr/lib/python3.12/asyncio/events.py:88: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    self._context.run(self._callback, *self._args)
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
========================================================================== tests coverage ==========================================================================
_________________________________________________________ coverage: platform linux, python 3.12.3-final-0 __________________________________________________________

Name                                                           Stmts   Miss  Cover   Missing
--------------------------------------------------------------------------------------------
src/api/__init__.py                                                1      0   100%
src/api/main.py                                                   43      6    86%   49-55, 75
src/api/v1/__init__.py                                             1      0   100%
src/api/v1/development_routes.py                                  20      7    65%   37-50
src/api/v1/knowledge_routes.py                                     9      1    89%   25
src/body/__init__.py                                               1      0   100%
src/body/actions/base.py                                           4      0   100%
src/body/actions/code_actions.py                                  97      0   100%
src/body/actions/context.py                                        9      0   100%
src/body/actions/file_actions.py                                  53     32    40%   29-44, 59-71, 86-102
src/body/actions/governance_actions.py                            29     16    45%   33-64
src/body/actions/healing_actions.py                               28      4    86%   48-52, 70
src/body/actions/healing_actions_extended.py                      74     15    80%   48-50, 81-83, 110-112, 132-134, 166-168
src/body/actions/registry.py                                      24      1    96%   63
src/body/actions/validation_actions.py                            13      0   100%
src/body/cli/__init__.py                                           1      0   100%
src/body/cli/admin_cli.py                                         43     39     9%   27-108
src/body/cli/commands/__init__.py                                  1      0   100%
src/body/cli/commands/check.py                                    13      0   100%
src/body/cli/commands/coverage.py                                211    178    16%   45-47, 59-80, 99-146, 220-303, 319-376, 389-404, 432-462, 484-519
src/body/cli/commands/enrich.py                                   13      2    85%   31-33
src/body/cli/commands/fix.py                                      96     88     8%   19-282
src/body/cli/commands/inspect.py                                  48     39    19%   19-121
src/body/cli/commands/manage.py                                   72     63    12%   24-160
src/body/cli/commands/mind.py                                     18      5    72%   33, 46, 59, 68-69
src/body/cli/commands/run.py                                      17      5    71%   44-45, 57-60
src/body/cli/commands/search.py                                   40     26    35%   31-59, 69-71
src/body/cli/commands/secrets.py                                 142    137     4%   19-398
src/body/cli/commands/submit.py                                   11      2    82%   35-36
src/body/cli/interactive.py                                       58     45    22%   22-51, 57, 88, 141, 165, 201-226
src/body/cli/logic/__init__.py                                     1      0   100%
src/body/cli/logic/agent.py                                       63     49    22%   24-29, 40-114, 128-143
src/body/cli/logic/audit.py                                       90     71    21%   29-56, 61-103, 108-158, 164-167, 175, 196
src/body/cli/logic/audit_capability_domains.py                    23     17    26%   19-80, 96-106
src/body/cli/logic/build.py                                        5      0   100%
src/body/cli/logic/byor.py                                        44     34    23%   42-131
src/body/cli/logic/capability.py                                   9      2    78%   22-25
src/body/cli/logic/check.py                                        7      4    43%   11-17
src/body/cli/logic/cli_utils.py                                   62     52    16%   20-124
src/body/cli/logic/context.py                                      1      0   100%
src/body/cli/logic/db.py                                          43     23    47%   30-44, 51-68, 79-88
src/body/cli/logic/db_manage.py                                   10      7    30%   9-21
src/body/cli/logic/diagnostics.py                                170    130    24%   36-66, 81-82, 86-104, 113-121, 133-162, 173-178, 186-202, 212-229, 237-284, 291-316
src/body/cli/logic/duplicates.py                                  62     48    23%   26-57, 62-107, 113
src/body/cli/logic/embeddings_cli.py                              26     22    15%   14-74
src/body/cli/logic/guard.py                                       47     32    32%   23-28, 33-37, 42-44, 63, 72-105, 110
src/body/cli/logic/guard_cli.py                                   32     23    28%   19-67
src/body/cli/logic/hub.py                                        130    102    22%   31-32, 36, 40-42, 46-51, 56-60, 68-92, 105-138, 151-176, 184-216
src/body/cli/logic/init.py                                        13     10    23%   9-21
src/body/cli/logic/knowledge.py                                   21     14    33%   29-61
src/body/cli/logic/knowledge_sync/__init__.py                      6      0   100%
src/body/cli/logic/knowledge_sync/diff.py                         45     33    27%   37-58, 68-120
src/body/cli/logic/knowledge_sync/import_.py                      73     53    27%   48-60, 70-71, 76-86, 96-100, 115-116, 126-127, 137-138, 150-189
src/body/cli/logic/knowledge_sync/snapshot.py                     50     33    34%   32-39, 49-56, 66-78, 88-95, 106-166
src/body/cli/logic/knowledge_sync/utils.py                        35     21    40%   22-28, 34-38, 45-61, 71, 77-79
src/body/cli/logic/knowledge_sync/verify.py                       34     27    21%   25-79
src/body/cli/logic/list_audits.py                                 19     13    32%   24-46
src/body/cli/logic/log_audit.py                                   16     10    38%   19-53
src/body/cli/logic/new.py                                          1      0   100%
src/body/cli/logic/project_docs.py                                12      7    42%   20-28
src/body/cli/logic/proposal_service.py                           159    141    11%   30-272
src/body/cli/logic/reconcile.py                                   43     31    28%   30-86, 94
src/body/cli/logic/report.py                                      19     13    32%   20-49
src/body/cli/logic/status.py                                      17     11    35%   25-39
src/body/cli/logic/symbol_drift.py                                49     38    22%   26-92, 100
src/body/cli/logic/sync.py                                        21     13    38%   21-39, 51
src/body/cli/logic/sync_domains.py                                33     22    33%   25-70, 78
src/body/cli/logic/sync_manifest.py                               39     25    36%   31-74, 80
src/body/cli/logic/system.py                                      16      5    69%   28-35, 41
src/body/cli/logic/tools.py                                       21     13    38%   33-52
src/body/cli/logic/utils_migration.py                             25     15    40%   23-30, 38-46
src/body/cli/logic/validate.py                                    96     67    30%   27-28, 33-46, 57-85, 121-128, 132, 161-204
src/body/cli/logic/vector_drift.py                                56     44    21%   24-28, 35-52, 57-114
src/body/invokers/__init__.py                                      1      0   100%
src/body/invokers/capability_invoker.py                            1      0   100%
src/body/models/__init__.py                                        1      0   100%
src/body/repositories/__init__.py                                  1      0   100%
src/body/services/__init__.py                                      1      0   100%
src/body/services/capabilities.py                                 19      0   100%
src/body/services/crate_processing_service.py                    171     12    93%   78, 82, 148-149, 158, 227-229, 243, 305-310
src/body/services/llm_client.py                                   32     24    25%   28-32, 44-86
src/body/services/service_registry.py                             50      1    98%   70
src/body/services/validation_policies.py                          56     46    18%   24, 28-35, 41-109, 114-118
src/features/__init__.py                                           1      0   100%
src/features/autonomy/autonomous_developer.py                     44     32    27%   34-95
src/features/introspection/__init__.py                             1      0   100%
src/features/introspection/audit_unassigned_capabilities.py       28      0   100%
src/features/introspection/capability_discovery_service.py       111     21    81%   48, 51-53, 90-93, 133, 138-139, 165, 187-200
src/features/introspection/discovery/from_manifest.py             20     13    35%   26-47
src/features/introspection/drift_detector.py                      20      3    85%   34, 52-53
src/features/introspection/drift_service.py                       16      0   100%
src/features/introspection/export_vectors.py                      38      1    97%   49
src/features/introspection/generate_capability_docs.py            50     37    26%   32-43, 48-56, 63-103
src/features/introspection/generate_correction_map.py             21      0   100%
src/features/introspection/graph_analysis_service.py              43     33    23%   17-18, 31-73
src/features/introspection/knowledge_graph_service.py             70     51    27%   39-44, 48-58, 62-69, 76-95, 99-110, 114-118, 122-155
src/features/introspection/knowledge_helpers.py                   34     26    24%   25-60, 66-68
src/features/introspection/knowledge_vectorizer.py                75     68     9%   16-174
src/features/introspection/semantic_clusterer.py                  41     29    29%   19-20, 39-78
src/features/introspection/symbol_index_builder.py               179    137    23%   45-82, 86-91, 96-99, 103-120, 124-125, 129-130, 133-152, 155-157, 161-170, 174-231, 237-254, 263-286, 291-315
src/features/introspection/sync_service.py                        73     54    26%   28-30, 35-40, 46-47, 54-55, 62-80, 102-115, 124-210
src/features/introspection/vectorization_service.py              117     95    19%   33-43, 48-69, 74-91, 101-129, 134-158, 168-245
src/features/maintenance/command_sync_service.py                  38     27    29%   24-51, 60-91
src/features/maintenance/maintenance_service.py                   44     37    16%   48-101
src/features/project_lifecycle/__init__.py                         1      0   100%
src/features/project_lifecycle/bootstrap_service.py               38     24    37%   58-69, 80-115
src/features/project_lifecycle/definition_service.py              85     66    22%   30-41, 52-113, 119-134, 142-183
src/features/project_lifecycle/integration_service.py             45     35    22%   29-102
src/features/project_lifecycle/scaffolding_service.py             76     61    20%   34-43, 51-106, 111-114, 135-161
src/features/self_healing/__init__.py                              1      0   100%
src/features/self_healing/accumulative_test_service.py            70     53    24%   39, 61-108, 120-138, 148-198
src/features/self_healing/batch_remediation_service.py           148    125    16%   50-58, 72-120, 124-139, 145-159, 163-234, 238-241, 245-254, 258-302, 324-328
src/features/self_healing/capability_tagging_service.py           45     40    11%   15-88
src/features/self_healing/clarity_service.py                      27     16    41%   24-57, 65
src/features/self_healing/code_style_service.py                    6      3    50%   17-22
src/features/self_healing/complexity_filter.py                    93     67    28%   38, 43-66, 79-107, 117-188, 210
src/features/self_healing/complexity_service.py                   93     67    28%   38, 43-66, 79-107, 117-188, 208
src/features/self_healing/coverage_analyzer.py                    70     56    20%   30, 40-65, 75-121, 131-172, 184-199
src/features/self_healing/coverage_remediation_service.py         26     15    42%   48-77, 93
src/features/self_healing/coverage_watcher.py                    102     74    27%   45-50, 59-120, 123-139, 148-162, 165-172, 175-209, 220-221
src/features/self_healing/docstring_service.py                    55     44    20%   24-105, 111
src/features/self_healing/duplicate_id_service.py                 63     52    17%   23-27, 38-130
src/features/self_healing/enrichment_service.py                   73     52    29%   29-40, 49-90, 95-108, 116-152
src/features/self_healing/fix_manifest_hygiene.py                 55     42    24%   34-120
src/features/self_healing/full_project_remediation.py            139    108    22%   60-82, 92-117, 123-147, 157-207, 213-265, 276-289, 300-319, 323-328
src/features/self_healing/header_service.py                       44     34    23%   24-76
src/features/self_healing/id_tagging_service.py                   51     41    20%   20-21, 30-91
src/features/self_healing/iterative_test_fixer.py                142    114    20%   51-59, 63-75, 79, 136-184, 194-214, 224-262, 267-291, 300-305, 317-341, 352-369, 373-388, 392-424, 433-438
src/features/self_healing/knowledge_consolidation_service.py      26     20    23%   39-69
src/features/self_healing/linelength_service.py                   64     49    23%   30-100, 122-132
src/features/self_healing/policy_id_service.py                    30     23    23%   30-75
src/features/self_healing/prune_orphaned_vectors.py               51     37    27%   27-96, 108
src/features/self_healing/prune_private_capabilities.py           51     45    12%   17-106
src/features/self_healing/purge_legacy_tags_service.py            44     36    18%   28-92
src/features/self_healing/simple_test_generator.py                89     71    20%   41, 62-103, 112-136, 142-175, 179-199, 207-260
src/features/self_healing/single_file_remediation.py              79     61    23%   47-51, 66-176, 186-188, 197-220
src/features/self_healing/test_context_analyzer.py               224    180    20%   60-115, 123, 136-180, 202-225, 229-241, 245-253, 257-265, 269-289, 293-303, 307-317, 321-329, 333-381, 391-412, 418-459, 463-484, 488-492
src/features/self_healing/test_failure_analyzer.py               142    106    25%   41-60, 78-80, 93, 107-115, 126-142, 146-157, 161-165, 176-221, 228-246, 251-257, 262-279, 288-304
src/features/self_healing/test_generator.py                      127    105    17%   51-67, 71-74, 96-136, 153-248, 266-301, 305-326, 330-365
src/features/self_healing/test_target_analyzer.py                 62     43    31%   34-36, 43-72, 76-83, 89-93, 102-113
src/main.py                                                        6      1    83%   14
src/mind/__init__.py                                               1      0   100%
src/mind/governance/__init__.py                                    1      0   100%
src/mind/governance/audit_context.py                              54      9    83%   72-73, 93-104
src/mind/governance/audit_postprocessor.py                        92     73    21%   76, 81, 114, 118, 124, 146-184, 194-236, 243, 247, 263-326
src/mind/governance/auditor.py                                    58     33    43%   42-43, 47-57, 61-96, 103-135
src/mind/governance/checks/__init__.py                             1      0   100%
src/mind/governance/checks/base_check.py                           8      4    50%   23-26
src/mind/governance/checks/capability_coverage.py                 19     13    32%   21, 28-67
src/mind/governance/checks/coverage_check.py                     103     86    17%   33-39, 49-108, 117-158, 170-185, 197-200, 213-232, 245-279, 283-296
src/mind/governance/checks/dependency_injection_check.py          59     48    19%   23-26, 31-42, 46-73, 77-104, 110-117
src/mind/governance/checks/domain_placement.py                    26     19    27%   22-23, 30-58
src/mind/governance/checks/duplication_check.py                   57     43    25%   33-47, 57-101, 108-130
src/mind/governance/checks/environment_checks.py                  16      9    44%   19-20, 28-45
src/mind/governance/checks/file_checks.py                         41     29    29%   32-37, 41-53, 57-69, 75-96
src/mind/governance/checks/health_checks.py                       61     47    23%   23-26, 32-53, 59-80, 83, 95-117, 122-141
src/mind/governance/checks/id_coverage_check.py                   24     17    29%   27-64
src/mind/governance/checks/id_uniqueness_check.py                 27     19    30%   33-65
src/mind/governance/checks/import_rules.py                        82     66    20%   24-48, 59-61, 65-82, 86-89, 96-101, 110-113, 119-152
src/mind/governance/checks/knowledge_source_check.py             140     98    30%   96-101, 108-138, 153-162, 171-181, 192-205, 211-222, 227-231, 235-243, 250-257, 268-278, 288, 301-313, 322-339, 344, 349, 359, 366-369, 375-385, 394, 414-417
src/mind/governance/checks/legacy_tag_check.py                    30     24    20%   16-71
src/mind/governance/checks/manifest_lint.py                       18     12    33%   17-20, 25-47
src/mind/governance/checks/naming_conventions.py                  38     31    18%   23-25, 33-84
src/mind/governance/checks/orphaned_logic.py                      74     63    15%   26-62, 68-102, 107-117, 124-141
src/mind/governance/checks/security_checks.py                     93     79    15%   24-30, 35-39, 43-54, 58-98, 102-141, 145-190
src/mind/governance/checks/style_checks.py                        25     18    28%   20-23, 28-64
src/mind/governance/constitutional_monitor.py                    111     74    33%   29, 57, 92-95, 105-160, 178-215, 232-261
src/mind/governance/key_management_service.py                     27      0   100%
src/mind/governance/micro_proposal_validator.py                   36      7    81%   21, 60-62, 65, 75, 81, 88
src/mind/governance/policy_coverage_service.py                    77     46    40%   52-58, 63-65, 75-91, 96-109, 116-164
src/mind/governance/policy_gate.py                                44     22    50%   47, 56-59, 63-69, 87-111
src/mind/governance/policy_loader.py                              44      0   100%
src/mind/governance/policy_resolver.py                            23     17    26%   9, 16-34
src/mind/governance/runtime_validator.py                          34     22    35%   27-28, 48-89
src/services/__init__.py                                           1      0   100%
src/services/adapters/__init__.py                                  1      0   100%
src/services/adapters/embedding_provider.py                      132    104    21%   42-55, 59-64, 68-75, 79, 88-100, 104-107, 111-116, 120-129, 139-150, 154-157, 161-164, 170-181, 185-186, 198-223, 235, 245-255, 259-263, 269-280
src/services/clients/__init__.py                                   1      0   100%
src/services/clients/llm_api_client.py                           113     94    17%   30-52, 56-60, 64-77, 81-87, 91-102, 110-126, 132-151, 155, 163-186
src/services/clients/qdrant_client.py                             98     69    30%   22-23, 31-35, 43, 72, 89-110, 123-151, 156-166, 173-247, 261-268
src/services/config_service.py                                   107     66    38%   54-56, 66-77, 94-101, 113-116, 125-128, 133-136, 141-144, 158-177, 183-192, 204-250, 275, 280-281, 286-287, 292-293, 308-313, 318-323, 332
src/services/database/models.py                                  178      0   100%
src/services/database/session_manager.py                          16      2    88%   53-54
src/services/git_service.py                                       51     18    65%   48-51, 56, 61, 71, 73-74, 84, 101-102, 106-111
src/services/knowledge/knowledge_service.py                       39     12    69%   44-55, 77, 84-86
src/services/llm/client.py                                        82     24    71%   184-240
src/services/llm/client_registry.py                               33     20    39%   42-43, 66-93, 110, 123-124, 135
src/services/llm/providers/base.py                                10      0   100%
src/services/llm/providers/ollama.py                              22     14    36%   24-34, 39-45
src/services/llm/providers/openai.py                              25     14    44%   26-36, 41-47
src/services/mind_service.py                                      10      3    70%   26-28, 34
src/services/repositories/__init__.py                              1      0   100%
src/services/repositories/db/__init__.py                           1      0   100%
src/services/repositories/db/common.py                            57     35    39%   28, 38-54, 62-65, 80-82, 88-93, 99-101, 111-122
src/services/repositories/db/engine.py                             8      4    50%   22-25
src/services/repositories/db/migration_service.py                 38     29    24%   27-59, 69
src/services/repositories/db/status_service.py                    23     12    48%   35-55
src/services/secrets_service.py                                   83     59    29%   49-52, 63, 68-70, 75-80, 101-125, 149-166, 180-193, 203-213, 241-248, 267-296, 316-339, 357-364
src/services/storage/file_classifier.py                           11      8    27%   24-31
src/services/storage/file_handler.py                              53      0   100%
src/services/validation/black_formatter.py                        12      9    25%   16-40
src/services/validation/python_validator.py                       43     30    30%   32-100
src/services/validation/quality.py                                12      7    42%   31-44
src/services/validation/ruff_linter.py                            36     26    28%   40-101
src/services/validation/syntax_checker.py                         14      9    36%   18-36
src/services/validation/yaml_validator.py                         11      6    45%   31-43
src/shared/__init__.py                                             1      0   100%
src/shared/action_logger.py                                       28      7    75%   27, 30-34, 46, 56-57
src/shared/ast_utility.py                                        116     89    23%   33-51, 72-94, 108, 114-127, 133-135, 144, 149-153, 164-173, 183-198, 209-221, 234-258
src/shared/cli_utils.py                                           24     13    46%   18-23, 29-34, 40, 46, 52, 58
src/shared/config.py                                             103     33    68%   85-86, 89-90, 96-98, 111, 119-132, 139-142, 147-148, 153-158
src/shared/config_loader.py                                       25     12    52%   36-37, 43-53
src/shared/constants.py                                            2      0   100%
src/shared/context.py                                             13      0   100%
src/shared/errors.py                                              17      4    76%   29-33, 46-49
src/shared/exceptions.py                                          11      4    64%   12-13, 28-29
src/shared/legacy_models.py                                       24      0   100%
src/shared/logger.py                                              19      2    89%   59-60
src/shared/models/__init__.py                                      7      0   100%
src/shared/models/audit_models.py                                 23      2    91%   23, 29
src/shared/models/capability_models.py                             7      0   100%
src/shared/models/drift_models.py                                 10      1    90%   24
src/shared/models/embedding_payload.py                            14      0   100%
src/shared/models/execution_models.py                             20      0   100%
src/shared/path_utils.py                                           9      1    89%   31
src/shared/time.py                                                 4      0   100%
src/shared/utils/__init__.py                                       1      0   100%
src/shared/utils/alias_resolver.py                                23     13    43%   33-58, 69
src/shared/utils/common_knowledge.py                               9      0   100%
src/shared/utils/constitutional_parser.py                         18     14    22%   25-51
src/shared/utils/crypto.py                                        12      0   100%
src/shared/utils/embedding_utils.py                               82     58    29%   39, 43, 48-57, 66, 92-139, 144-162, 171, 185-206
src/shared/utils/header_tools.py                                  91      3    97%   100, 142, 149
src/shared/utils/import_scanner.py                                20     14    30%   27-43
src/shared/utils/manifest_aggregator.py                           40     33    18%   34-83
src/shared/utils/parallel_processor.py                            29     14    52%   34-36, 45-60, 71, 81
src/shared/utils/parsing.py                                       39      0   100%
src/shared/utils/subprocess_utils.py                              28     19    32%   23-44
src/shared/utils/yaml_processor.py                                51     32    37%   69-92, 111-120, 136-145
src/will/__init__.py                                               1      0   100%
src/will/agents/__init__.py                                        1      0   100%
src/will/agents/base_planner.py                                   49      3    94%   63, 76-77
src/will/agents/coder_agent.py                                    47     32    32%   35-40, 53-85, 91-107, 115-122
src/will/agents/cognitive_orchestrator.py                         38     24    37%   31-35, 40-51, 58-79
src/will/agents/deduction_agent.py                                47      8    83%   46-49, 51-56, 93-94
src/will/agents/execution_agent.py                                37      9    76%   44, 54, 63-72, 82-86
src/will/agents/intent_translator.py                              21      1    95%   28
src/will/agents/micro_planner.py                                  25      3    88%   51-55
src/will/agents/plan_executor.py                                  33      0   100%
src/will/agents/planner_agent.py                                  26      1    96%   57
src/will/agents/reconnaissance_agent.py                           60     50    17%   25-27, 33-58, 65-109, 113-115
src/will/agents/resource_selector.py                              33      4    88%   36-37, 52-53
src/will/agents/self_correction_engine.py                         31      0   100%
src/will/agents/tagger_agent.py                                   63     56    11%   17-140
src/will/cli_logic/proposals_micro.py                             78     16    79%   43-46, 82-91, 108-110, 124, 151-162
src/will/cli_logic/run.py                                         48     31    35%   34-80, 90-99
src/will/orchestration/__init__.py                                 1      0   100%
src/will/orchestration/cognitive_service.py                      111      7    94%   113-120, 144, 157, 206
src/will/orchestration/intent_alignment.py                        42     31    26%   30-36, 41-52, 57, 68-89
src/will/orchestration/intent_guard.py                            85     53    38%   35, 64-72, 76-92, 101-105, 109-114, 120-126, 130, 139-146, 152-163, 167
src/will/orchestration/prompt_pipeline.py                         73     43    41%   55-73, 85-103, 114-116, 127-153
src/will/orchestration/self_correction_engine.py                  28     17    39%   34-79
src/will/orchestration/validation_pipeline.py                     22     14    36%   30-49
--------------------------------------------------------------------------------------------
TOTAL                                                          11660   7172    38%
Coverage HTML written to dir htmlcov
===================================================================== short test summary info ======================================================================
FAILED tests/body/cli/commands/test_fix.py::TestSecretManager::test_encrypt_value - AssertionError: assert False
FAILED tests/body/cli/commands/test_fix.py::TestSecretManager::test_decrypt_value - AssertionError: assert <MagicMock name='mock.SecretManager().decrypt_value()' id='133630876755504'> == 'my-secret-password'
FAILED tests/body/cli/commands/test_fix.py::TestSecretManager::test_validate_secret_name_valid - AssertionError: assert <MagicMock name='mock.SecretManager().validate_secret_name()' id='133630779180432'> is True
FAILED tests/body/cli/commands/test_fix.py::TestSecretManager::test_validate_secret_name_invalid - AssertionError: assert <MagicMock name='mock.SecretManager().validate_secret_name()' id='133630779180432'> is False
FAILED tests/body/cli/commands/test_fix.py::TestSecretManager::test_set_secret - AssertionError: assert <MagicMock name='mock.SecretManager().set_secret()' id='133630779088800'> is True
FAILED tests/body/cli/commands/test_fix.py::TestSecretManager::test_get_secret - AssertionError: expected call not found.
FAILED tests/body/cli/commands/test_fix.py::TestSecretManager::test_delete_secret - AssertionError: assert <MagicMock name='mock.SecretManager().delete_secret()' id='133630779030992'> is True
FAILED tests/body/cli/commands/test_fix.py::TestSecretManager::test_list_secrets - AssertionError: assert 0 == 3
FAILED tests/body/cli/commands/test_fix.py::TestSecretManager::test_rotate_secret - AssertionError: assert <MagicMock name='mock.SecretManager().rotate_secret()' id='133630778878304'> is True
FAILED tests/body/cli/commands/test_fix.py::TestSecretManager::test_export_secrets - AssertionError: assert False
FAILED tests/body/cli/commands/test_fix.py::TestSecretManager::test_import_secrets - AssertionError: assert <MagicMock name='mock.SecretManager().import_secrets()' id='133630860636672'> is True
FAILED tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_list_secrets_command - AssertionError: assert 'API_KEY' in ''
FAILED tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_list_secrets_empty - AssertionError: assert 'No secrets found' in ''
FAILED tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_get_secret_command - AssertionError: assert 'my-secret-value' in ''
FAILED tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_get_secret_not_found - assert 0 == 1
FAILED tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_set_secret_command - assert "Secret 'API_KEY' has been set" in ''
FAILED tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_set_secret_invalid_name - assert 0 == 1
FAILED tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_delete_secret_command - assert "Secret 'API_KEY' has been deleted" in ''
FAILED tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_delete_secret_cancelled - AssertionError: assert 'Cancelled' in ''
FAILED tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_rotate_secrets_command - AssertionError: assert 'Rotating 2 secrets' in ''
FAILED tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_export_secrets_command - AssertionError: assert 'Secrets exported to secrets.json' in ''
FAILED tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_export_secrets_encrypted - AssertionError: expected call not found.
FAILED tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_import_secrets_command - AssertionError: assert 'Secrets imported successfully' in ''
FAILED tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_import_secrets_overwrite - AssertionError: expected call not found.
FAILED tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_verify_encryption_command - AssertionError: assert 'Encryption is properly configured' in ''
FAILED tests/body/cli/commands/test_fix.py::TestSecretsCLI::test_verify_encryption_failed - assert 0 == 1
FAILED tests/body/cli/commands/test_fix.py::TestSecretStorage::test_save_secret - AssertionError: assert <MagicMock name='mock.SecretStorage().save()' id='133630778881856'> is True
FAILED tests/body/cli/commands/test_fix.py::TestSecretStorage::test_get_secret - AssertionError: assert <MagicMock na...630778828288'> == b'encrypted'
FAILED tests/body/cli/commands/test_fix.py::TestSecretStorage::test_get_secret_not_found - AssertionError: assert <MagicMock name='mock.SecretStorage().get()' id='133630778828288'> is None
FAILED tests/body/cli/commands/test_fix.py::TestSecretStorage::test_delete_secret - AssertionError: assert <MagicMock name='mock.SecretStorage().delete()' id='133630860674784'> is True
FAILED tests/body/cli/commands/test_fix.py::TestSecretStorage::test_list_all_secrets - AssertionError: assert 0 == 3
FAILED tests/body/cli/commands/test_fix.py::TestSecretStorage::test_get_all_secrets - AssertionError: assert 0 == 2
FAILED tests/body/cli/commands/test_fix.py::TestSecretStorage::test_update_secret - AssertionError: assert <MagicMock name='mock.SecretStorage().update()' id='133630772205552'> is True
FAILED tests/body/cli/commands/test_fix.py::TestSecretStorage::test_exists - AssertionError: assert <MagicMock name='mock.SecretStorage().exists()' id='133630779112528'> is True
FAILED tests/body/cli/commands/test_fix.py::TestErrorHandling::test_database_connection_error - assert 0 == 1
FAILED tests/body/cli/commands/test_fix.py::TestErrorHandling::test_encryption_error - assert 0 == 1
FAILED tests/body/cli/commands/test_fix.py::TestErrorHandling::test_json_parse_error - assert 0 == 1
FAILED tests/body/cli/commands/test_fix.py::TestIntegration::test_full_secret_lifecycle - AssertionError: assert <MagicMock name='mock.SecretManager().set_secret()' id='133630779088800'> is True
FAILED tests/body/cli/commands/test_fix.py::TestIntegration::test_export_import_roundtrip - AssertionError: assert <MagicMock name='mock.SecretManager().get_secret()' id='133630779048976'> == 'test-api-key'
FAILED tests/body/cli/commands/test_secrets.py::TestSecretManager::test_encrypt_value - AssertionError: assert False
FAILED tests/body/cli/commands/test_secrets.py::TestSecretManager::test_decrypt_value - AssertionError: assert <MagicMock name='mock.SecretManager().decrypt_value()' id='133630772496720'> == 'my-secret-password'
FAILED tests/body/cli/commands/test_secrets.py::TestSecretManager::test_validate_secret_name_valid - AssertionError: assert <MagicMock name='mock.SecretManager().validate_secret_name()' id='133630778706928'> is True
FAILED tests/body/cli/commands/test_secrets.py::TestSecretManager::test_validate_secret_name_invalid - AssertionError: assert <MagicMock name='mock.SecretManager().validate_secret_name()' id='133630778706928'> is False
FAILED tests/body/cli/commands/test_secrets.py::TestSecretManager::test_set_secret - AssertionError: assert <MagicMock name='mock.SecretManager().set_secret()' id='133630848363760'> is True
FAILED tests/body/cli/commands/test_secrets.py::TestSecretManager::test_get_secret - AssertionError: expected call not found.
FAILED tests/body/cli/commands/test_secrets.py::TestSecretManager::test_delete_secret - AssertionError: assert <MagicMock name='mock.SecretManager().delete_secret()' id='133630608894208'> is True
FAILED tests/body/cli/commands/test_secrets.py::TestSecretManager::test_list_secrets - AssertionError: assert 0 == 3
FAILED tests/body/cli/commands/test_secrets.py::TestSecretManager::test_rotate_secret - AssertionError: assert <MagicMock name='mock.SecretManager().rotate_secret()' id='133630608590704'> is True
FAILED tests/body/cli/commands/test_secrets.py::TestSecretManager::test_export_secrets - AssertionError: assert False
FAILED tests/body/cli/commands/test_secrets.py::TestSecretManager::test_import_secrets - AssertionError: assert <MagicMock name='mock.SecretManager().import_secrets()' id='133630608786256'> is True
FAILED tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_list_secrets_command - AssertionError: assert 'API_KEY' in ''
FAILED tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_list_secrets_empty - AssertionError: assert 'No secrets found' in ''
FAILED tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_get_secret_command - AssertionError: assert 'my-secret-value' in ''
FAILED tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_get_secret_not_found - assert 0 == 1
FAILED tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_set_secret_command - assert "Secret 'API_KEY' has been set" in ''
FAILED tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_set_secret_invalid_name - assert 0 == 1
FAILED tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_delete_secret_command - assert "Secret 'API_KEY' has been deleted" in ''
FAILED tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_delete_secret_cancelled - AssertionError: assert 'Cancelled' in ''
FAILED tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_rotate_secrets_command - AssertionError: assert 'Rotating 2 secrets' in ''
FAILED tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_export_secrets_command - AssertionError: assert 'Secrets exported to secrets.json' in ''
FAILED tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_export_secrets_encrypted - AssertionError: expected call not found.
FAILED tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_import_secrets_command - AssertionError: assert 'Secrets imported successfully' in ''
FAILED tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_import_secrets_overwrite - AssertionError: expected call not found.
FAILED tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_verify_encryption_command - AssertionError: assert 'Encryption is properly configured' in ''
FAILED tests/body/cli/commands/test_secrets.py::TestSecretsCLI::test_verify_encryption_failed - assert 0 == 1
FAILED tests/body/cli/commands/test_secrets.py::TestSecretStorage::test_save_secret - AssertionError: assert <MagicMock name='mock.SecretStorage().save()' id='133630876756128'> is True
FAILED tests/body/cli/commands/test_secrets.py::TestSecretStorage::test_get_secret - AssertionError: assert <MagicMock na...630606783888'> == b'encrypted'
FAILED tests/body/cli/commands/test_secrets.py::TestSecretStorage::test_get_secret_not_found - AssertionError: assert <MagicMock name='mock.SecretStorage().get()' id='133630606783888'> is None
FAILED tests/body/cli/commands/test_secrets.py::TestSecretStorage::test_delete_secret - AssertionError: assert <MagicMock name='mock.SecretStorage().delete()' id='133630608965360'> is True
FAILED tests/body/cli/commands/test_secrets.py::TestSecretStorage::test_list_all_secrets - AssertionError: assert 0 == 3
FAILED tests/body/cli/commands/test_secrets.py::TestSecretStorage::test_get_all_secrets - AssertionError: assert 0 == 2
FAILED tests/body/cli/commands/test_secrets.py::TestSecretStorage::test_update_secret - AssertionError: assert <MagicMock name='mock.SecretStorage().update()' id='133630606210736'> is True
FAILED tests/body/cli/commands/test_secrets.py::TestSecretStorage::test_exists - AssertionError: assert <MagicMock name='mock.SecretStorage().exists()' id='133630606657248'> is True
FAILED tests/body/cli/commands/test_secrets.py::TestErrorHandling::test_database_connection_error - assert 0 == 1
FAILED tests/body/cli/commands/test_secrets.py::TestErrorHandling::test_encryption_error - assert 0 == 1
FAILED tests/body/cli/commands/test_secrets.py::TestErrorHandling::test_json_parse_error - assert 0 == 1
FAILED tests/body/cli/commands/test_secrets.py::TestIntegration::test_full_secret_lifecycle - AssertionError: assert <MagicMock name='mock.SecretManager().set_secret()' id='133630848363760'> is True
FAILED tests/body/cli/commands/test_secrets.py::TestIntegration::test_export_import_roundtrip - AssertionError: assert <MagicMock name='mock.SecretManager().get_secret()' id='133630927691872'> == 'test-api-key'
FAILED tests/body/cli/test_admin_cli.py::TestAdminCLI::test_admin_cli_help - AssertionError: assert 'CORE Admin CLI' in ''
FAILED tests/body/cli/test_admin_cli.py::TestAdminCLI::test_admin_cli_version - AssertionError: assert 'version' in ''
FAILED tests/body/cli/test_admin_cli.py::TestAdminCLI::test_admin_cli_no_command - AssertionError: assert 'Usage:' in ''
FAILED tests/body/cli/test_admin_cli.py::TestStatusCommand::test_status_basic - AssertionError: assert 'A1' in ''
FAILED tests/body/cli/test_admin_cli.py::TestStatusCommand::test_status_detailed - AssertionError: assert 'capabilities' in ''
FAILED tests/body/cli/test_admin_cli.py::TestStatusCommand::test_status_json_format - json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)
FAILED tests/body/cli/test_admin_cli.py::TestStatusCommand::test_status_yaml_format - TypeError: 'NoneType' object is not subscriptable
FAILED tests/body/cli/test_admin_cli.py::TestStatusCommand::test_status_connection_error - assert 0 != 0
FAILED tests/body/cli/test_admin_cli.py::TestAuditCommand::test_audit_all - AssertionError: assert 'passed' in ''
FAILED tests/body/cli/test_admin_cli.py::TestAuditCommand::test_audit_specific_check - AssertionError: assert 'Coverage below constitutional requirement' in ''
FAILED tests/body/cli/test_admin_cli.py::TestAuditCommand::test_audit_multiple_checks - AssertionError: assert 0 == 3
FAILED tests/body/cli/test_admin_cli.py::TestAuditCommand::test_audit_fix_flag - AssertionError: assert 'fixed' in ''
FAILED tests/body/cli/test_admin_cli.py::TestAuditCommand::test_audit_strict_mode - assert 0 != 0
FAILED tests/body/cli/test_admin_cli.py::TestAuditCommand::test_audit_output_file - AssertionError: assert False
FAILED tests/body/cli/test_admin_cli.py::TestAuditCommand::test_audit_list_available - AssertionError: assert 'coverage' in ''
FAILED tests/body/cli/test_admin_cli.py::TestRemediateCommand::test_remediate_all - AssertionError: assert '12' in ''
FAILED tests/body/cli/test_admin_cli.py::TestRemediateCommand::test_remediate_specific_type - AssertionError: assert '25' in ''
FAILED tests/body/cli/test_admin_cli.py::TestRemediateCommand::test_remediate_coverage - AssertionError: assert '38' in ''
FAILED tests/body/cli/test_admin_cli.py::TestRemediateCommand::test_remediate_dry_run - AssertionError: assert 'would fix' in ''
FAILED tests/body/cli/test_admin_cli.py::TestRemediateCommand::test_remediate_with_ai - AssertionError: assert ('AI' in '' or 'ai' in '')
FAILED tests/body/cli/test_admin_cli.py::TestRemediateCommand::test_remediate_target_coverage - AssertionError: assert '76' in ''
FAILED tests/body/cli/test_admin_cli.py::TestSyncCommand::test_sync_all - AssertionError: assert 'synced' in ''
FAILED tests/body/cli/test_admin_cli.py::TestSyncCommand::test_sync_database_only - AssertionError: Expected 'sync_database' to have been called once. Called 0 times.
FAILED tests/body/cli/test_admin_cli.py::TestSyncCommand::test_sync_vectorstore_only - AssertionError: Expected 'sync_vectorstore' to have been called once. Called 0 times.
FAILED tests/body/cli/test_admin_cli.py::TestSyncCommand::test_sync_knowledge_graph - AssertionError: assert 'nodes' in ''
FAILED tests/body/cli/test_admin_cli.py::TestSyncCommand::test_sync_force_rebuild - AssertionError: Expected 'rebuild_all' to have been called once. Called 0 times.
FAILED tests/body/cli/test_admin_cli.py::TestSyncCommand::test_sync_verify - AssertionError: Expected 'verify_sync' to have been called once. Called 0 times.
FAILED tests/body/cli/test_admin_cli.py::TestInitCommand::test_init_new_project - AssertionError: assert False
FAILED tests/body/cli/test_admin_cli.py::TestInitCommand::test_init_existing_directory - AssertionError: assert False
FAILED tests/body/cli/test_admin_cli.py::TestInitCommand::test_init_with_template - AssertionError: assert 'microservice' in ''
FAILED tests/body/cli/test_admin_cli.py::TestInitCommand::test_init_minimal - AssertionError: assert False
FAILED tests/body/cli/test_admin_cli.py::TestConfigCommand::test_config_list - AssertionError: assert 'autonomy_level' in ''
FAILED tests/body/cli/test_admin_cli.py::TestConfigCommand::test_config_get - AssertionError: assert 'deepseek-coder' in ''
FAILED tests/body/cli/test_admin_cli.py::TestConfigCommand::test_config_set - AssertionError: assert 'set' in ''
FAILED tests/body/cli/test_admin_cli.py::TestConfigCommand::test_config_validate - AssertionError: assert 'valid' in ''
FAILED tests/body/cli/test_admin_cli.py::TestErrorHandling::test_handle_database_error - assert 0 != 0
FAILED tests/body/cli/test_admin_cli.py::TestErrorHandling::test_handle_permission_error - assert 0 != 0
FAILED tests/body/cli/test_admin_cli.py::TestErrorHandling::test_handle_keyboard_interrupt - AssertionError: assert ('Interrupted' in '' or 'Cancelled' in '')
===================================================== 116 failed, 532 passed, 2 xfailed, 3 warnings in 56.91s ======================================================
(core-py3.12) lira@lira:/opt/dev/CORE$
