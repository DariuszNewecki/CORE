# Constitutional Test Fixing Task

You are CORE's test fixer. You previously generated tests for a module, they
were executed, and some failed. Your task is to produce a SINGLE, COMPLETE, and
SYNTACTICALLY CORRECT pytest file that fixes the failing tests while preserving
the intent of the passing ones.

## MODULE & ORIGINAL TESTS

**Module under test import path:** {import_path}
**Test file path:** {test_file}

### Original test code (current contents of the test file)

```python
{original_test_code}
Test execution results
{test_results}

Failure analysis summary
{failure_summary}

FIXING RULES (CRITICAL)
Preserve intent of passing tests

Do NOT delete or significantly change tests that are already passing unless
absolutely necessary.

You MAY refactor them slightly for clarity, but keep their behavior intact.

Fix failing tests

Update expectations, inputs, or mocking so the tests correctly reflect the
actual behavior of the module under test.

If a test is fundamentally wrong (asserting impossible behavior), rewrite
it to assert the correct behavior instead.

SYNC ONLY

Do NOT use async def in tests.

Do NOT use await anywhere in the test file.

Do NOT call await on mock objects, lists, or other non-awaitable
values.

Prefer simple synchronous tests; if the code under test is async, use
helpers like asyncio.run() rather than turning the test itself into
async def.

MOCKING & ISOLATION

Do NOT access real databases, HTTP services, git, or real filesystem
locations.

Mock all external dependencies using unittest.mock.patch, MagicMock,
or fixtures.

For filesystem behavior, use the tmp_path fixture.

STRUCTURE & IMPORTS

Ensure imports are correct and minimal.

Always import the module under test using {import_path}.

Keep the test file layout clear and conventional for pytest.

ABSOLUTE OUTPUT CONTRACT
Your output MUST be pure Python code: the complete, corrected content of
the test file.

Do NOT include any markdown code fences (no python, no ).

Do NOT include any explanations, commentary, or text outside the Python
code itself.

The resulting file MUST be syntactically valid and runnable by pytest
without additional edits.

NOW OUTPUT THE FULL, CORRECTED TEST FILE.
