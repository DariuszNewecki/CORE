# pyproject.toml

[build-system]
requires = ["poetry-core>=1.0.0"]
build-backend = "poetry.core.masonry.api"

[tool.poetry]
name = "core"
version = "0.1.0"
description = "CORE: A self-governing, intent-driven software development system."
authors = ["Dariusz Newecki <d.newecki@gmail.com>"]
license = "MIT"
readme = "README.md"
packages = [
    { include = "core", from = "src" },
    { include = "agents", from = "src" },
    { include = "system", from = "src" },
    { include = "shared", from = "src" }
    # { include = "data", from = "src" },  # enable only when src/data exists
]

# --- Main Dependencies ---
[tool.poetry.dependencies]
python = ">=3.9"

# API stack (compatible with Pydantic v2)
fastapi = ">=0.103.0"
uvicorn = { extras = ["standard"], version = ">=0.24.0" }

# Core libraries
pyyaml = ">=6.0.1"
httpx = ">=0.27.0"
python-dotenv = ">=1.0.0"
pydantic = ">=2.5.0"
pydantic-settings = "^2.0.0"
cryptography = ">=42.0.0"
jsonschema = "^4"
typer = "^0.9.0"
radon = ">=5.1.0"
filelock = "^3.13.0"

# NOTE:
# - We intentionally DO NOT depend on 'requests' (policy forbids it; use httpx).
# - 'rich' is optional; our tools degrade gracefully if it's not installed.

# --- Development Dependencies ---
[tool.poetry.group.dev.dependencies]
pytest = ">=7.0,<8.0"
pytest-asyncio = "==0.21.0"
black = "^24.8.0"
ruff = ">=0.0.254"
pytest-mock = "^3.12.0"
pytest-cov = "^4.0"

# --- Command-Line Scripts ---
[tool.poetry.scripts]
core-admin = "system.admin_cli:app"

# --- Configuration for development tools ---
[tool.black]
line-length = 88

[tool.ruff]
line-length = 88

[tool.ruff.lint]
select = ["E", "W", "F", "I"]
# This makes 'black' the single source of truth for formatting.
ignore = ["E501"]

[tool.pytest.ini_options]
testpaths = ["tests"]
asyncio_mode = "auto"
pythonpath = ["src"]
addopts = ["-c", "pyproject.toml"]

log_cli = true
log_cli_level = "DEBUG"
