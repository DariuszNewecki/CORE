# .intent/mind/config/runtime_requirements.yaml
version: "1.0.0"
id: "mind_config_runtime_requirements"
title: "Runtime Requirements"
type: "config_runtime_requirements"
status: active

owners:
  accountable: "Governance Lead"
  responsible:
    - "Core Maintainer"

review:
  frequency: "12 months"

schema_id: "config.runtime_requirements"
$schema: "charter/schemas/config.runtime_requirements.schema.json"


variables:
  # ======================================================================
  # 1. GLOBAL FALLBACK SETTINGS
  # ======================================================================
  LLM_CONNECT_TIMEOUT:
    description: "Timeout in seconds for establishing a connection to an LLM API."
    source: env
    required: false
    type: integer
    default: 10
    used_by: ["agents"]
  LLM_REQUEST_TIMEOUT:
    description: "Timeout in seconds for waiting for a full response from an LLM API. Increase this on slower hardware."
    source: env
    required: false
    type: integer
    default: 300 # Increased default as per your .env
    used_by: ["agents"]
  CORE_MAX_CONCURRENT_REQUESTS:
    description: "GLOBAL FALLBACK for the maximum number of simultaneous outbound LLM requests. This is used if a resource-specific override is not set."
    source: env
    required: false
    type: integer
    default: 2 # A safe, conservative default
    used_by: ["system", "agents"]
  LLM_SECONDS_BETWEEN_REQUESTS:
    description: "GLOBAL FALLBACK for the delay to insert between LLM API calls. Used if a resource-specific override is not set."
    source: env
    required: false
    type: integer
    default: 1 # A safe default for cloud APIs
    used_by: ["agents"]


  # ======================================================================
  # 2. CORE SYSTEM & PATHS
  # ======================================================================
  MIND:
    description: "The relative path to the system's declarative 'mind' (.intent directory)."
    source: env
    required: true
    type: path
    used_by: ["system", "auditor"]
  BODY:
    description: "The relative path to the system's executable 'body' (src directory)."
    source: env
    required: true
    type: path
    used_by: ["system"]
  REPO_PATH:
    description: "The absolute path to the root of the repository."
    source: env
    required: true
    type: path
    used_by: ["system","auditor"]
  LLM_ENABLED:
    description: "Master flag to enable or disable all LLM-related capabilities."
    source: env
    required: true
    type: bool
    allowed: ["true","false"]
    used_by: ["agents"]
  KEY_STORAGE_DIR:
    description: "The secure directory for storing operator private keys."
    source: env
    required: true
    type: path
    default: ".intent/keys"
    used_by: ["system"]
  CORE_ACTION_LOG_PATH:
    description: "Path to the action/change log file, required for the safety policy 'change_must_be_logged'."
    source: env
    required: true
    type: path
    used_by: ["auditor", "system"]
  CORE_ENV:
    description: "Runtime mode: 'development' or 'production'."
    source: env
    required: true
    type: enum
    allowed: ["development","production"]
    used_by: ["system"]
  LOG_LEVEL:
    description: "Logging level."
    source: env
    required: true
    type: enum
    allowed: ["DEBUG","INFO","WARNING","ERROR"]
    used_by: ["system"]


  # ======================================================================
  # 3. LLM RESOURCE CONFIGURATION (WITH PER-RESOURCE TUNING)
  # ======================================================================

  # --- START OF NEW DEFINITIONS for ollama_local ---
  OLLAMA_LOCAL_API_URL:
    description: "API URL for the 'ollama_local' resource."
    source: env
    required: false
    type: uri
    used_by: ["agents"]
    required_when: "LLM_ENABLED == true"
  OLLAMA_LOCAL_API_KEY:
    description: "API key for the 'ollama_local' resource (if required)."
    source: secret
    required: false
    type: string
    used_by: ["agents"]
  OLLAMA_LOCAL_MODEL_NAME:
    description: "Model name for the 'ollama_local' resource."
    source: env
    required: false
    type: string
    used_by: ["agents"]
    required_when: "LLM_ENABLED == true"
  OLLAMA_LOCAL_MAX_CONCURRENT_REQUESTS:
    description: "Concurrency override for 'ollama_local'. Recommended: 1 for local GPUs."
    source: env
    required: false
    type: integer
    default: 1
    used_by: ["agents"]
  OLLAMA_LOCAL_SECONDS_BETWEEN_REQUESTS:
    description: "Delay override for 'ollama_local'. Recommended: 0 for no artificial delay."
    source: env
    required: false
    type: integer
    default: 0
    used_by: ["agents"]
  # --- END OF NEW DEFINITIONS for ollama_local ---

  DEEPSEEK_CHAT_API_URL:
    description: "API URL for the 'deepseek_chat' resource."
    source: env
    required: false
    type: uri
    used_by: ["agents"]
    required_when: "LLM_ENABLED == true"
  DEEPSEEK_CHAT_API_KEY:
    description: "API key for the 'deepseek_chat' resource."
    source: secret
    required: false
    type: string
    used_by: ["agents"]
    required_when: "LLM_ENABLED == true"
  DEEPSEEK_CHAT_MODEL_NAME:
    description: "Model name for the 'deepseek_chat' resource."
    source: env
    required: false
    type: string
    used_by: ["agents"]
    required_when: "LLM_ENABLED == true"
  DEEPSEEK_CHAT_MAX_CONCURRENT_REQUESTS:
    description: "Concurrency override for the 'deepseek_chat' resource."
    source: env
    required: false
    type: integer
    default: 2
    used_by: ["agents"]
  DEEPSEEK_CHAT_SECONDS_BETWEEN_REQUESTS:
    description: "Delay override for the 'deepseek_chat' resource."
    source: env
    required: false
    type: integer
    default: 1
    used_by: ["agents"]

  DEEPSEEK_CODER_API_URL:
    description: "API URL for the 'deepseek_coder' resource."
    source: env
    required: false
    type: uri
    used_by: ["agents"]
    required_when: "LLM_ENABLED == true"
  DEEPSEEK_CODER_API_KEY:
    description: "API key for the 'deepseek_coder' resource."
    source: secret
    required: false
    type: string
    used_by: ["agents"]
    required_when: "LLM_ENABLED == true"
  DEEPSEEK_CODER_MODEL_NAME:
    description: "Model name for the 'deepseek_coder' resource."
    source: env
    required: false
    type: string
    used_by: ["agents"]
    required_when: "LLM_ENABLED == true"
  DEEPSEEK_CODER_MAX_CONCURRENT_REQUESTS:
    description: "Concurrency override for the 'deepseek_coder' resource."
    source: env
    required: false
    type: integer
    default: 3
    used_by: ["agents"]
  DEEPSEEK_CODER_SECONDS_BETWEEN_REQUESTS:
    description: "Delay override for the 'deepseek_coder' resource."
    source: env
    required: false
    type: integer
    default: 1
    used_by: ["agents"]

  ANTHROPIC_CLAUDE_SONNET_API_URL:
    description: "API URL for the 'anthropic_claude_sonnet' resource."
    source: env
    required: false
    type: uri
    used_by: ["agents"]
    required_when: "LLM_ENABLED == true"
  ANTHROPIC_CLAUDE_SONNET_API_KEY:
    description: "API key for the 'anthropic_claude_sonnet' resource."
    source: secret
    required: false
    type: string
    used_by: ["agents"]
    required_when: "LLM_ENABLED == true"
  ANTHROPIC_CLAUDE_SONNET_MODEL_NAME:
    description: "Model name for the 'anthropic_claude_sonnet' resource."
    source: env
    required: false
    type: string
    used_by: ["agents"]
    required_when: "LLM_ENABLED == true"
  ANTHROPIC_CLAUDE_SONNET_MAX_CONCURRENT_REQUESTS:
    description: "Concurrency override for the 'anthropic_claude_sonnet' resource."
    source: env
    required: false
    type: integer
    default: 2
    used_by: ["agents"]
  ANTHROPIC_CLAUDE_SONNET_SECONDS_BETWEEN_REQUESTS:
    description: "Delay override for the 'anthropic_claude_sonnet' resource."
    source: env
    required: false
    type: integer
    default: 1
    used_by: ["agents"]

  LOCAL_EMBEDDING_API_URL:
    description: "API URL for the local embedding resource."
    source: env
    required: true
    type: uri
    used_by: ["system"]
    required_when: "LLM_ENABLED == true"
  LOCAL_EMBEDDING_API_KEY:
    description: "API key for the local embedding resource (if required)."
    source: secret
    required: false
    type: string
    used_by: ["system"]
    required_when: "LLM_ENABLED == true"
  LOCAL_EMBEDDING_MODEL_NAME:
    description: "Model name for the local embedding resource."
    source: env
    required: true
    type: string
    used_by: ["system"]
    required_when: "LLM_ENABLED == true"
  LOCAL_EMBEDDING_DIM:
    description: "The output dimension of the embedding model."
    source: env
    required: true
    type: integer
    default: 768
    used_by: ["system"]
    required_when: "LLM_ENABLED == true"
  EMBED_MODEL_REVISION:
    description: "A revision tag/date for the embedding model to track provenance."
    source: env
    required: true
    type: string
    default: "2025-09-15"
    used_by: ["system"]
    required_when: "LLM_ENABLED == true"
  EMBEDDING_MAX_CONCURRENT_REQUESTS:
    description: "Concurrency override for the embedding model."
    source: env
    required: false
    type: integer
    default: 2
    used_by: ["system"]


  # ======================================================================
  # 4. DATABASE & VECTOR STORE
  # ======================================================================
  QDRANT_URL:
    description: "URL for the Qdrant vector database instance."
    source: env
    required: true
    type: uri
    used_by: ["system"]
  QDRANT_COLLECTION_NAME:
    description: "The name of the collection within Qdrant to use for capabilities."
    source: env
    required: true
    type: string
    default: "core_capabilities"
    used_by: ["system"]
  DATABASE_URL:
    description: "The full connection string for the PostgreSQL database."
    source: env
    required: true
    type: uri
    used_by: ["system", "auditor"]
